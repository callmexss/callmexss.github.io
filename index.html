<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'T2VQGNUUN1',
      apiKey: '7637fb68b08c225b5cf407956a3c51c9',
      indexName: 'blogSearch',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
<meta property="og:type" content="website">
<meta property="og:title" content="像素书">
<meta property="og:url" content="https://callmexss.top/index.html">
<meta property="og:site_name" content="像素书">
<meta property="og:description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="像素书">
<meta name="twitter:description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">



  <link rel="alternate" href="/atom.xml" title="像素书" type="application/atom+xml">




  <link rel="canonical" href="https://callmexss.top/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>像素书</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">像素书</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">叙事诗</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/" itemprop="url">
                  一些提高工作效率的超级秘密的 VS Code 奇淫巧计
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-09-08 23:12:17" itemprop="dateCreated datePublished" datetime="2019-09-08T23:12:17+08:00">2019-09-08</time>
            

            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>387 字</span>
              &nbsp; | &nbsp;
              <span>1 min</span>
            </span>
          

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/翻译/" itemprop="url" rel="index"><span itemprop="name">翻译</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/翻译/器/" itemprop="url" rel="index"><span itemprop="name">器</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/" class="leancloud_visitors" data-flag-title="一些提高工作效率的超级秘密的 VS Code 奇淫巧计">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>拖延了很久的 ARTS 打卡终于准备开始了。A 是指 Algorithm，即每周练习一道算法题；R 是指 Review，阅读并点评至少一篇英文技术文章；T 是指 Tip，学习一个新的技术技巧；S 是 Share，分享一篇有观点和思考的技术文章。</p>
<p>不知不觉已经脱离 IDE 很久了，因为找工作期间都是写一些代码量比较小的算法题目和程序片段，主力开发软件已经成了 Vim 和 VS Code。工欲善其事必先利其器，所以我的第一篇 Review 选择了一篇有关 VS Code 的文章。</p>
<h1 id="译文"><a href="#译文" class="headerlink" title="译文"></a>译文</h1><blockquote>
<p>原文<a href="https://medium.com/free-code-camp/here-are-some-super-secret-vs-code-hacks-to-boost-your-productivity-20d30197ac76" target="_blank" rel="noopener">Here are some super secret VS Code hacks to boost your productivity</a></p>
</blockquote>
<p>不论是作为一名爱好者、专业者、或者甚至一个月只写代码的开发者，你都必须知道，对于一个在工作时愿意投入最大效率时间的人来说，拥有智能和锋利的开发工具是至关重要的。</p>
<p>我已经筹措整理了一些技巧、诀窍和扩展，并经过重重筛选，只保留了对现代 web 开发者来说最少和最有用的一部分。正如我们所知道的，Javascript 的生态系统非常庞大，而且还在不断壮大。基于这个原因，我会尽量做到不偏不倚。</p>
<p>接下来的 Visual Studio Code 技巧将会让你能够以如下的姿态走出你所有的编码阶段：</p>
<p><iframe src="https://giphy.com/embed/26gJyIscAHtBNcc00" width="480" height="266" frameborder="0" class="giphy-embed" allowfullscreen></iframe></p><p><a href="https://giphy.com/gifs/ufc-mma-ufc-205-26gJyIscAHtBNcc00" target="_blank" rel="noopener">via GIPHY</a></p><video id="video" controls preload="none" poster="http://om2bks7xs.bkt.clouddn.com/2017-08-26-Markdown-Advance-Video.jpg"><source id="mp4" src type="video/mp4"></video><p></p>
<h2 id="让它变得美丽友好"><a href="#让它变得美丽友好" class="headerlink" title="让它变得美丽友好"></a>让它变得美丽友好</h2>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/07/23/字符串的最短唯一前缀/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/23/字符串的最短唯一前缀/" itemprop="url">
                  字符串的最短唯一前缀
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-23 17:12:05" itemprop="dateCreated datePublished" datetime="2019-07-23T17:12:05+08:00">2019-07-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-07 18:58:04" itemprop="dateModified" datetime="2019-08-07T18:58:04+08:00">2019-08-07</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>1.7k 字</span>
              &nbsp; | &nbsp;
              <span>8 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/23/字符串的最短唯一前缀/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/07/23/字符串的最短唯一前缀/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/07/23/字符串的最短唯一前缀/" class="leancloud_visitors" data-flag-title="字符串的最短唯一前缀">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>输入第一行为一个整数，表示字符串的行数，接下来的 N 行每行为一个字符串。</p>
<p>输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">bytedance</span><br><span class="line">toutiaohao</span><br><span class="line">toutiaoapp</span><br><span class="line">iesaweme</span><br><span class="line">iestiktok</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b</span><br><span class="line">toutiaoh</span><br><span class="line">toutiaoa</span><br><span class="line">iesa</span><br><span class="line">iest</span><br></pre></td></tr></table></figure>
<blockquote>
<p>题目描述：找到输入中每个字符串的最短唯一前缀。</p>
<p>数据范围：N ≤ 1000，总字符数 &lt; 1000000。</p>
<p>输入数据确保没有一个字符串是另一个字符串的前缀。</p>
</blockquote>
<p>思路是每个字符串和其他的所有字符串做比较，记录两个字符串间相同的位数，取其中的最大值作为字符串的唯一标识。</p>
<p>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">'bytedance'</span></span><br><span class="line"></span><br><span class="line">other_words = [</span><br><span class="line">    <span class="string">'toutiaohao'</span>,</span><br><span class="line">    <span class="string">'toutiaoapp'</span>,</span><br><span class="line">    <span class="string">'iesaweme'</span>,</span><br><span class="line">    <span class="string">'iestiktok'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># b != t</span></span><br><span class="line"><span class="comment"># b != i</span></span><br><span class="line"><span class="comment"># loc = 0</span></span><br><span class="line">print(<span class="string">'bytedance'</span>[:loc+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">'toutiaohao'</span></span><br><span class="line"></span><br><span class="line">other_words = [</span><br><span class="line">    <span class="string">'bytedance'</span>,</span><br><span class="line">    <span class="string">'toutiaoapp'</span>,</span><br><span class="line">    <span class="string">'iesaweme'</span>,</span><br><span class="line">    <span class="string">'iestiktok'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># for 'toutiaoapp':</span></span><br><span class="line"><span class="comment"># t == t</span></span><br><span class="line"><span class="comment"># o == o</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># a == a</span></span><br><span class="line"><span class="comment"># o == o</span></span><br><span class="line"><span class="comment"># h != a</span></span><br><span class="line"><span class="comment"># loc = 7</span></span><br><span class="line">print(<span class="string">'toutiaohao'</span>[:loc+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>按照这种思路写出代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(str_list)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> str_list:</span><br><span class="line">        <span class="comment"># one char must be unique</span></span><br><span class="line">        <span class="keyword">if</span> len(word) == <span class="number">1</span>:</span><br><span class="line">            print(word)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># save the largest i for where the unique prefix ends</span></span><br><span class="line">        saved_i = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> other_word <span class="keyword">in</span> str_list:</span><br><span class="line">            <span class="comment"># not do self compare </span></span><br><span class="line">            <span class="keyword">if</span> word == other_word:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">            <span class="comment"># find the first different char's location between word and other_word</span></span><br><span class="line">            <span class="keyword">while</span> i &lt; len(other_word):</span><br><span class="line">                <span class="keyword">if</span> word[i] == other_word[i]:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># find the first different char</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> saved_i:</span><br><span class="line">                        <span class="comment"># for the first inner loop</span></span><br><span class="line">                        saved_i = i</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># update saved_i if current i is larger</span></span><br><span class="line">                        saved_i = max(i, saved_i)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># if other_word is a sub-string of word (this will not happed assured by the problem)</span></span><br><span class="line">            <span class="comment"># i will be len(other_word)</span></span><br><span class="line">            <span class="comment"># and the else part will never be reached</span></span><br><span class="line">            <span class="comment"># which means saved_i still is None</span></span><br><span class="line">            <span class="comment"># so check this case</span></span><br><span class="line">            <span class="keyword">if</span> i == len(other_word):</span><br><span class="line">                saved_i = i</span><br><span class="line"></span><br><span class="line">        print(word[:saved_i+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># get toutal input count</span></span><br><span class="line">    N = int(input())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> N &lt;= <span class="number">0</span>:</span><br><span class="line">        exit()</span><br><span class="line">    </span><br><span class="line">    str_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        str_list.append(input().strip())  <span class="comment"># read a word</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> N == <span class="number">1</span>:</span><br><span class="line">        print(str_list[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        process(str_list)</span><br></pre></td></tr></table></figure>
<p>这个解法的复杂度非常高，每个字符串都会和其他所有的字符串比较一次，总共需要比较 $N\timesN-1$ 次，每次比较都需要顺序遍历字符串，因此复杂度为 $O(N^2\timesM)$，M 为字符串的平均长度。</p>
<p>后来问了一个同学，她的思路是按照列来处理，使用一个 <code>index</code> 来记录从 0 到当前列的字符串是否重复出现，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">str_list = [<span class="string">'abc'</span>, <span class="string">'calls'</span>, <span class="string">'called'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 index</span></span><br><span class="line">index = [<span class="number">-1</span>] * len(str_list) <span class="comment"># index -&gt; [-1, -1, -1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一列</span></span><br><span class="line">col = &#123;&#125; <span class="comment"># prefix: line_num</span></span><br><span class="line">col_num = <span class="number">0</span></span><br><span class="line">row_num = <span class="number">0</span></span><br><span class="line"><span class="string">'a'</span></span><br><span class="line">col = &#123;<span class="string">'a'</span>: <span class="number">0</span>&#125;</span><br><span class="line">index[row_num] = col_num <span class="comment"># index -&gt; [0, -1, -1]</span></span><br><span class="line">row_num = <span class="number">1</span></span><br><span class="line"><span class="string">'c'</span></span><br><span class="line">col = &#123;<span class="string">'a'</span>: <span class="number">0</span>, <span class="string">'c'</span>: <span class="number">1</span>&#125;</span><br><span class="line">index[row_num] = col_num <span class="comment"># index -&gt; [0, 0, -1]</span></span><br><span class="line">row_num = <span class="number">2</span></span><br><span class="line"><span class="string">'c'</span></span><br><span class="line">col = &#123;<span class="string">'a'</span>: <span class="number">0</span>, <span class="string">'c'</span>: <span class="number">-1</span>&#125;  <span class="comment"># 前缀 'c' 重复出现了</span></span><br><span class="line">index[row_num] = col_num <span class="comment"># index -&gt; [0, -1, -1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二列</span></span><br><span class="line">col = &#123;&#125;</span><br><span class="line">col_num = <span class="number">1</span></span><br><span class="line">row_num = <span class="number">0</span></span><br><span class="line">index[row_num] = <span class="number">0</span> != <span class="number">-1</span>  <span class="comment"># 已经找到最短前缀</span></span><br><span class="line">row_num = <span class="number">1</span></span><br><span class="line"><span class="string">'ca'</span></span><br><span class="line">col = &#123;<span class="string">'ca'</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="comment"># index -&gt; [0, 1, -1]</span></span><br><span class="line">row_num = <span class="number">2</span></span><br><span class="line"><span class="string">'ca'</span></span><br><span class="line">col = &#123;<span class="string">'ca'</span>: <span class="number">-1</span>&#125; <span class="comment"># 前缀 'ca' 重复出现</span></span><br><span class="line"><span class="comment"># index -&gt; [0, -1, -1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 第五列</span></span><br><span class="line">col_num = <span class="number">4</span></span><br><span class="line">row_num = <span class="number">0</span></span><br><span class="line">index[row_num] = <span class="number">0</span> != <span class="number">-1</span>  <span class="comment"># 已经找到最短前缀</span></span><br><span class="line">row_num = <span class="number">1</span></span><br><span class="line"><span class="string">'calls'</span></span><br><span class="line">col = &#123;<span class="string">'calls'</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="comment"># index -&gt; [0, 4, -1]</span></span><br><span class="line">row_nums = <span class="number">2</span></span><br><span class="line"><span class="string">'calle'</span></span><br><span class="line">col = &#123;<span class="string">'calls'</span>: <span class="number">1</span>, <span class="string">'calle'</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="comment"># index -&gt; [0, 4, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># index 均不为 -1，找到所有唯一最短前缀</span></span><br></pre></td></tr></table></figure>
<p>按照这种思路写出代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process1</span><span class="params">(self, str_list)</span>:</span></span><br><span class="line">    index = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str_list))] <span class="comment"># 每行的前缀index，初始设为-1，若找到前缀则更新为对应值</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        col = &#123;&#125; <span class="comment"># 记录从 0 到 i（当前列数）的前缀</span></span><br><span class="line">        <span class="keyword">for</span> line_num, word <span class="keyword">in</span> enumerate(str_list):</span><br><span class="line">            <span class="keyword">if</span> i == len(word) - <span class="number">1</span>:</span><br><span class="line">                index[line_num] = i</span><br><span class="line">            <span class="keyword">if</span> i &lt;= len(word) - <span class="number">1</span> <span class="keyword">and</span> index[line_num] == <span class="number">-1</span>: <span class="comment"># 如果当前行没到结尾，并且还未找到前缀</span></span><br><span class="line">                <span class="keyword">if</span> word[:i+<span class="number">1</span>] <span class="keyword">in</span> col: <span class="comment"># 前缀 word[:i+1] 已经出现过</span></span><br><span class="line">                    index[col[word[:i+<span class="number">1</span>]]] = <span class="number">-1</span></span><br><span class="line">                <span class="keyword">else</span>: <span class="comment">#如果没有重复字符，则找到前缀</span></span><br><span class="line">                    col[word[:i+<span class="number">1</span>]] = line_num</span><br><span class="line">                    index[line_num] = i</span><br><span class="line">        <span class="keyword">if</span> <span class="number">-1</span> <span class="keyword">not</span> <span class="keyword">in</span> index:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i, key <span class="keyword">in</span> enumerate(index):</span><br><span class="line">        print(str_list[i][:key+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>这种方法的时间复杂度是 $O(MN)$，其中 M 是最长的唯一前缀长度，N 是字符串数量。空间复杂度是 $O(N)$，使用了一个数组 index 来记录每一行最短前缀的位置。</p>
<p>更新一下字典树（前缀树）的解法：</p>
<p>使用 <code>path</code> 记录经过节点的字母个数，当节点的 <code>path</code> 的值第一次为 1 时经过路径上的字符构成的字符串即为唯一最短前缀。例如以如下输入构建字典树：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bytedance</span><br><span class="line">toutiaohao</span><br><span class="line">toutiaoapp</span><br></pre></td></tr></table></figure>

<p>从图中可以看出，对于 bytedance 来说，根节点后的第一个节点的 path 值就是 1，所以它的最短唯一前缀就是 b。而后两个字符串的前几个字符相同，所以这几个节点记录的路径值为 2。当第一次出现路径值为 1 的节点时，到达其最短唯一前缀。</p>
<p>实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.path = <span class="number">0</span></span><br><span class="line">        self.end = <span class="number">0</span></span><br><span class="line">        self.maps = [<span class="literal">None</span>] * <span class="number">26</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.root = TrieNode()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="string">"""Insert a word into trie tree.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        word: str, a word as string to inserted</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        node.path += <span class="number">1</span>  <span class="comment"># this is actually the total number of words</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            <span class="comment"># get the index of current char</span></span><br><span class="line">            index = ord(c) - ord(<span class="string">'a'</span>)</span><br><span class="line">            <span class="comment"># add a new trie node if current char is first shown</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node.maps[index]:</span><br><span class="line">                node.maps[index] = TrieNode()</span><br><span class="line">            <span class="comment"># else step into this char's node and update the path count</span></span><br><span class="line">            node = node.maps[index]</span><br><span class="line">            node.path += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># hit the end of the word, mark it as end</span></span><br><span class="line">        node.end += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="string">"""Check whether a word is in trie tree.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        word: str, a word as string to be searched</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            index = ord(c) - ord(<span class="string">'a'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node.maps[index]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            node = node.maps[index]</span><br><span class="line">        <span class="keyword">return</span> node.end &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_shortest_unique_prefix</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="string">"""Get the shortest unique prefix of a given word.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        word: str, a word as string to be searched</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># this check should be done,</span></span><br><span class="line">        <span class="comment"># but i omit it here for convenient,</span></span><br><span class="line">        <span class="comment"># okkk... finally i did this.</span></span><br><span class="line">        <span class="keyword">assert</span> self.search(word) == <span class="literal">True</span>, <span class="string">"word is not in trie tree"</span></span><br><span class="line">        <span class="comment"># or should i insert it directly ???</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        shortest_unique_prefix = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            index = ord(c) - ord(<span class="string">'a'</span>)</span><br><span class="line">            shortest_unique_prefix.append(c)</span><br><span class="line">            <span class="comment"># note that the path of the first node</span></span><br><span class="line">            <span class="comment"># which actually is the root node's path</span></span><br><span class="line">            <span class="comment"># should not be checked and what we find</span></span><br><span class="line">            <span class="comment"># is the node whose path first equals one</span></span><br><span class="line">            node = node.maps[index]</span><br><span class="line">            <span class="keyword">if</span> node.path == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">''</span>.join(shortest_unique_prefix)</span><br><span class="line">        <span class="keyword">return</span> word</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_via_trie</span><span class="params">(self, str_list)</span>:</span></span><br><span class="line">        trie = Trie()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> str_list:</span><br><span class="line">            trie.insert(word)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> str_list:</span><br><span class="line">            shortest_unique_prefix = trie.get_shortest_unique_prefix(word)</span><br><span class="line">            print(shortest_unique_prefix)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># get toutal input count</span></span><br><span class="line">    N = int(input())</span><br><span class="line">    solution = Solution()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> N:</span><br><span class="line">        exit()</span><br><span class="line">    </span><br><span class="line">    str_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        str_list.append(input().strip())  <span class="comment"># read a word</span></span><br><span class="line">    <span class="keyword">if</span> N == <span class="number">1</span>:</span><br><span class="line">        print(str_list[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        solution.process_via_trie(str_list)</span><br></pre></td></tr></table></figure>
<p>然后测试的时候内存超过限制了…使用长度为 26 的列表会造成大量的空间浪费，尝试改成字典或者其他的数据结构应该可以优化空间的消耗。</p>
<p>更新把列表换成字典的解法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.path = <span class="number">0</span></span><br><span class="line">        self.end = <span class="number">0</span></span><br><span class="line">        self.maps = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.root = TrieNode()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        node.path += <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> node.maps:</span><br><span class="line">                node.maps[c] = TrieNode()</span><br><span class="line">            node = node.maps[c]</span><br><span class="line">            node.path += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        node.end += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> node.maps:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            node = node.maps[c]</span><br><span class="line">        <span class="keyword">return</span> node.end &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_shortest_unique_prefix</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> self.search(word) == <span class="literal">True</span>, <span class="string">"word is not in trie tree"</span></span><br><span class="line">        node = self.root</span><br><span class="line">        shortest_unique_prefix = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            shortest_unique_prefix.append(c)</span><br><span class="line">            node = node.maps[c]</span><br><span class="line">            <span class="keyword">if</span> node.path == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">''</span>.join(shortest_unique_prefix)</span><br><span class="line">        <span class="keyword">return</span> word</span><br></pre></td></tr></table></figure>
<p>相比于列表，字典只会在需要的时候创建空间，因此可以节省一些空间，但是结果依然超过了最大可用内存。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/06/12/数据结构错题本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/12/数据结构错题本/" itemprop="url">
                  数据结构错题本
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-12 21:25:55" itemprop="dateCreated datePublished" datetime="2019-06-12T21:25:55+08:00">2019-06-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-27 22:48:24" itemprop="dateModified" datetime="2019-07-27T22:48:24+08:00">2019-07-27</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>465 字</span>
              &nbsp; | &nbsp;
              <span>1 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/12/数据结构错题本/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/06/12/数据结构错题本/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/06/12/数据结构错题本/" class="leancloud_visitors" data-flag-title="数据结构错题本">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><h3 id="有关二叉树的数学知识"><a href="#有关二叉树的数学知识" class="headerlink" title="有关二叉树的数学知识"></a>有关二叉树的数学知识</h3><h4 id="二叉树每层节点数"><a href="#二叉树每层节点数" class="headerlink" title="二叉树每层节点数"></a>二叉树每层节点数</h4><p>二叉树中每层的节点数都是其上一行的两倍:1 2 4 …</p>
<p>因此每层的节点数为首项为 1 公比为 2 的等比数列的通项公式：</p>
<script type="math/tex; mode=display">N = 2 ^ {n - 1}</script><h4 id="满二叉树节点总数"><a href="#满二叉树节点总数" class="headerlink" title="满二叉树节点总数"></a>满二叉树节点总数</h4><p>二叉树中每层的节点数为：1 2 4 …</p>
<p>是一个公比不等于 1 的等比数列，由等比数列的求和公式</p>
<script type="math/tex; mode=display">q = \frac {a_1 - a_1q^n} {1 - q}</script><p>得满二叉树的节点总数：</p>
<script type="math/tex; mode=display">N = 2^n - 1</script><p>其中 n 为二叉树层数。</p>
<p><strong>例题</strong>：<a href="https://www.nowcoder.com/questionTerminal/b1bf283efde3430a96849037879fb926" target="_blank" rel="noopener">一个完全二叉树节点数为200，则其叶子结点个数为？</a></p>
<p><strong>常规解法：</strong>$2^n - 1 &lt;= 200$ ，将 1 移到等式右边两边同时取对数得到 $log_2{128} &lt; n = log_2{201} &lt; log_2{256}$，推出 8 &lt; n &lt; 10，所以 n = 9。</p>
<p>因为是完全二叉树，因此前 8 层一定是满的，于是第九层节点数等于 $200 - (2^8 - 1) = 73$，完全二叉树中叶子节点一定是按顺序排列的，因此第八层中有 33 个节点有叶子节点，$2^{8 - 1} - 37 = 27$，所以总共有$73 + 27 = 100$ 个叶子节点。</p>
<p><strong>根据二叉树的性质：</strong>完全二叉树除最后一层，其他层都是满结点的。所以这里总结点200个，是偶数，可以判断度为1的结点是1个。</p>
<p>根据二叉树性质 $n_0 = n_2 + 1$;叶子结点数量等于度为2的结点数+1</p>
<script type="math/tex; mode=display">n_0 + n_1 + n_2 = 200\\

n_0 + n_1 + n_0 - 1 =200\\

2n_0 = 201-n_1 = 200</script><p>完全二叉树度为1的结点个数要么1，要么0. 叶子结点数为整数，这里也可以推断出度为1的结点个数是1，$n_0 = 100$，所以叶子结点数是100.</p>
<p><strong>总结：</strong>：完全二叉树，叶子结点数 $n_0 = \lceil{n/2}\rceil$。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/06/02/python-测试与调试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/02/python-测试与调试/" itemprop="url">
                  Python 测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-02 09:15:58 / 修改时间：13:22:05" itemprop="dateCreated datePublished" datetime="2019-06-02T09:15:58+08:00">2019-06-02</time>
            

            
              

              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>876 字</span>
              &nbsp; | &nbsp;
              <span>3 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/02/python-测试与调试/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/06/02/python-测试与调试/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/06/02/python-测试与调试/" class="leancloud_visitors" data-flag-title="Python 测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Python-测试框架"><a href="#Python-测试框架" class="headerlink" title="Python 测试框架"></a>Python 测试框架</h1><h2 id="unittest"><a href="#unittest" class="headerlink" title="unittest"></a>unittest</h2><h3 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h3><p>先来看一个最简单的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAdd</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(add(<span class="number">1</span>, <span class="number">2</span>), <span class="number">3</span>)</span><br><span class="line">        self.assertEqual(add(<span class="number">-1</span>, <span class="number">2</span>), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<p>在上面的例子中通过继承 <code>unittest.TestCase</code> 来编写测试类，在测试类中可以使用 <code>unittest</code> 提供的若干方法编写测试用例，最后使用 <code>unittest.main()</code> 运行单元测试。此外也可以使用 <code>python -m unittest test.py</code> 的方式运行测试用例。</p>
<h3 id="初始化与清理现场"><a href="#初始化与清理现场" class="headerlink" title="初始化与清理现场"></a>初始化与清理现场</h3><p>在一些测试中，需要提前配置一些信息，例如创建某个特性的被测试对象，这个时候可以使用 <code>unittest</code> 提供的 <code>setUp</code> 函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WidgetTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.widget = Widget(<span class="string">'The widget'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_default_widget_size</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(self.widget.size(), (<span class="number">50</span>,<span class="number">50</span>),</span><br><span class="line">                         <span class="string">'incorrect default size'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.widget.dispose()</span><br></pre></td></tr></table></figure>
<p>上面一个来自 <code>Python</code> 官方文档的样例代码，其中 <code>setUp</code> 用于在测试开始前做一些准备工作，<code>tearDown</code> 是测试结束后的清理工作，例如测试失败时程序就会终止运行，这个时候可以通过添加 <code>tearDown</code> 方法释放系统资源。</p>
<h3 id="测试标准输出"><a href="#测试标准输出" class="headerlink" title="测试标准输出"></a>测试标准输出</h3><p>有些时候希望测试标准输出是否符合某种期望，可以使用上下文管理器（<code>context manager</code>）捕获标准输出。这种方法的本质也是重定向标准输出，使用上下文管理器的好处是不需要在测试结束后还原标准输出，可以避免使用 <code>try...finally</code> 块。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">captured_output</span><span class="params">()</span>:</span></span><br><span class="line">    new_stdout, new_stderr = StringIO(), StringIO()</span><br><span class="line">    old_stdout, old_stderr = sys.stdout, sys.stderr</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sys.stdout, sys.stderr = new_stdout, new_std_err</span><br><span class="line">        <span class="keyword">yield</span> sys.stdout, sys.stderr</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        sys.stdout, sys.stderr = old_stdout, old_stderr</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> captured_output() <span class="keyword">as</span> (out, err):</span><br><span class="line">    foo()</span><br><span class="line"><span class="comment"># This can go inside or outside the `with` block</span></span><br><span class="line">output = out.getvalue().strip()</span><br><span class="line">self.assertEqual(output, <span class="string">'hello world!'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="doctest"><a href="#doctest" class="headerlink" title="doctest"></a>doctest</h2><h2 id="在-notebook-中使用-unittest-和-doctest"><a href="#在-notebook-中使用-unittest-和-doctest" class="headerlink" title="在 notebook 中使用 unittest 和 doctest"></a>在 notebook 中使用 unittest 和 doctest</h2><p>可以在 notebook 中直接使用Python标准测试工具，如doctest或unittest。</p>
<h3 id="Doctest"><a href="#Doctest" class="headerlink" title="Doctest"></a>Doctest</h3><p>在 notebook 的一个方格中定义如下函数和 docstring:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    This is a test:</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add(2, 2)</span></span><br><span class="line"><span class="string">    5</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure>
<p>然后在一个单元格中引入 doctest 库并运行 docstring 中的测试用例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> doctest</span><br><span class="line">doctest.testmod(verbose=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Trying:</span><br><span class="line">    add(2, 2)</span><br><span class="line">Expecting:</span><br><span class="line">    5</span><br><span class="line">**********************************************************************</span><br><span class="line">File &quot;__main__&quot;, line 4, in __main__.add</span><br><span class="line">Failed example:</span><br><span class="line">    add(2, 2)</span><br><span class="line">Expected:</span><br><span class="line">    5</span><br><span class="line">Got:</span><br><span class="line">    4</span><br><span class="line">1 items had no tests:</span><br><span class="line">    __main__</span><br><span class="line">**********************************************************************</span><br><span class="line">1 items had failures:</span><br><span class="line">   1 of   1 in __main__.add</span><br><span class="line">1 tests in 2 items.</span><br><span class="line">0 passed and 1 failed.</span><br><span class="line">***Test Failed*** 1 failures.</span><br></pre></td></tr></table></figure>
<h3 id="Unittest"><a href="#Unittest" class="headerlink" title="Unittest"></a>Unittest</h3><p>在 notebook 的一个方格中定义如下函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure>
<p>引入 unitetest 库，然后定义如下测试类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestNotebook</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(add(<span class="number">2</span>, <span class="number">2</span>), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unittest.main(argv=[<span class="string">''</span>], verbosity=<span class="number">2</span>, exit=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">test_add (__main__.TestNotebook) ... FAIL</span><br><span class="line"></span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_add (__main__.TestNotebook)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;ipython-input-15-4409ad9ffaea&gt;&quot;, line 6, in test_add</span><br><span class="line">    self.assertEqual(add(2, 2), 5)</span><br><span class="line">AssertionError: 4 != 5</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></table></figure>
<h3 id="调式失败测试用例"><a href="#调式失败测试用例" class="headerlink" title="调式失败测试用例"></a>调式失败测试用例</h3><p>在调试失败的测试时，在某个时候停止测试用例的执行并运行调试器通常是有用的。为此，请在希望停止执行的行之前插入 <code>import pdb; pdb.set_trace()</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    This is the test:</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add(2, 2)</span></span><br><span class="line"><span class="string">    5</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">import</span> pdb; pdb.set_trace()</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure>
<p>对于本例，下一次运行 doctest 时，执行将在 return 语句之前停止，Python 调试器(pdb)将启动。您将直接在笔记本中得到一个 pdb 提示符，它将允许您检查 a 和 b 的值，使用 step 和 next 命令等。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://docs.python.org/3/library/unittest.html" target="_blank" rel="noopener">unittest — Unit testing framework</a><br><a href="https://stackoverflow.com/a/17981937" target="_blank" rel="noopener">How to assert output with nosetest/unittest in python?</a><br><a href="https://stackoverflow.com/a/48405555" target="_blank" rel="noopener">Unit tests for functions in a Jupyter notebook?</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/05/28/Ansible-学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/Ansible-学习笔记/" itemprop="url">
                  Ansible 学习笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-28 20:35:32 / 修改时间：22:30:42" itemprop="dateCreated datePublished" datetime="2019-05-28T20:35:32+08:00">2019-05-28</time>
            

            
              

              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>395 字</span>
              &nbsp; | &nbsp;
              <span>1 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/28/Ansible-学习笔记/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/05/28/Ansible-学习笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/28/Ansible-学习笔记/" class="leancloud_visitors" data-flag-title="Ansible 学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Ansible-介绍"><a href="#Ansible-介绍" class="headerlink" title="Ansible 介绍"></a>Ansible 介绍</h2><p>Ansible 是一款运维工具，它基于 ssh，因此不需要在远程机器上安装额外的客户端软件。</p>
<h2 id="Ansible-使用入门"><a href="#Ansible-使用入门" class="headerlink" title="Ansible 使用入门"></a>Ansible 使用入门</h2><h3 id="安装-Ansible"><a href="#安装-Ansible" class="headerlink" title="安装 Ansible"></a>安装 Ansible</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install ansible</span><br></pre></td></tr></table></figure>
<p>Ansible 依赖 Python 和 ssh，服务器端需要安装 ssh 和版本号大于 2.5 的 Python。Ansible 安装完成后，控制端会增加以下几个可执行程序：</p>
<ul>
<li>ansible</li>
<li>ansible-doc</li>
<li>ansible-playbook</li>
<li>ansible-vault</li>
<li>ansible-console</li>
<li>ansible-galaxy</li>
<li>ansible-pull</li>
</ul>
<h3 id="Ansible-的运行环境"><a href="#Ansible-的运行环境" class="headerlink" title="Ansible 的运行环境"></a>Ansible 的运行环境</h3><p>在 /etc/ansible/hosts 文件中配置远程主机的域名或 ip 地址，Ansible 会默认读取该文件获取远程主机列表。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">test</span>]</span><br><span class="line">127.0.0.1</span><br><span class="line">10.102.18.12</span><br></pre></td></tr></table></figure>
<p>还可以在该 hosts 文件中配置用户名和端口号：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">test</span>]</span><br><span class="line">127.0.0.1 ansible_user=root ansible_port=2222</span><br><span class="line">10.102.18.12 ansible_user=root ansible_port=2222</span><br></pre></td></tr></table></figure>
<p>或者在配置文件中对 Ansible 的行为进行配置，配置文件将按照下列顺序进行搜索：</p>
<ul>
<li>ANSIBLE_CONFIG (environment variable if set)</li>
<li>ansible.cfg (in the current directory)</li>
<li>~/.ansible.cfg (in the home directory)</li>
<li>/etc/ansible/ansible.cfg</li>
</ul>
<p>Ansible 会解析上述列表，并使用它找到的第一个配置文件，其他的将会被忽略。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">remote_port=2222</span><br><span class="line">remote_user=root</span><br></pre></td></tr></table></figure>
<h3 id="Ansible-的-ad-hoc-模式"><a href="#Ansible-的-ad-hoc-模式" class="headerlink" title="Ansible 的 ad-hoc 模式"></a>Ansible 的 ad-hoc 模式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible <span class="built_in">test</span> -m ping  <span class="comment"># 测试 ssh 连接</span></span><br><span class="line">ansible <span class="built_in">test</span> -m <span class="built_in">command</span> -a <span class="string">"ps"</span>  <span class="comment"># 远程执行 ps 命令</span></span><br></pre></td></tr></table></figure>
<h3 id="使用-playbook-控制服务器"><a href="#使用-playbook-控制服务器" class="headerlink" title="使用 playbook 控制服务器"></a>使用 playbook 控制服务器</h3><p>使用YAML配置文件编写任务。编写如下 playbook，命名为 test_playbook.yml。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- host:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">copy</span> <span class="string">file</span></span><br><span class="line"><span class="attr">    copy:</span> <span class="string">src=/tmp/data.txt</span> <span class="string">dest=/tmp/data.txt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">change</span> <span class="string">mode</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">dest=/tmp/data.txt</span> <span class="string">mode=500</span> <span class="string">owner=root</span> <span class="string">group=root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">ensure</span> <span class="string">packages</span> <span class="string">installed</span></span><br><span class="line"><span class="attr">    apt:</span> <span class="string">pkg=&#123;&#123;</span> <span class="string">item</span> <span class="string">&#125;&#125;</span> <span class="string">state=present</span></span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">tmux</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">git</span></span><br></pre></td></tr></table></figure>
<p>然后使用 <code>ansible-playbook test_playbook.yml</code> 执行即可。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/05/17/python-容器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/17/python-容器/" itemprop="url">
                  Python 容器
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-17 20:46:04" itemprop="dateCreated datePublished" datetime="2019-05-17T20:46:04+08:00">2019-05-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-02 09:17:51" itemprop="dateModified" datetime="2019-06-02T09:17:51+08:00">2019-06-02</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>968 字</span>
              &nbsp; | &nbsp;
              <span>4 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/17/python-容器/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/05/17/python-容器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/17/python-容器/" class="leancloud_visitors" data-flag-title="Python 容器">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Python-容器"><a href="#Python-容器" class="headerlink" title="Python 容器"></a>Python 容器</h2><p>python 内建的容器数据结构有列表，元组，集合和字典。这四个容器数据结构可以说是 python 编程过程中必不可少的数据类型，合理的选择使用这些数据结构对提升程序性能有很大的帮助。</p>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>关于列表需要知道的特性有：</p>
<ul>
<li>列表是可变的数据结构，可以向列表里插入和删除元素。</li>
<li>列表中可以放任意类型的对象，例如 <code>[1, &#39;a&#39;, [3.14, 0.5]]</code>。</li>
<li>列表的 <code>append()</code> 和无参数的 <code>pop()</code> 方法的时间复杂度是 $O(1)$。</li>
<li>列表的 <code>insert()</code> 操作和带参数的 <code>pop(index)</code> 方法的时间复杂度是 $O(n)$。</li>
<li><code>list.sort(), list.reverse()</code> 是原地排序和翻转的方法；<code>sorted(), reversed()</code> 不改变原有参数，而是将排序和翻转后的结果以新对象返回。</li>
<li>列表比元组占用更多的内存，性能也差于元组。</li>
<li>列表可以当做一个栈结构使用。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : list())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> LOAD_GLOBAL              <span class="number">0</span> (list)</span><br><span class="line">              <span class="number">3</span> CALL_FUNCTION            <span class="number">0</span> (<span class="number">0</span> positional, <span class="number">0</span> keyword pair)</span><br><span class="line">              <span class="number">6</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : [])</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> BUILD_LIST               <span class="number">0</span></span><br><span class="line">              <span class="number">3</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit list()</span><br><span class="line"><span class="number">94.3</span> ns ± <span class="number">4.23</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit []</span><br><span class="line"><span class="number">22.2</span> ns ± <span class="number">2.37</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br></pre></td></tr></table></figure>
<h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><p>关于元组需要知道的特性有：</p>
<ul>
<li>元组是不可变的数据类型，修改元组会引发一个 <code>TypeError</code>。</li>
<li>元组中也可以存储任意类型的对象，但是如果元组中存储了可变的对象，那么它会变得 <code>unhashable</code>，例如 <code>t = (1, &#39;a&#39;, [3])</code>。</li>
<li>元组的成员函数只有 <code>count(), index()</code>。</li>
<li>元组可以作为多返回值，也可以用来批量给变量赋值。</li>
<li>对元组使用 <code>sorted(), reversed()</code> 将会返回一个新列表。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : tuple())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> LOAD_GLOBAL              <span class="number">0</span> (tuple)</span><br><span class="line">              <span class="number">3</span> CALL_FUNCTION            <span class="number">0</span> (<span class="number">0</span> positional, <span class="number">0</span> keyword pair)</span><br><span class="line">              <span class="number">6</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : ())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> BUILD_TUPLE              <span class="number">0</span></span><br><span class="line">              <span class="number">3</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit tuple()</span><br><span class="line"><span class="number">70.1</span> ns ± <span class="number">6.75</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit ()</span><br><span class="line"><span class="number">12.9</span> ns ± <span class="number">0.0309</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">100000000</span> loops each)</span><br></pre></td></tr></table></figure>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>关于集合需要知道的特性有：</p>
<ul>
<li>集合可以用来去重。</li>
<li>集合的内部实现是散列表，查找元素是否在集合中的平均时间复杂度是 $O(1)$。</li>
<li>集合中的对象必须是 <code>hashable</code> 的。</li>
<li>集合不支持索引操作，但可以用 <code>in, not in</code> 判断元素是否在集合内。</li>
</ul>
<h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><p>关于字典需要知道的特性有：</p>
<ul>
<li>字典的键不重复，对同一个键多次进行复制操作只会更新键对应的值。</li>
<li>字典也是由散列表实现的，其查找的平均时间复杂度也是 $O(1)$。</li>
<li>可以使用 <code>sorted()</code> 方法对字典进行排序，但结果会以元组的形式返回。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : dict())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> LOAD_GLOBAL              <span class="number">0</span> (dict)</span><br><span class="line">              <span class="number">3</span> CALL_FUNCTION            <span class="number">0</span> (<span class="number">0</span> positional, <span class="number">0</span> keyword pair)</span><br><span class="line">              <span class="number">6</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : &#123;&#125;)</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> BUILD_MAP                <span class="number">0</span></span><br><span class="line">              <span class="number">3</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit dict()</span><br><span class="line"><span class="number">133</span> ns ± <span class="number">2.95</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit &#123;&#125;</span><br><span class="line"><span class="number">74.6</span> ns ± <span class="number">3.07</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br></pre></td></tr></table></figure>
<h4 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h4><ol>
<li>index = hash(key) &amp; mask  # mask = PyDicMinSize - 1</li>
<li>if slot[index] is empty: slot[index] -&gt; value</li>
<li>else if key is old key: slot[index] -&gt; new value</li>
<li>else find a new index: slot[new index] -&gt; new value</li>
</ol>
<h4 id="查找操作"><a href="#查找操作" class="headerlink" title="查找操作"></a>查找操作</h4><ol>
<li>index = hash(key) &amp; mask  # mask = PyDicMinSize - 1</li>
<li>if slot[index] is empty: raise KeyError</li>
<li>if slot[index] is not empty: return slot[index] if slot[index].key == key else find next slot</li>
<li>find all slot but not find # can this happen???</li>
</ol>
<h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><p>删除时并不进行删除操作，只是把该位置赋一个特殊的值，得到需要优化字典结构的时候（字典剩余空间小于 1/3），才执行真的删除操作，并在扩容后重新调整结构。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/03/28/计算机网络实验——链路层、网络层/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/28/计算机网络实验——链路层、网络层/" itemprop="url">
                  计算机网络实验——链路层、网络层
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-28 21:41:05" itemprop="dateCreated datePublished" datetime="2019-03-28T21:41:05+08:00">2019-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-01 22:58:59" itemprop="dateModified" datetime="2019-04-01T22:58:59+08:00">2019-04-01</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>6.2k 字</span>
              &nbsp; | &nbsp;
              <span>30 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/28/计算机网络实验——链路层、网络层/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/03/28/计算机网络实验——链路层、网络层/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/28/计算机网络实验——链路层、网络层/" class="leancloud_visitors" data-flag-title="计算机网络实验——链路层、网络层">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>实验主要来源于Rechard Stevens 的《TCP/IP illustrated》（《TCP/IP 详解》）卷一和刘超老师的极客时间专栏《趣谈网络协议》，实验网络拓扑基于docker搭建，github地址戳<a href="https://github.com/popsuper1982/tcpipillustrated" target="_blank" rel="noopener">这里</a>。</p>
<p>网络拓扑如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/40-experiment_environment.jpg" title="图1 实验的网络拓扑">
<p>具体的搭建过程可以看刘超老师写的一篇博文：<a href="https://blog.csdn.net/popsuper1982/article/details/79422735" target="_blank" rel="noopener">有了Openvswitch和Docker，终于可以做《TCP/IP详解》的实验了！</a>。</p>
<p>脚本基本上是一键安装运行的，但是有一点要注意，就是下面的命令中，<code>./setupenv.sh</code>后面一定要跟你自己机器的网络接口（否则可能docker容器访问不了外网），例如我的机器是<strong>eth1</strong>，那么就是<code>./setupenv.sh eth1 hub.c.163.com/liuchao110119163/ubuntu:tcpip</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/popsuper1982/tcpipillustrated.git</span><br><span class="line"><span class="built_in">cd</span> tcpipillustrated</span><br><span class="line">docker pull hub.c.163.com/liuchao110119163/ubuntu:tcpip</span><br><span class="line">chmod +x setupenv.sh</span><br><span class="line">./setupenv.sh enp0s3 hub.c.163.com/liuchao110119163/ubuntu:tcpip</span><br></pre></td></tr></table></figure>
<p>如果还有问题欢迎留言交流。</p>
<h2 id="工具介绍"><a href="#工具介绍" class="headerlink" title="工具介绍"></a>工具介绍</h2><h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><h3 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h3><h3 id="scapy"><a href="#scapy" class="headerlink" title="scapy"></a>scapy</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>由于实验机是Ubuntu 14.04，需要使用下列方式安装python3:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you are using Ubuntu 16.10 or newer, then you can easily install Python 3.6 with the following commands:</span></span><br><span class="line"></span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install python3.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># If you’re using another version of Ubuntu (e.g. the latest LTS release), we recommend using the deadsnakes PPA to install Python 3.6:</span></span><br><span class="line"></span><br><span class="line">$ sudo apt-get install software-properties-common</span><br><span class="line">$ sudo add-apt-repository ppa:deadsnakes/ppa</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install python3.6</span><br></pre></td></tr></table></figure>
<p>安装pip：</p>
<blockquote>
<p>Installing with get-pip.py<br>To install pip, securely download get-pip.py:</p>
<p><code>curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</code><br>Then run the following:</p>
<p><code>python get-pip.py</code><br>Warning Be cautious if you are using a Python install that is managed by your operating system or another package manager. get-pip.py does not coordinate with those tools, and may leave your system in an inconsistent state.</p>
</blockquote>
<p>安装scapy：</p>
<p><code>pip3 install scapy</code></p>
<h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><h3 id="ARP实验"><a href="#ARP实验" class="headerlink" title="ARP实验"></a>ARP实验</h3><p>先来简单回顾一下ARP协议，它的全称是Address Resolution Protocol，中文名地址解析协议，作用是进行IP地址到MAC地址的映射。过程可以看下面两张图：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_request.jpg" title="图2 ARP请求">
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_process.jpg" title="图3 ARP的过程">
<p>ARP是基于以太网帧进行封装的，关于ARP协议具体工作与哪一层还有争议，网上一篇<a href="https://blog.csdn.net/ysdaniel/article/details/6785257" target="_blank" rel="noopener">博文</a>这个说法我认为比较合理：</p>
<blockquote>
<p>可以这样说，在OSI模型中ARP协议属于链路层；而在TCP/IP模型中，ARP协议属于网络层。</p>
</blockquote>
<p>不过除了考试做题，这个争议没用什么意义。比较关键的是以太网帧的结构，如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-ethernet_frame_format.jpg" title="图4 以太网帧结构">
<p>ARP包在以太网帧的基础上进行封装，包结构如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_packet_format.jpg" title="图5 ARP包结构">
<p>有了上面的基础，现在可以开始做实验了。</p>
<h4 id="ARPPing实验"><a href="#ARPPing实验" class="headerlink" title="ARPPing实验"></a>ARPPing实验</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.252.13.33</td>
</tr>
</tbody>
</table>
</div>
<p>使用scapy可以很简单的进行ARPPing：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="comment"># `srp` means send and receive packet</span></span><br><span class="line"><span class="comment"># ethernet frame `dst` field is broadcast</span></span><br><span class="line"><span class="comment"># arp packet encapsulated in ethernet frame data</span></span><br><span class="line"><span class="comment"># send arp packet from bsdi to sun</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = srp(Ether(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>) / ARP(pdst=<span class="string">"140.252.13.33"</span>))</span><br><span class="line">Begin emission:</span><br><span class="line">*Finished sending <span class="number">1</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"></span><br><span class="line"><span class="comment"># inspect ans</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans</span><br><span class="line">&lt;Results: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">1</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># from the output of srp we can see that</span></span><br><span class="line"><span class="comment"># a packet was sent and a packet was received</span></span><br><span class="line"><span class="comment"># see ans.summary()</span></span><br><span class="line"><span class="comment"># it was the request and response of a arp process</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">Ether / ARP who has 140.252.13.33 says 140.252.13.35 ==&gt; Ether / ARP is at 86:43:ab:ea:6e:96 says 140.252.13.33</span><br><span class="line"></span><br><span class="line"><span class="comment"># see the content of the ans tuple</span></span><br><span class="line"><span class="comment"># ans[0][0] is the arp request</span></span><br><span class="line"><span class="comment"># ans[0][1] is the arp reply</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>]</span><br><span class="line">(&lt;Ether  dst=ff:ff:ff:ff:ff:ff type=<span class="number">0x806</span> |&lt;ARP  pdst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> |&gt;&gt;,</span><br><span class="line"> &lt;Ether  dst=<span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span> src=<span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> type=<span class="number">0x806</span> |&lt;ARP  hwtype=<span class="number">0x1</span> ptype=<span class="number">0x800</span> hwlen=<span class="number">6</span> plen=<span class="number">4</span> op=<span class="keyword">is</span>-at hwsrc=<span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> psrc=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> hwdst=<span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span> pdst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> |&gt;&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># see the request packet format</span></span><br><span class="line"><span class="comment"># the `dst` field is a broadcast address</span></span><br><span class="line"><span class="comment"># notice that the `type` field is 0x0806</span></span><br><span class="line"><span class="comment"># which means arp</span></span><br><span class="line"><span class="comment"># hwtype(hardware type) value 1 means ethernet</span></span><br><span class="line"><span class="comment"># ptype(protocol type) value 0x0800 means IP</span></span><br><span class="line"><span class="comment"># hwlen should be 6(length of MAC address)</span></span><br><span class="line"><span class="comment"># plen should be 4(length of IP addres)</span></span><br><span class="line"><span class="comment"># op `who-has` means request opreation</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= ff:ff:ff:ff:ff:ff</span><br><span class="line">  src= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">  type= <span class="number">0x806</span></span><br><span class="line"><span class="comment">###[ ARP ]###</span></span><br><span class="line">     hwtype= <span class="number">0x1</span></span><br><span class="line">     ptype= <span class="number">0x800</span></span><br><span class="line">     hwlen= <span class="literal">None</span></span><br><span class="line">     plen= <span class="literal">None</span></span><br><span class="line">     op= who-has</span><br><span class="line">     hwsrc= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">     psrc= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">     hwdst= <span class="literal">None</span></span><br><span class="line">     pdst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># see the reply packet format</span></span><br><span class="line"><span class="comment"># its `dst` field is the `src' filed of request packet</span></span><br><span class="line"><span class="comment"># `type` is also 0x806</span></span><br><span class="line"><span class="comment"># op `is-at` means arp reply</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">1</span>].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">  src= <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span></span><br><span class="line">  type= <span class="number">0x806</span></span><br><span class="line"><span class="comment">###[ ARP ]###</span></span><br><span class="line">     hwtype= <span class="number">0x1</span></span><br><span class="line">     ptype= <span class="number">0x800</span></span><br><span class="line">     hwlen= <span class="number">6</span></span><br><span class="line">     plen= <span class="number">4</span></span><br><span class="line">     op= <span class="keyword">is</span>-at</span><br><span class="line">     hwsrc= <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span></span><br><span class="line">     psrc= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">     hwdst= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">     pdst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br></pre></td></tr></table></figure>
<p>使用tcpdump在sun端进行抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -i select interface</span></span><br><span class="line"><span class="comment"># -n do not resolve IP address</span></span><br><span class="line">root@70aa710235b6:$ tcpdump -i eth1 -n</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">00:35:44.116294 ARP, Request who-has 140.252.13.33 tell 140.252.13.35, length 42</span><br><span class="line">00:35:44.116317 ARP, Reply 140.252.13.33 is-at 86:43:ab:ea:6e:96, length 28</span><br><span class="line"></span><br><span class="line"><span class="comment"># add -vv</span></span><br><span class="line">root@70aa710235b6:$ tcpdump -i eth1 -n -vv</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">00:50:14.050065 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.33 tell 140.252.13.35, length 42</span><br><span class="line">00:50:14.050087 ARP, Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.33 is-at 86:43:ab:ea:6e:96, length 28</span><br></pre></td></tr></table></figure>
<p>本实验使用scapy构造并发送了一个简单的ARP包，并在目标主机使用tcpdump进行了抓包操作。主要是为了对ARP协议的功能和包结构有一个直观的认识。完整的ARPPing实际可以一次性对一个网段内的所有主机进行进行Ping测试，scapy代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arp ping to subnet 140.252.13.32-63</span></span><br><span class="line"><span class="comment"># net 140.252.13.32</span></span><br><span class="line"><span class="comment"># mask 255.255.255.224</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = srp(Ether(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)/ARP(pdst=<span class="string">"140.252.13.32/27"</span>),</span><br><span class="line">                     timeout=<span class="number">2</span>)</span><br><span class="line">Begin emission:</span><br><span class="line">**Finished sending <span class="number">32</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">2</span> packets, got <span class="number">2</span> answers, remaining <span class="number">30</span> packets</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">Ether / ARP who has 140.252.13.33 says 140.252.13.35 ==&gt; Ether / ARP is at 86:43:ab:ea:6e:96 says 140.252.13.33</span><br><span class="line">Ether / ARP who has 140.252.13.34 says 140.252.13.35 ==&gt; Ether / ARP is at 22:8a:5c:68:86:ec says 140.252.13.34</span><br></pre></td></tr></table></figure>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/arpping.jpg" title="图6 ARPPing 140.252.13.32/27">
<p>结合实验拓扑可以看出结果符合预期。子网140.252.13.32/27可以表示为140.252.13.001 00000，bsdi主机的一个网卡接口的IP地址为140.252.13.001 00011，sun主机的一个网卡接口的IP地址140.252.13.33/27表示为140.252.13.001 00001，svr4主机的一个网卡接口的IP地址可以表示为140.252.13.001 00010，根据子网划分的规则可以看出bsdi、sun和svr4都属于同一个子网。而主机slip的网卡接口的IP地址表示为140.252.13.010 00001，不属于子网140.252.13.001 00000。因此从bsdi发起的ARPPing应该能收到sun和svr4的ARP响应，但是收不到slip的ARP响应。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">140.252.13.32/27</th>
<th style="text-align:center">140.252.13.001 00000</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.252.32.35/27</td>
<td style="text-align:center">140.242.13.001 00011</td>
</tr>
<tr>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.252.32.33/27</td>
<td style="text-align:center">140.252.13.001 00001</td>
</tr>
<tr>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.32.34/27</td>
<td style="text-align:center">140.252.13.001 00010</td>
</tr>
<tr>
<td style="text-align:center">slip</td>
<td style="text-align:center">140.252.32.65/27</td>
<td style="text-align:center">140.252.13.010 00001</td>
</tr>
</tbody>
</table>
</div>
<h4 id="使用telnet连接无效服务器"><a href="#使用telnet连接无效服务器" class="headerlink" title="使用telnet连接无效服务器"></a>使用telnet连接无效服务器</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.13.34</td>
</tr>
</tbody>
</table>
</div>
<p>从bsdi向svr4发起telnet连接，再svr4使用tcpdump抓包。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ telnet 140.252.13.34 22</span><br><span class="line">Trying 140.252.13.34...</span><br><span class="line">Connected to 140.252.13.34.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.6</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># svr4</span></span><br><span class="line">root@6b628ae5483f:$ tcpdump -i eth1 -n -vv arp</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">12:38:25.752415 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.34 tell 140.252.13.35, length 28</span><br><span class="line">12:38:25.752433 ARP, Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.34 is-at 22:8a:5c:68:86:ec, length 28</span><br><span class="line">12:38:30.763321 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.35 tell 140.252.13.34, length 28</span><br><span class="line">12:38:30.763927 ARP, Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.35 is-at 02:1c:55:0e:bb:87, length 28</span><br></pre></td></tr></table></figure>
<p>本实验说明再进行上层通信前需要先获取局域网内主机的MAC地址。</p>
<p>查看一下bsdi的ARP缓存，可以看到bsdi已经将svr4的MAC地址加入了缓存中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@d70675fa03bc:$ arp -n</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">140.252.13.34            ether   22:8a:5c:68:86:ec   C                     eth1</span><br><span class="line">140.252.13.65                    (incomplete)                              bsdiside</span><br><span class="line">140.252.13.33                    (incomplete)                              eth1</span><br></pre></td></tr></table></figure>
<h4 id="使用telnet连接不存在主机"><a href="#使用telnet连接不存在主机" class="headerlink" title="使用telnet连接不存在主机"></a>使用telnet连接不存在主机</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">????</td>
<td style="text-align:center">140.252.13.36</td>
</tr>
</tbody>
</table>
</div>
<p>注意<strong>目的主机不存在</strong>，根据网络号和子网号所对应的网络确实存在，但是并不存在所指定的主机号。从图1可以看出，主机号从36到62的主机并不存在（主机号为63是广播地址）。这里用主机号36来举例。使用一个shell发起telnet连接：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ date; telnet 140.252.13.36;date</span><br><span class="line">Fri Mar 29 12:51:34 UTC 2019</span><br><span class="line">Trying 140.252.13.36...</span><br><span class="line">telnet: Unable to connect to remote host: No route to host</span><br><span class="line">Fri Mar 29 12:51:37 UTC 2019</span><br></pre></td></tr></table></figure>
<p>另一个shell使用tcpdump进行抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ tcpdump -i eth1 -n -vv</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">12:51:34.301832 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.36 tell 140.252.13.35, length 28</span><br><span class="line">12:51:35.299308 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.36 tell 140.252.13.35, length 28</span><br><span class="line">12:51:36.299308 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.36 tell 140.252.13.35, length 28</span><br></pre></td></tr></table></figure>
<p>可以看出这里ARP请求重发了三次，说明ARP请求是有重传机制的，重传的间隔约为1s。</p>
<blockquote>
<p>注意，在线路上始终看不到TCP的报文段。我们能看到的是ARP请求。直到ARP回答返回时，TCP报文段才可以被发送，因为硬件地址到这时才可能知道。如果我们用过滤模式运行tcpdump命令，只查看TCP数据，那么将没有任何输出。</p>
</blockquote>
<h4 id="ARP代理"><a href="#ARP代理" class="headerlink" title="ARP代理"></a>ARP代理</h4><blockquote>
<p>ARP代理也称作混合ARP（promiscuousARP）或ARP出租(ARP hack)。这些名字来自于ARP代理的其他用途：<strong>通过两个物理网络之间的路由器可以互相隐藏物理网络。</strong>在这种情况下，两个物理网络可以使用相同的网络号，只要把中间的路由器设置成一个ARP代理，以响应一个网络到另一个网络主机的ARP请求。这种技术在过去用来隐藏一组在不同物理电缆上运行旧版TCP/IP的主机。分开这些旧主机有两个共同的理由，其一是它们不能处理子网划分，其二是它们使用旧的广播地址（所有比特值为0的主机号，而不是目前使用的所有比特值为1 的主机号）。<br>如果ARP请求是从一个网络的主机发往另一个网络上的主机，那么连接这两个网络的路由器就可以回答该请求，这个过程称作委托ARP或ARP代理(Proxy ARP)。这样可以欺骗发起ARP请求的发送端，使它误以为路由器就是目的主机，而事实上目的主机是在路由器的“另一边”。路由器的功能相当于目的主机的代理，把分组从其他主机转发给它。</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">gemini</td>
<td style="text-align:center">140.252.1.11</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.242.13.33</td>
</tr>
</tbody>
</table>
</div>
<p>实验拓扑如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_proxy.jpeg" title="图7 代理ARP">
<p>如图1所示，系统sun与两个以太网相连。但是事实上并不是这样，在sun和子网140.252.1之间实际存在一个路由器，就是这个具有ARP代理功能的路由器使得sun就好像在子网140.252.1上一样。具体安置如图7所示，路由器Telebit NetBlazer，取名为netb，在子网和主机sun之间。</p>
<blockquote>
<p>当子网140.252.1（称作gemini）上的其他主机有一份IP数据报要传给地址为140.252.1.29的sun时，gemini比较网络号（140.252）和子网号（1），因为它们都是相同的，因而在图7上面的以太网中发送IP地址140.252.1.29的ARP请求。路由器netb识别出该IP地址属于它的一个拔号主机，于是把它的以太网接口地址140.252.1作为硬件地址来回答。主机gemini通过以太网发送IP数据报到netb，netb通过拨号SLIP链路把数据报转发到sun。这个过程对于所有140.252.1子网上的主机来说都是透明的，主机sun实际上是在路由器netb后面进行配置的。</p>
</blockquote>
<p>从主机gemini向主机sun发起ssh连接，分别在gemini（右上）、netb（左下）和sun（右下）进行抓包。</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/arp_proxy.png" title="图8 代理ARP实验">
<p>完成操作后查看gemini的ARP缓存：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@07928580bdcd:$ arp -n</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">140.252.1.29             ether   32:3a:6f:<span class="built_in">cd</span>:a7:24   C                     eth1</span><br><span class="line">140.252.1.4              ether   c6:74:e6:3b:dd:e6   C                     eth1</span><br><span class="line">140.252.1.183            ether   32:3a:6f:<span class="built_in">cd</span>:a7:24   C                     eth1</span><br></pre></td></tr></table></figure>
<p>经过与主机sun通信以后，发现在同一个子网140.252.1上的netb和sun的IP地址映射的硬件地址是相同的。这通常是使用委托ARP的线索。netb作为ARP代理，使得sun就像是子网140.252.1的一部分一样。</p>
<h3 id="IP实验"><a href="#IP实验" class="headerlink" title="IP实验"></a>IP实验</h3><h4 id="bsdi向sun发送数据包"><a href="#bsdi向sun发送数据包" class="headerlink" title="bsdi向sun发送数据包"></a>bsdi向sun发送数据包</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.252.13.33</td>
</tr>
</tbody>
</table>
</div>
<p>在主机bsdi使用scapy构建IP数据包，并发送到sun：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet = IP(dst=<span class="string">"140.252.13.33"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet.show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="literal">None</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="literal">None</span></span><br><span class="line">  id= <span class="number">1</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= hopopt</span><br><span class="line">  chksum= <span class="literal">None</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">  \options\</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(packet)</span><br></pre></td></tr></table></figure>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/IPHeader.jpeg" title="图9 IP包结构">
<p>对比scapy中打印的结果和图9中IP包的结构可以看出构造的IP包可以不用填写每一个字段，也就是说可以使用scapy构造不完整甚至有问题的IP数据包在网络中传输。</p>
<p>在sun使用tcpdump进行抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sun</span></span><br><span class="line"><span class="comment"># -i 用于指定接口</span></span><br><span class="line"><span class="comment"># -nn 不进行IP到域名和服务到端口的转换</span></span><br><span class="line">root@70aa710235b6:$ tcpdump -i eth1 -nn</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">14:10:19.512733 IP 140.252.13.35 &gt; 140.252.13.33:  ip-proto-0 0</span><br><span class="line">14:10:19.512771 IP 140.252.13.33 &gt; 140.252.13.35: ICMP 140.252.13.33 protocol 0 unreachable,length 28</span><br></pre></td></tr></table></figure>
<p>由于这个IP包没有特定的接收目标，sun端返回了一个协议不可达的ICMP报文。在bsdi端抓取该ICMP报文：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = sniff(timeout=<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.summary()</span><br><span class="line">Ether / ARP who has <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> says <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> / Padding</span><br><span class="line">Ether / ARP <span class="keyword">is</span> at <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> says <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">Ether / <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> &gt; <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> hopopt / Padding</span><br><span class="line">Ether / IP / ICMP <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> &gt; <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> dest-unreach protocol-unreachable / IPerror</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res[ICMP][<span class="number">0</span>]</span><br><span class="line">&lt;Ether  dst=<span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span> src=<span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> type=<span class="number">0x800</span> |</span><br><span class="line">&lt;IP  version=<span class="number">4</span> ihl=<span class="number">5</span> tos=<span class="number">0xc0</span> len=<span class="number">48</span> id=<span class="number">25344</span> flags= frag=<span class="number">0</span> ttl=<span class="number">64</span> proto=icmp chksum=<span class="number">0xe2d0</span> src=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> dst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> |</span><br><span class="line">&lt;ICMP  type=dest-unreach code=protocol-unreachable chksum=<span class="number">0xfcfd</span> reserved=<span class="number">0</span> length=<span class="number">0</span> nexthopmtu=<span class="number">0</span> |</span><br><span class="line">&lt;IPerror  version=<span class="number">4</span> ihl=<span class="number">5</span> tos=<span class="number">0x0</span> len=<span class="number">20</span> id=<span class="number">1</span> flags= frag=<span class="number">0</span> ttl=<span class="number">64</span> proto=hopopt chksum=<span class="number">0x46ad</span> src=<span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> dst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>关于ICMP的详细信息将在ICMP实验中进行介绍。</p>
<h4 id="IP路由选择的实验"><a href="#IP路由选择的实验" class="headerlink" title="IP路由选择的实验"></a>IP路由选择的实验</h4><p>主机选路时的优先级：</p>
<ol>
<li>搜索匹配的主机地址；</li>
<li>搜索匹配的网络地址；</li>
<li>搜索默认表项（默认表项一般在路由表中被指定为一个网络表项，其网络号为0）。</li>
</ol>
<p><strong>TODO:</strong> 这部分内容暂时做不了，但是是很有意义的实验，值得研究。</p>
<h3 id="ICMP实验"><a href="#ICMP实验" class="headerlink" title="ICMP实验"></a>ICMP实验</h3><p>ICMP全称Internet Control Message Protocol，就是互联网控制报文协议。ICMP报文是封装在IP包里面的，它本身非常简单，通常被IP层或更高层的协议使用（UDP和TCP）。ICMP主要分为查询报文和查询报文,其格式如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/7-icmp_packet_format.jpg" title="图10 ICMP报文结构">
<h4 id="ICMP地址掩码请求与应答"><a href="#ICMP地址掩码请求与应答" class="headerlink" title="ICMP地址掩码请求与应答"></a>ICMP地址掩码请求与应答</h4><p>ICMP地址掩码请求用于无盘系统在引导过程中获取自己的子网掩码。</p>
<p>实验过程中发现没有主机会响应该ICMP请求报文，搜索后发现<a href="https://networkengineering.stackexchange.com/a/46589" target="_blank" rel="noopener">stackexchange</a>上的一个答案说该ICMP查询请求已被废弃：</p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc6918" target="_blank" rel="noopener">RFC 6918</a> deprecates several ICMP types:</p>
<p>Alternate Host Address (Type 6)<br>Information Request (Type 15)<br>Information Reply (Type 16)<br>Address Mask Request (Type 17)<br>Address Mask Reply (Type 18)<br>Traceroute (Type 30)<br>Datagram Conversion Error (Type 31)<br>Mobile Host Redirect (Type 32)<br>IPv6 Where-Are-You (Type 33)<br>IPv6 I-Am-Here (Type 34)<br>Mobile Registration Request (Type 35)<br>Mobile Registration Reply (Type 36)<br>Domain Name Request (Type 37)<br>Domain Name Reply (Type 38)<br>SKIP (Type 39)<br>Not a straight answer but probably the best you can get.  </p>
</blockquote>
<h4 id="ICMP时间戳请求与应答"><a href="#ICMP时间戳请求与应答" class="headerlink" title="ICMP时间戳请求与应答"></a>ICMP时间戳请求与应答</h4><p>报文请求结构如图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/icmp_timestamp.png" title="图11 ICMP时间戳请求报文与应答">
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.13.34</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="comment"># define a function to get current time</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">getnow</span><span class="params">()</span>:</span></span><br><span class="line">...:     yy, mm, dd, *_ = time.localtime()</span><br><span class="line">...:     <span class="keyword">return</span> int((time.time() - time.mktime((yy, mm, dd, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))) * <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send and receive icmp timestamp request and reply</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"140.252.13.34"</span>)/ICMP(type=<span class="number">13</span>, ts_ori=getnow()))</span><br><span class="line">Begin emission:</span><br><span class="line">*Finished sending <span class="number">1</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans</span><br><span class="line">&lt;Results: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">1</span> Other:<span class="number">0</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">IP / ICMP 140.252.13.35 &gt; 140.252.13.34 timestamp-request 0 ==&gt; IP / ICMP 140.252.13.34 &gt; 140.252.13.35 timestamp-reply 0</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="literal">None</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="literal">None</span></span><br><span class="line">  id= <span class="number">1</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="literal">None</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.34</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-request</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="literal">None</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.190</span></span><br><span class="line">     ts_rx= <span class="number">15</span>:<span class="number">0</span>:<span class="number">25.317</span></span><br><span class="line">     ts_tx= <span class="number">15</span>:<span class="number">0</span>:<span class="number">25.317</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">1</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="number">5</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="number">40</span></span><br><span class="line">  id= <span class="number">26909</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="number">0xdd7a</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.34</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-reply</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="number">0x541</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.190</span></span><br><span class="line">     ts_rx= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.193</span></span><br><span class="line">     ts_tx= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.193</span></span><br></pre></td></tr></table></figure>
<p>使用ICMP向NTP服务器请求时间戳：</p>
<p><a href="https://www.cnblogs.com/croso/p/6670039.html" target="_blank" rel="noopener">国内常用NTP服务器地址及IP</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="comment"># type 13/14 for request/response</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"cn.pool.ntp.org"</span>)/ICMP(type=<span class="number">13</span>, ts_ori=getnow()))</span><br><span class="line">Begin emission:</span><br><span class="line">Finished sending <span class="number">1</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">IP / ICMP 140.252.13.35 &gt; 119.28.183.184 timestamp-request 0 ==&gt; IP / ICMP 119.28.183.184 &gt;</span><br><span class="line"><span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> timestamp-reply <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="literal">None</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="literal">None</span></span><br><span class="line">  id= <span class="number">1</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="literal">None</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  dst= <span class="number">119.28</span><span class="number">.183</span><span class="number">.184</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-request</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="literal">None</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.294</span></span><br><span class="line">     ts_rx=</span><br><span class="line">     ts_tx=</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">1</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="number">5</span></span><br><span class="line">  tos= <span class="number">0x68</span></span><br><span class="line">  len= <span class="number">40</span></span><br><span class="line">  id= <span class="number">30896</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">43</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="number">0x4dc9</span></span><br><span class="line">  src= <span class="number">119.28</span><span class="number">.183</span><span class="number">.184</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-reply</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="number">0x9b2f</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.294</span></span><br><span class="line">     ts_rx= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.330</span></span><br><span class="line">     ts_tx= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.330</span></span><br></pre></td></tr></table></figure>
<p>在bsdi使用tcpdump抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@d70675fa03bc:$ tcpdump -i eth1 -vv icmp</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">12:36:41.297617 IP (tos 0x0, ttl 64, id 1, offset 0, flags [none], proto ICMP (1), length 40)</span><br><span class="line">    140.252.13.35 &gt; 119.28.183.184: ICMP time stamp query id 0 seq 0, length 20</span><br><span class="line">12:36:41.334079 IP (tos 0x68, ttl 43, id 30896, offset 0, flags [none], proto ICMP (1), length 40)</span><br><span class="line">    119.28.183.184 &gt; 140.252.13.35: ICMP time stamp reply id 0 seq 0: org 12:36:41.294, recv 12:36:41.330, xmit 12:36:41.330, length 20</span><br></pre></td></tr></table></figure>
<h4 id="ICMP端口不可达报文"><a href="#ICMP端口不可达报文" class="headerlink" title="ICMP端口不可达报文"></a>ICMP端口不可达报文</h4><p>它是ICMP目的不可到达报文中的一种，本实验通过人为制造的无效UDP报文查看ICMP差错报文中所附加的信息。</p>
<p>UDP的规则之一是，如果收到一份UDP数据报而目的端口与某个正在使用的进程不相符，那么UDP返回一个ICMP不可达报文。</p>
<p>报文请求结构如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/ICMP_unreachable.png" title="图12 ICMP端口不可达报文">
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.13.34</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ tftp</span><br><span class="line">tftp&gt; connect 140.252.13.34 8888</span><br><span class="line">tftp&gt; get sth</span><br><span class="line">Transfer timed out.</span><br><span class="line"></span><br><span class="line">root@d70675fa03bc:$ tcpdump -i eth1 -nn -v</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">13:08:04.411673 02:1c:55:0e:bb:87 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.34 tell 140.252.13.35, length 28</span><br><span class="line">13:08:04.412015 22:8a:5c:68:86:ec &gt; 02:1c:55:0e:bb:87, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.34 is-at 22:8a:5c:68:86:ec, length 28</span><br><span class="line">13:08:04.412023 02:1c:55:0e:bb:87 &gt; 22:8a:5c:68:86:ec, ethertype IPv4 (0x0800), length 57: (tos 0x0, ttl 64, id 63030, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line">13:08:04.413318 22:8a:5c:68:86:ec &gt; 02:1c:55:0e:bb:87, ethertype IPv4 (0x0800), length 85: (tos 0xc0, ttl 64, id 2041, offset 0, flags [none], proto ICMP (1), length 71)</span><br><span class="line">    140.252.13.34 &gt; 140.252.13.35: ICMP 140.252.13.34 udp port 8888 unreachable, length 51</span><br><span class="line">        (tos 0x0, ttl 64, id 63030, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line">13:08:09.411913 02:1c:55:0e:bb:87 &gt; 22:8a:5c:68:86:ec, ethertype IPv4 (0x0800), length 57: (tos 0x0, ttl 64, id 64140, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line">13:08:09.411979 22:8a:5c:68:86:ec &gt; 02:1c:55:0e:bb:87, ethertype IPv4 (0x0800), length 85: (tos 0xc0, ttl 64, id 2194, offset 0, flags [none], proto ICMP (1), length 71)</span><br><span class="line">    140.252.13.34 &gt; 140.252.13.35: ICMP 140.252.13.34 udp port 8888 unreachable, length 51</span><br><span class="line">        (tos 0x0, ttl 64, id 64140, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line"></span><br><span class="line"><span class="comment"># use scapy sniff ICMP port unreachable packet</span></span><br><span class="line">&gt;&gt;&gt; res = sniff()</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; res</span><br><span class="line">&lt;Sniffed: TCP:0 UDP:5 ICMP:5 Other:4&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; res[ICMP].summary()</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; res[ICMP][0][0].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= 02:1c:55:0e:bb:87</span><br><span class="line">  src= 22:8a:5c:68:86:ec</span><br><span class="line">  <span class="built_in">type</span>= 0x800</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">     version= 4</span><br><span class="line">     ihl= 5</span><br><span class="line">     tos= 0xc0</span><br><span class="line">     len= 71</span><br><span class="line">     id= 46842</span><br><span class="line">     flags=</span><br><span class="line">     frag= 0</span><br><span class="line">     ttl= 64</span><br><span class="line">     proto= icmp</span><br><span class="line">     chksum= 0x8ebe</span><br><span class="line">     src= 140.252.13.34</span><br><span class="line">     dst= 140.252.13.35</span><br><span class="line">     \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">        <span class="built_in">type</span>= dest-unreach</span><br><span class="line">        code= port-unreachable</span><br><span class="line">        chksum= 0x3163</span><br><span class="line">        reserved= 0</span><br><span class="line">        length= 0</span><br><span class="line">        nexthopmtu= 0</span><br><span class="line"><span class="comment">###[ IP in ICMP ]###</span></span><br><span class="line">           version= 4</span><br><span class="line">           ihl= 5</span><br><span class="line">           tos= 0x0</span><br><span class="line">           len= 43</span><br><span class="line">           id= 20498</span><br><span class="line">           flags= DF</span><br><span class="line">           frag= 0</span><br><span class="line">           ttl= 64</span><br><span class="line">           proto= udp</span><br><span class="line">           chksum= 0xb672</span><br><span class="line">           src= 140.252.13.35</span><br><span class="line">           dst= 140.252.13.34</span><br><span class="line">           \options\</span><br><span class="line"><span class="comment">###[ UDP in ICMP ]###</span></span><br><span class="line">              sport= 38693</span><br><span class="line">              dport= 8888</span><br><span class="line">              len= 23</span><br><span class="line">              chksum= 0x7ca0</span><br><span class="line"><span class="comment">###[ Raw ]###</span></span><br><span class="line">                 load= <span class="string">'\x00\x01foo\x00netascii\x00'</span></span><br></pre></td></tr></table></figure>
<p>此处使用了TFTP协议强制生成了一个端口不可达报文，connect命令首先指定要连接的主机名及其端口号，接着用get命令来取文件。在UDP数据报送到svr4之前，要先发送一份ARP请求来确定它的硬件地址，接着返回ARP应答（tcpdump抓取到的前两个数据包），然后才发送UDP数据包，一个ICMP端口不可达差错是立刻返回的。接着又尝试了几次后客户程序才放弃，打印了一个超时的结果。</p>
<blockquote>
<p>ICMP的一个规则是，ICMP差错报文必须包括生成该差错报文的数据报IP首部（包含任何选项），还必须至少包括跟在该IP首部后面的前8个字节。在我们的例子中，<strong>跟在IP首部后面的前8个字节包含UDP的首部</strong>。</p>
</blockquote>
<p>这一点可以从scapy的抓包结果中看出。</p>
<blockquote>
<p>一个重要的事实是包含在UDP首部中的内容是源端口号和目的端口号。就是由于目的端口号（8888）才导致产生了ICMP端口不可达的差错报文。接收ICMP的系统可以根据源端口号来把差错报文与某个特定的用户进程相关联（在本例中是TFTP客户程序）。</p>
<p>导致差错的数据报中的IP首部要被送回的原因是因为IP首部中包含了协议字段，使得ICMP可以知道如何解释后面的8个字节（在本例中是UDP首部）。如果查看TCP首部,可以发现<strong>源端口和目的端口被包含在TCP首部的前8个字节中</strong>。</p>
</blockquote>
<h4 id="ICMP协议不可达报文"><a href="#ICMP协议不可达报文" class="headerlink" title="ICMP协议不可达报文"></a>ICMP协议不可达报文</h4><p>这个实验同IP层的<strong>bsdi向sun发送数据包</strong>实验，此处只研究返回的ICMP报文。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res[ICMP][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">  src= <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span></span><br><span class="line">  type= <span class="number">0x800</span></span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">     version= <span class="number">4</span></span><br><span class="line">     ihl= <span class="number">5</span></span><br><span class="line">     tos= <span class="number">0xc0</span></span><br><span class="line">     len= <span class="number">48</span></span><br><span class="line">     id= <span class="number">25344</span></span><br><span class="line">     flags=</span><br><span class="line">     frag= <span class="number">0</span></span><br><span class="line">     ttl= <span class="number">64</span></span><br><span class="line">     proto= icmp</span><br><span class="line">     chksum= <span class="number">0xe2d0</span></span><br><span class="line">     src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">     dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">     \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">        type= dest-unreach</span><br><span class="line">        code= protocol-unreachable</span><br><span class="line">        chksum= <span class="number">0xfcfd</span></span><br><span class="line">        reserved= <span class="number">0</span></span><br><span class="line">        length= <span class="number">0</span></span><br><span class="line">        nexthopmtu= <span class="number">0</span></span><br><span class="line"><span class="comment">###[ IP in ICMP ]###</span></span><br><span class="line">           version= <span class="number">4</span></span><br><span class="line">           ihl= <span class="number">5</span></span><br><span class="line">           tos= <span class="number">0x0</span></span><br><span class="line">           len= <span class="number">20</span></span><br><span class="line">           id= <span class="number">1</span></span><br><span class="line">           flags=</span><br><span class="line">           frag= <span class="number">0</span></span><br><span class="line">           ttl= <span class="number">64</span></span><br><span class="line">           proto= hopopt</span><br><span class="line">           chksum= <span class="number">0x46ad</span></span><br><span class="line">           src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">           dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">           \options\</span><br></pre></td></tr></table></figure>
<p>因为这个错误是网络层的错误，没有和特定的进程产生关联，所以ICMP报文中只有出错IP报文的信息，而不像上一个实验中既有网络层的出错信息，也有传输层的出错信息。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过使用docker搭建的实验环境，我尝试复现一些《TCP/IP 详解》卷一中的例子，并将这些例子的构造方法和网络流信息进行记录，主要是数据链路层和网络层的例子。并在进行实验的过程中熟悉了scapy和tcpdump等工具的一些基本用法。</p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a href="http://www.52im.net/topic-tcpipvol1.html" target="_blank" rel="noopener">《TCP/IP 详解》卷一</a><br><a href="https://docs.python-guide.org/" target="_blank" rel="noopener">The Hitchhiker’s Guide to Python!</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2018/10/13/Linux生存指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/13/Linux生存指南/" itemprop="url">
                  Linux生存指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-13 20:43:41" itemprop="dateCreated datePublished" datetime="2018-10-13T20:43:41+08:00">2018-10-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-08 13:17:45" itemprop="dateModified" datetime="2019-07-08T13:17:45+08:00">2019-07-08</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>3.4k 字</span>
              &nbsp; | &nbsp;
              <span>15 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/13/Linux生存指南/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/10/13/Linux生存指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/10/13/Linux生存指南/" class="leancloud_visitors" data-flag-title="Linux生存指南">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用linux过程中最基本、最常用的命令、工具记录。</p>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><ul>
<li>ls - List directory contenets</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示所有文件，包括隐藏文件</span></span><br><span class="line">ls -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以详细信息显示所有文件，搭配 -a 显示所有文件的详细信息</span></span><br><span class="line">ls -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以人类可读的文件大小显示文件</span></span><br><span class="line">ls -lh</span><br></pre></td></tr></table></figure>
<ul>
<li>cd - Change current working directory</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到指定文件夹</span></span><br><span class="line"><span class="built_in">cd</span> /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到当前用户的家目录</span></span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一级目录</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到之前的目录</span></span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure>
<ul>
<li>mkdir - Create a directory</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个文件夹</span></span><br><span class="line">mkdir directory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归的创建目录</span></span><br><span class="line">mkdir -p /path/to/directory</span><br></pre></td></tr></table></figure>
<ul>
<li>rm - Remove files or directoreis</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：使用rm删除的文件（夹）无法还原</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除文件</span></span><br><span class="line">rm filename</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归删除文件夹</span></span><br><span class="line">rm -r folder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制删除一个文件夹(慎用)</span></span><br><span class="line">rm -rf folder</span><br></pre></td></tr></table></figure>
<ul>
<li>mv - Move or rename files and directories</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -v for verbose, -i for interactive</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名文件（夹）</span></span><br><span class="line">mv name1 name2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动文件（夹）</span></span><br><span class="line">mv /path/from/name /path/to/name</span><br></pre></td></tr></table></figure>
<ul>
<li>cp - Copy files or folders</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -r for recursively, -v for verbose, -i for interactive, name can be changed</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制文件（夹）</span></span><br><span class="line">cp /path/from/name /path/to/name</span><br></pre></td></tr></table></figure>
<ul>
<li>cat - Print and concatenate files</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示文件内容</span></span><br><span class="line">cat filename</span><br></pre></td></tr></table></figure>
<ul>
<li>adduser - User addition utility</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个新用户，并创建默认的用户家目录，提示用户设置密码</span></span><br><span class="line">adduser username</span><br><span class="line"></span><br><span class="line"><span class="comment"># useradd username 只创建一个用户，别的啥都不干</span></span><br></pre></td></tr></table></figure>
<ul>
<li>usermod - Modifies a user account.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将一个用户添加到sudo组</span></span><br><span class="line">usermod -aG sudo user <span class="comment"># 其中a:表示添加，G：指定组名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户从sudo组移除</span></span><br><span class="line">usermod -G group user</span><br></pre></td></tr></table></figure>
<ul>
<li>chown - Change user and group ownership of files and folders.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改变 file/folder 的所有者:</span></span><br><span class="line">    chown user path/to/file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变 file/folder 的所有者和组:</span></span><br><span class="line">    chown user:group path/to/file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归的改变所有者:</span></span><br><span class="line">    chown -R user path/to/folder</span><br></pre></td></tr></table></figure>
<ul>
<li>chmod - Change the access permissions of a file or directory.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 给定拥有文件的 [u]ser 执行文件的权限:</span></span><br><span class="line">    chmod u+x file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 赋予文件执行的权限</span></span><br><span class="line">    chmod +x file</span><br></pre></td></tr></table></figure>
<h2 id="高阶命令"><a href="#高阶命令" class="headerlink" title="高阶命令"></a>高阶命令</h2><ul>
<li>find - Find files or directories under the given directory tree, recursively.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据名称查找文件，支持正则表达式</span></span><br><span class="line">find path -name given_name</span><br></pre></td></tr></table></figure>
<ul>
<li>grep -  Matches patterns in input text</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前目录下的所有包含py的文件</span></span><br><span class="line">ls -al | grep py</span><br></pre></td></tr></table></figure>
<ul>
<li>ps - Information about running processes.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Search for a process that matches a string</span></span><br><span class="line">ps aux | grep string</span><br></pre></td></tr></table></figure>
<ul>
<li>kill - Sends a signal to a process, usually related to stopping the process.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 杀死一个进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 PID</span><br></pre></td></tr></table></figure>
<ul>
<li>管道: |;  重定向: &gt; &gt;&gt;; 通配符: * ? [] . ^ $</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 管道将上一个命令的输出作为下一条目录的输入</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取passwd文件里和root有关的内容</span></span><br><span class="line">cat /etc/passwd | grep root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重定向: &gt; 覆盖; &gt;&gt; 追加</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello"</span> &gt; <span class="built_in">test</span></span><br><span class="line">$ cat <span class="built_in">test</span></span><br><span class="line">hello</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"world"</span> &gt; <span class="built_in">test</span></span><br><span class="line">$ cat <span class="built_in">test</span></span><br><span class="line">world</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello"</span> &gt;&gt; <span class="built_in">test</span></span><br><span class="line">$ cat <span class="built_in">test</span></span><br><span class="line">world</span><br><span class="line">hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通配符</span></span><br><span class="line"><span class="comment"># *  任意字符任意次</span></span><br><span class="line"><span class="comment"># ?  任意字符一次</span></span><br><span class="line"><span class="comment"># [] 可匹配字符在的任意一个</span></span><br></pre></td></tr></table></figure>
<h1 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h1><h2 id="创建用户并添加到sudo用户组"><a href="#创建用户并添加到sudo用户组" class="headerlink" title="创建用户并添加到sudo用户组"></a>创建用户并添加到sudo用户组</h2><h3 id="创建用户及其目录"><a href="#创建用户及其目录" class="headerlink" title="创建用户及其目录"></a>创建用户及其目录</h3><p>创建一个用户jc 这个用户只能在/home/jc上面增加删除文件， jc不能在其他目录加减文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useradd -d /home/jc -m jc</span><br><span class="line">passwd jc</span><br><span class="line">chown jc -R /home/jc</span><br><span class="line"></span><br><span class="line"><span class="comment"># adduser 也可以</span></span><br></pre></td></tr></table></figure>
<h3 id="将用户添加到sudo目录"><a href="#将用户添加到sudo目录" class="headerlink" title="将用户添加到sudo目录"></a>将用户添加到sudo目录</h3><p>通过命令： id username<br>来查看用户信息</p>
<p>安装ubuntu时，创建了一个普通用户，没有sudo权限，执行sudo相关命令失败，原因该普通用户没有加到超级用户组，</p>
<p>使用如下命令可以添加到用户组（也可是超级用户组）。</p>
<p>命令如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG sudo username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其中a:表示添加，G：指定组名</span></span><br></pre></td></tr></table></figure>
<h2 id="远程登录和复制文件"><a href="#远程登录和复制文件" class="headerlink" title="远程登录和复制文件"></a>远程登录和复制文件</h2><h3 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h3><ul>
<li>远程登录即通过 SSH 客户端链接运行了 SSH 服务器的远程机器上。</li>
<li>SSH 是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议。<ul>
<li>有效防止远程管理过程中的信息泄露。</li>
<li>对所有传输的数据进行加密，也能防止 DNS 欺骗和 IP 欺骗。</li>
</ul>
</li>
<li>SSH 客户端是一种使用 Secure Shell 协议连接到远程计算机的软件程序。</li>
<li>SSH 客户端简单使用访问服务器：ssh [-p port] user@remote<ul>
<li>user 是远程机器上的用户名。</li>
<li>remote 是远程机器地址，可为 IP、域名或别名。</li>
<li>port 是 SSH 服务器监听的端口，若不指定端口默认为 22。</li>
</ul>
</li>
</ul>
<h3 id="远程复制文件"><a href="#远程复制文件" class="headerlink" title="远程复制文件"></a>远程复制文件</h3><p>SCP 即 Secure Copy，是一个在 Linux 下用来进行 远程拷贝文件 的命令。</p>
<h4 id="从本地复制文件到远程机器桌面上"><a href="#从本地复制文件到远程机器桌面上" class="headerlink" title="从本地复制文件到远程机器桌面上"></a>从本地复制文件到远程机器桌面上</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -P sample.py user@remote:Desktop/sample.py</span><br></pre></td></tr></table></figure>
<h4 id="从远程机器桌面上复制文件夹到本地上"><a href="#从远程机器桌面上复制文件夹到本地上" class="headerlink" title="从远程机器桌面上复制文件夹到本地上"></a>从远程机器桌面上复制文件夹到本地上</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -P port -r user@remote:Desktop/sample ~/Desktop/sample</span><br></pre></td></tr></table></figure>
<h2 id="ssh-高级用法"><a href="#ssh-高级用法" class="headerlink" title="ssh 高级用法"></a>ssh 高级用法</h2><h3 id="免密码登录"><a href="#免密码登录" class="headerlink" title="免密码登录"></a>免密码登录</h3><p>免密码登录：即客户端访问服务端时，需要密码验证身份登录。</p>
<ul>
<li>Step.01. 配置公钥：执行 ssh-keygen 即生成 SSH 密钥。</li>
<li>Step.02. 上传公钥到服务器：执行 ssh-copy-id -p port user@remote，让远程服务器记住我们的 公钥。可能需要使用 -i 指定公钥位置：ssh-copy-id -i ~/.ssh/id_rsa.pub user@remote.</li>
</ul>
<blockquote>
<p>1) 有关 SSH 配置信息都保存在 /Home/yousr username/.ssh 目录下。<br>2) 免密登录使用的是非对称加密算法 ( RSA )，即使用公钥加密的数据，需要使用私钥解密；使用私钥加密的数据，需要使用公钥解密。</p>
</blockquote>
<h3 id="配置别名"><a href="#配置别名" class="headerlink" title="配置别名"></a>配置别名</h3><p>配置别名：每次输入 ssh -p port user@remote 是非常繁琐重复的工作，配置别名的方式以替代上述这么一串命令代码。</p>
<ul>
<li>在 /.ssh/config 文件下追加以下内容 ( 需建立 Config 文件 )：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host mac</span><br><span class="line">HostName 192.168.10.1</span><br><span class="line">User user</span><br><span class="line">Port 22</span><br></pre></td></tr></table></figure>
<p>命令输入 ssh mac 即可实现远程登录操作 ( SCP 同样原理 )。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -P 22 -r ~/Desktop/Sample mac:Desktop/Sample</span><br></pre></td></tr></table></figure>
<h1 id="shell-相关操作"><a href="#shell-相关操作" class="headerlink" title="shell 相关操作"></a>shell 相关操作</h1><h2 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h2><p><code>bash</code> 是大多数 linux 系统默认的登录 shell。由于 <code>zshrc</code> 是兼容 <code>bash</code> 的，因此配置的相关内容统一放到介绍 <code>zshrc</code> 的时候。这里主要介绍一下几个常用的 <code>bash</code> 配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash</span><br><span class="line">       The bash executable</span><br><span class="line">/etc/profile</span><br><span class="line">       The systemwide initialization file, executed for login shells</span><br><span class="line">~/.bash_profile</span><br><span class="line">       The personal initialization file, executed for login shells</span><br><span class="line">~/.bashrc</span><br><span class="line">       The individual per-interactive-shell startup file</span><br><span class="line">~/.bash_logout</span><br><span class="line">       The individual login shell cleanup file, executed when a login shell exits</span><br><span class="line">~/.inputrc</span><br><span class="line">       Individual readline initialization file</span><br></pre></td></tr></table></figure>
<h2 id="fish"><a href="#fish" class="headerlink" title="fish"></a><a href="http://fishshell.com/" target="_blank" rel="noopener">fish</a></h2><p><a href="https://github.com/fish-shell/fish-shell" target="_blank" rel="noopener">github-repository</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>ubuntu</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-add-repository ppa:fish-shell/release-3</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install fish</span><br></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>配置非常方便，先在命令行中输入 <code>fish</code> 切换shell为 <code>fish</code> ，然后图形界面下会显示一个http的链接，点击进入该链接进行相应配置即可。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fish_config</span><br></pre></td></tr></table></figure>
<img src="/2018/10/13/Linux生存指南/fish_config.png">
<p>基本上 <code>fish</code> 是一个开箱即用的shell，几乎不进行配置即可使用，但是 <code>fish</code> 和 <code>bash</code> 不兼容，所以稍加配置的 <code>zsh</code> 是更好的选择。</p>
<h2 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h2><p>ubuntu 下安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install zsh</span><br></pre></td></tr></table></figure>
<p>修改默认登录 shell</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认 shell</span></span><br><span class="line">$ cat /etc/shells</span><br><span class="line"><span class="comment"># /etc/shells: valid login shells</span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/bin/rbash</span><br><span class="line">/bin/dash</span><br><span class="line">/usr/bin/tmux</span><br><span class="line">/usr/bin/fish</span><br><span class="line">/bin/zsh</span><br><span class="line">/usr/bin/zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换登录 shell 为 zsh</span></span><br><span class="line">$ chsh -s /bin/zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以通过 echo $SHELL 查看当前默认的 Shell，如果没有改为 /bin/zsh，那么需要重启 Shell。</span></span><br></pre></td></tr></table></figure>
<p>安装 Oh My Zsh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Oh My Zsh</span></span><br><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</span><br><span class="line"><span class="comment"># 以上命令可能不好使，可使用如下两条命令</span></span><br><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh</span><br><span class="line">bash ./install.sh</span><br></pre></td></tr></table></figure>
<p>安装插件</p>
<p>在 <code>.zshrc</code> 中配置要安装的插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Which plugins would you like to load?</span></span><br><span class="line"><span class="comment"># Standard plugins can be found in ~/.oh-my-zsh/plugins/*</span></span><br><span class="line"><span class="comment"># Custom plugins may be added to ~/.oh-my-zsh/custom/plugins/</span></span><br><span class="line"><span class="comment"># Example format: plugins=(rails git textmate ruby lighthouse)</span></span><br><span class="line"><span class="comment"># Add wisely, as too many plugins slow down shell startup.</span></span><br><span class="line">plugins=(</span><br><span class="line">  git </span><br><span class="line">  git-open</span><br><span class="line">  vi-mode</span><br><span class="line">  extract</span><br><span class="line">  zsh-autosuggestions</span><br><span class="line">  zsh-syntax-highlighting</span><br><span class="line">  web-search</span><br><span class="line">  autojump</span><br><span class="line">  wd</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git open</span></span><br><span class="line">npm install --global git-open</span><br><span class="line"></span><br><span class="line"><span class="comment"># autojump</span></span><br><span class="line">git <span class="built_in">clone</span> git://github.com/wting/autojump.git</span><br><span class="line"><span class="built_in">cd</span> autojump</span><br><span class="line">./install.py or ./uninstall.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># add following line to .zshrc</span></span><br><span class="line">[[ -s /home/username/.autojump/etc/profile.d/autojump.sh ]] &amp;&amp; <span class="built_in">source</span> /home/username/.autojump/etc/profile.d/autojump.sh</span><br><span class="line"><span class="built_in">autoload</span> -U compinit &amp;&amp; compinit -u</span><br></pre></td></tr></table></figure>
<p>遇到的问题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Warning: plugin zsh-syntax-highlighting not found</span><br><span class="line">Warning: plugin zsh-autosuggestions not found</span><br><span class="line"></span><br><span class="line"><span class="comment"># I solve it by the command :</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting</span><br><span class="line"></span><br><span class="line"><span class="comment"># on-my-zsh check if the plugin is exit at '$base_dir/plugins/$name/$name.plugin.zsh' or '$base_dir/plugins/$name/_$name' , so the plugin should be at this path .</span></span><br></pre></td></tr></table></figure>
<h2 id="xonsh"><a href="#xonsh" class="headerlink" title="xonsh"></a>xonsh</h2><h1 id="git-相关操作"><a href="#git-相关操作" class="headerlink" title="git 相关操作"></a>git 相关操作</h1><h2 id="git-新建仓库并推送到远程分支"><a href="#git-新建仓库并推送到远程分支" class="headerlink" title="git 新建仓库并推送到远程分支"></a>git 新建仓库并推送到远程分支</h2><p>问题描述：在github上新建了仓库，如何将本地仓库推送到远程仓库?</p>
<p>解决方法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"# repository name"</span> &gt;&gt; README.md</span><br><span class="line">git init <span class="comment"># 初始化仓库</span></span><br><span class="line">git add README.md <span class="comment"># add the README.md file</span></span><br><span class="line">git commit -m <span class="string">"first commit"</span></span><br><span class="line">git remote add origin git@github.com:username/repository_name.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>
<p>git 远程仓库相关的常用命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出每一个指定的远程服务器简写</span></span><br><span class="line">$ git remote</span><br><span class="line">origin <span class="comment"># git 给每个仓库初始的简写</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示读写仓库使用的简写和其对应的&lt;url&gt;</span></span><br><span class="line">$ git remote -v</span><br><span class="line">origin https://github.com/schacon/ticgit (fetch)</span><br><span class="line">origin https://github.com/schacon/ticgit (push)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一个新的远程 Git 仓库，同时指定仓库&lt;url&gt;为一个你可以轻松引用的简写&lt;shortname&gt;。</span></span><br><span class="line"><span class="comment"># git remote add &lt;shortname&gt; &lt;url&gt;</span></span><br><span class="line">$ git remote</span><br><span class="line">origin</span><br><span class="line">$ git remote add pb https://github.com/paulboone/ticgit</span><br><span class="line">$ git remote -v</span><br><span class="line">origin https://github.com/schacon/ticgit (fetch)</span><br><span class="line">origin https://github.com/schacon/ticgit (push)</span><br><span class="line">pb https://github.com/paulboone/ticgit (fetch)</span><br><span class="line">pb https://github.com/paulboone/ticgit (push)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从远程仓库抓取和拉取</span></span><br><span class="line"><span class="comment"># git fetch [remote-name]</span></span><br><span class="line">$ git fetch origin <span class="comment"># git fetch 不会自动合并或修改当前的工作</span></span><br><span class="line">$ git pull <span class="comment"># 抓取数据并自动尝试合并</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送到远程仓库</span></span><br><span class="line">$ git push origin master</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看远程仓库</span></span><br><span class="line">$ git remote show origin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名远程仓库</span></span><br><span class="line">$ git remote rename pb paul</span><br><span class="line">$ git remote</span><br><span class="line">origin</span><br><span class="line">paul</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程仓库</span></span><br><span class="line">$ git remote rm paul</span><br><span class="line">$ git remote</span><br><span class="line">origin</span><br></pre></td></tr></table></figure>
<h1 id="工具部分"><a href="#工具部分" class="headerlink" title="工具部分"></a>工具部分</h1><h2 id="命令行辅助"><a href="#命令行辅助" class="headerlink" title="命令行辅助"></a>命令行辅助</h2><h3 id="tldr"><a href="#tldr" class="headerlink" title="tldr"></a><a href="http://tldr-pages.github.io/" target="_blank" rel="noopener">tldr</a></h3><p><a href="https://github.com/tldr-pages/tldr" target="_blank" rel="noopener">github-repository</a></p>
<blockquote>
<p>A collection of simplified and community-driven man pages.</p>
</blockquote>
<img src="/2018/10/13/Linux生存指南/tldr.png">
<p><code>github</code>主页提供了多种客户端实现，这里介绍<code>python</code>和<code>c++</code>客户端：</p>
<ul>
<li>python</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tldr-python-client: pip install tldr</span><br><span class="line">tldr.py: pip install tldr.py</span><br></pre></td></tr></table></figure>
<p><code>python</code>客户端安装简易，但是性能好像有些问题，查询速度很慢。</p>
<ul>
<li>c++</li>
</ul>
<p><code>c++</code>客户端通过源码编译的方式进行安装。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tldr-pages/tldr-cpp-client.git tldr-c-client</span><br><span class="line"><span class="built_in">cd</span> tldr-c-client</span><br><span class="line"></span><br><span class="line">./deps.sh           <span class="comment"># install dependencies</span></span><br><span class="line">make                <span class="comment"># build tldr</span></span><br><span class="line">make install        <span class="comment"># install tldr</span></span><br></pre></td></tr></table></figure>
<p>性能很棒。</p>
<h3 id="cheat"><a href="#cheat" class="headerlink" title="cheat"></a><a href="https://github.com/cheat/cheat" target="_blank" rel="noopener">cheat</a></h3><p>作用类似于 tldr，不过更具有定制性，通过使用它可以制作一套属于自己的命令提示工具。</p>
<p>使用 <code>pip</code> 安装即可：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[sudo] pip install cheat</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cheat</span><br><span class="line"></span><br><span class="line">Create and view cheatsheets on the <span class="built_in">command</span> line.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  cheat &lt;cheatsheet&gt;</span><br><span class="line">  cheat -e &lt;cheatsheet&gt;</span><br><span class="line">  cheat -s &lt;keyword&gt;</span><br><span class="line">  cheat -l</span><br><span class="line">  cheat -d</span><br><span class="line">  cheat -v</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -d --directories  List directories on <span class="variable">$CHEAT_PATH</span></span><br><span class="line">  -e --edit         Edit cheatsheet</span><br><span class="line">  -l --list         List cheatsheets</span><br><span class="line">  -s --search       Search cheatsheets <span class="keyword">for</span> &lt;keyword&gt;</span><br><span class="line">  -v --version      Print the version number</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line"></span><br><span class="line">  To view the `tar` cheatsheet:</span><br><span class="line">    cheat tar</span><br><span class="line"></span><br><span class="line">  To edit (or create) the `foo` cheatsheet:</span><br><span class="line">    cheat -e foo</span><br><span class="line"></span><br><span class="line">  To list all available cheatsheets:</span><br><span class="line">    cheat -l</span><br><span class="line"></span><br><span class="line">  To search <span class="keyword">for</span> <span class="string">"ssh"</span> among all cheatsheets:</span><br><span class="line">    cheat -s ssh</span><br></pre></td></tr></table></figure>
<h3 id="tig"><a href="#tig" class="headerlink" title="tig"></a><a href="https://github.com/jonas/tig" target="_blank" rel="noopener">tig</a></h3><p>命令行界面的 git 客户端。</p>
<p>通过源码编译安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> http://github.com/jonas/tig</span><br><span class="line">$ <span class="built_in">cd</span> tig</span><br><span class="line">$ make prefix=/usr/<span class="built_in">local</span></span><br><span class="line">...</span><br><span class="line">include/tig/tig.h:93:22: fatal error: curses.h: No such file or directory</span><br><span class="line">compilation terminated.</span><br><span class="line">Makefile:334: recipe <span class="keyword">for</span> target <span class="string">'src/tig.o'</span> failed</span><br><span class="line">make: *** [src/tig.o] Error 1</span><br><span class="line"></span><br><span class="line">$ sudo apt-get install libncurses5-dev libncursesw5-dev</span><br><span class="line">$ make prefix=/usr/<span class="built_in">local</span></span><br><span class="line">$ sudo make install prefix=/usr/<span class="built_in">local</span>() sudo make install prefix=/usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<h3 id="ripgrep"><a href="#ripgrep" class="headerlink" title="ripgrep"></a><a href="https://github.com/BurntSushi/ripgrep" target="_blank" rel="noopener">ripgrep</a></h3><blockquote>
<p>ripgrep recursively searches directories for a regex pattern</p>
</blockquote>
<p>递归的在目录中搜索正则表达式。</p>
<p>安装（ubuntu 18.04）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -LO https://github.com/BurntSushi/ripgrep/releases/download/11.0.1/ripgrep_11.0.1_amd64.deb</span><br><span class="line">$ sudo dpkg -i ripgrep_11.0.1_amd64.deb</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  cpp git:(master) ✗ rg final </span><br><span class="line">modern_cpp/10_final.cpp</span><br><span class="line">2: * 10. final (<span class="keyword">for</span> virtual <span class="keyword">function</span> and <span class="keyword">for</span> class)</span><br><span class="line">5:class Dog final // no class can be derived from dog</span><br><span class="line">12:    virtual void bark() final; // no class can override bark()</span><br></pre></td></tr></table></figure>
<h2 id="网络辅助工具"><a href="#网络辅助工具" class="headerlink" title="网络辅助工具"></a>网络辅助工具</h2><h3 id="proxychains-ng"><a href="#proxychains-ng" class="headerlink" title="proxychains-ng"></a><a href="https://github.com/rofl0r/proxychains-ng" target="_blank" rel="noopener">proxychains-ng</a></h3><p>这个工具使用 <code>HOOK</code> 技术使大多数的命令行工具可以走 socks 或者 http(s) 代理。</p>
<p>安装 proxychains-ng：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/rofl0r/proxychains-ng.git</span><br><span class="line">$ <span class="built_in">cd</span> proxychains-ng</span><br><span class="line">$ ./configure --prefix=/usr --sysconfdir=/etc</span><br><span class="line">$ sudo make install  <span class="comment"># install proxychains4</span></span><br><span class="line">$ proxychains4</span><br><span class="line"></span><br><span class="line">Usage:  proxychains4 -q -f config_file program_name [arguments]</span><br><span class="line">        -q makes proxychains quiet - this overrides the config setting</span><br><span class="line">        -f allows one to manually specify a configfile to use</span><br><span class="line">        <span class="keyword">for</span> example : proxychains telnet somehost.com</span><br><span class="line">More <span class="built_in">help</span> <span class="keyword">in</span> README file</span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make install-config  <span class="comment"># install proxychains.conf (/etc/proxychains.conf)</span></span><br><span class="line">$ sudo vim /etc/proxychains.conf</span><br><span class="line"></span><br><span class="line">[ProxyList]</span><br><span class="line"><span class="comment"># add proxy here ...</span></span><br><span class="line"><span class="comment"># meanwile</span></span><br><span class="line"><span class="comment"># defaults set to "tor"</span></span><br><span class="line"><span class="comment"># socks4        127.0.0.1 9050</span></span><br><span class="line">socks5  127.0.0.1 1080</span><br><span class="line"></span><br><span class="line">$ vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> pc=<span class="string">"proxychains4"</span> </span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pc sudo apt install thefuck</span><br><span class="line">$ pc wget bing.com</span><br></pre></td></tr></table></figure>
<h3 id="syncthing"><a href="#syncthing" class="headerlink" title="syncthing"></a><a href="https://github.com/syncthing/syncthing" target="_blank" rel="noopener">syncthing</a></h3><p>一个跨平台的分布式同步工具。</p>
<p>安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for ubuntu</span></span><br><span class="line"><span class="comment"># Add the release PGP keys:</span></span><br><span class="line">$ curl -s https://syncthing.net/release-key.txt | sudo apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the "stable" channel to your APT sources:</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"deb https://apt.syncthing.net/ syncthing stable"</span> | sudo tee /etc/apt/sources.list.d/syncthing.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Update and install syncthing:</span></span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install syncthing</span><br></pre></td></tr></table></figure>
<h2 id="Blog-相关"><a href="#Blog-相关" class="headerlink" title="Blog 相关"></a>Blog 相关</h2><h3 id="nvm"><a href="#nvm" class="headerlink" title="nvm"></a><a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener">nvm</a></h3><p>Node 版本管理工具——一个简单的 bash 脚本，用于管理多个活动的 Node.js 版本。</p>
<p>安装和更新：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># or wget</span></span><br><span class="line">$ wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># or ansible playbook</span></span><br><span class="line">- name: nvm</span><br><span class="line">  shell: &gt;</span><br><span class="line">    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span><br><span class="line">  args:</span><br><span class="line">    creates: <span class="string">"&#123;&#123; ansible_env.HOME &#125;&#125;/.nvm/nvm.sh"</span></span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install node</span></span><br><span class="line">$ nvm install node <span class="comment"># "node" is an alias for the latest version</span></span><br><span class="line">$ nvm install 6.14.4 <span class="comment"># or 10.10.0, 8.9.1, etc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list available versionss</span></span><br><span class="line">$ nvm ls-remote</span><br><span class="line"></span><br><span class="line"><span class="comment"># use installed version</span></span><br><span class="line">$ nvm use node</span><br></pre></td></tr></table></figure>
<h3 id="cnpm"><a href="#cnpm" class="headerlink" title="cnpm"></a><a href="https://npm.taobao.org/" target="_blank" rel="noopener">cnpm</a></h3><p>淘宝的 npm 镜像。</p>
<p>安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># or alias it in .bashrc or .zshrc</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'\n#alias for cnpm\nalias cnpm="npm --registry=https://registry.npm.taobao.org \</span></span><br><span class="line"><span class="string">  --cache=$HOME/.npm/.cache/cnpm \</span></span><br><span class="line"><span class="string">  --disturl=https://npm.taobao.org/dist \</span></span><br><span class="line"><span class="string">  --userconfig=$HOME/.cnpmrc"'</span> &gt;&gt; ~/.zshrc &amp;&amp; <span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install [name]</span><br></pre></td></tr></table></figure>
<h3 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a><a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">hexo</a></h3><p>一个快速、简洁和高效的博客框架。</p>
<p>安装和使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-cli -g</span><br><span class="line">$ hexo init blog</span><br><span class="line">$ <span class="built_in">cd</span> blog</span><br><span class="line">$ npm install</span><br><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/u011774239/article/details/48463393" target="_blank" rel="noopener">ubuntu 下给用户添加 sudo 权限，并且如何取消 sudo 权限</a><br><a href="http://blog.sina.com.cn/s/blog_47051c800100oegn.html" target="_blank" rel="noopener">linux 下创建用户并且限定用户主目录</a><br><a href="https://stackoverflow.com/a/416931" target="_blank" rel="noopener">几种 bash 配置文件</a><br><a href="https://www.cyberciti.biz/faq/linux-error-cursesh-no-such-file-directory/" target="_blank" rel="noopener">Linux Error: curses.h: No such file or directory Problem Solution</a><br><a href="https://github.com/robbyrussell/oh-my-zsh/issues/7688" target="_blank" rel="noopener">Warning: plugin zsh-syntax-highlighting not found #7688</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/" itemprop="url">
                  深入理解计算机系统（一）——计算机系统漫游
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-27 21:12:02" itemprop="dateCreated datePublished" datetime="2018-09-27T21:12:02+08:00">2018-09-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-04 17:43:49" itemprop="dateModified" datetime="2019-06-04T17:43:49+08:00">2019-06-04</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>1.7k 字</span>
              &nbsp; | &nbsp;
              <span>5 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/" class="leancloud_visitors" data-flag-title="深入理解计算机系统（一）——计算机系统漫游">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote><p>系统中的所有信息——包括磁盘文件、内存中的程序和用户数据以及网络中传输的数据，都是由一串比特表示的。</p>
</blockquote>
<h2 id="编译系统"><a href="#编译系统" class="headerlink" title="编译系统"></a>编译系统</h2><p>编译系统由四部分组成：</p>
<ul>
<li>预处理器</li>
<li>编译器</li>
<li>汇编器</li>
<li>连接器</li>
</ul>
<h2 id="系统的硬件组成"><a href="#系统的硬件组成" class="headerlink" title="系统的硬件组成"></a>系统的硬件组成</h2><ol>
<li><p>总线</p>
<p> 贯穿整个系统的是<strong>一组电子管道</strong>，称作总线，它携带信息字节并负责在各个部件间传递。通常总线被设计成传送<strong>定长</strong>的字节快，也就是<strong>字(word)</strong>。字中的字节数（即字长）是一个基本的系统参数，各个系统中都不尽相同。</p>
</li>
<li><p>I/O 设备</p>
<p> I/O设备是系统与外部世界联系的通道。每个I/O设备都通过一个 <strong>控制器</strong> 或者 <strong>适配器</strong> 与I/O总线相连。区别主要在它们的封装方式。控制器是I/O设备本身或者主板上的芯片组。而适配器则是一块插在主板插槽上的卡。它们的功能都是 <strong>在I/O总线和I/O设备间传递信息</strong>。</p>
</li>
<li><p>主存</p>
<p> 主存是一个临时的存储设备，在处理器执行程序时，用来 <strong>存放程序和程序处理的数据</strong>。也就是说，当一个程序在运行时，首先会将自身加载到内存中去。从 <strong>物理上来讲</strong> ，主存是由一组动态随机存储器（DRAM）芯片组成的。从 <strong>逻辑上讲</strong> ，存储器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引），这些地址是从零开始的。</p>
</li>
<li><p>处理器</p>
<p> 中央处理单元（CPU），简称处理器，是解释（或执行）存储在主存中指令的引擎。处理器的核心是大小为一个字的存储设备（或寄存器），称为程序计数器（PC）。在任何时刻，PC都指向主存中的某条机器语言指令（即含有该条指令的地址）。<br> 从系统通电开始，直到系统断电，处理器一直在不断地执行程序计数器指向的指令，再更新程序计数器，使其指向下一条指令。处理器从程序计数器指向的内存中读取指令，解释指令中的位，执行该指令指示的简单操作，然后更新PC，使其指向下一条指令，这条指令并不一定和在内存中刚刚执行的指令相邻。他们围绕着 <strong>主存、寄存器文件（register file）和算数/逻辑单元（ALU）进行。</strong> 寄存器文件是一个小的存储设备，由一些单个字长的寄存器组成，每个寄存器都有唯一的名字。ALU计算新的数据和地址值。下面是一些简单操作的例子，CPU在指令的要求下可能会执行这些操作。</p>
<ul>
<li>加载：主存 ——&gt; 寄存器，覆盖寄存器原来的内容。</li>
<li>存储：寄存器 ——&gt; 主存，覆盖这个地址上原来的内容。</li>
<li>操作：把两个寄存器的内容复制到ALU，ALU对这两个字做算术运算，并将结果放到一个寄存器中，覆盖该寄存器中原来的内容。</li>
<li>跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖（PC）中原来的值。</li>
</ul>
</li>
</ol>
<h2 id="高速缓存"><a href="#高速缓存" class="headerlink" title="高速缓存"></a>高速缓存</h2><p>系统花费了大量时间把信息从一个地方搬到另一个地方。</p>
<p><strong>局部性原理</strong>：程序具有访问局部区域里的数据和代码的趋势。</p>
<p>意识到高速缓存存储器存在的应用程序员能够利用告诉缓存将程序的性能提高一个数量级。</p>
<p>在处理器和一个较大较慢的设备（例如主存）间插入一个更小更快的存储设备（例如高速缓存）的想法已经称为一个普遍的观念。</p>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>操作系统可以被视作应用程序和底层硬件间的一层软件。所有应用程序对硬件的尝试都必须经过操作系统。</p>
<p>操作系统有两个基本功能：（1）防止硬件被失控的应用程序滥用;（2）向应用程序提供简单一致的机制来控制复杂而通常又大不相同的低级硬件设备。操作系统通过几个基本的抽象概念（ <strong>进程、虚拟内存和文件</strong> ）来实现这两个功能。文件是对I/O设备的抽象表示，虚拟内存是对主存和磁盘I/O设备的抽象表示，进程则是对处理器、主存和I/O设备的抽象表示。</p>
<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>进程是操作系统对一个正在运行的程序的一种抽象。</p>
<p>操作系统中进程交错执行的机制称为上下文切换。 <strong>上下文切换</strong>是指操作系统保存当前进程上下文（PC和寄存器文件的当前值，以及主存中的内容）、恢复新进程的上下文，然后将控制权传递给新进程，新进程就会从它上传停止的地方开始。</p>
<p>内核不是一个独立的进程，相反它是系统管理全部进程所用代码和数据结构的集合。</p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>一个进程实际上由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。</p>
<h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><p>虚拟内存是一个抽象概念，它为每个进程提供了一个假象，即每个进程都在独占的使用主存。每个进程看到的内存都是一致的，称为虚拟地址空间。</p>
<p>每个进程看到的虚拟地址空间由大量准确定义的区构成，每个区都有专门的功能。</p>
<p>虚拟内存的运作需要硬件和操作系统之间精密复杂的交互，包括对处理器生成的每个地址的硬件翻译。基本思想是把一个进程虚拟内存的内容存储在磁盘上，然后用主存作为磁盘的高速缓存。</p>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><p>文件就是字节序列，仅此而已。每个I/O设备，包括磁盘、键盘、显示器，甚至网络，都可以看成是文件。系统中的所有输入输出都是通过使用一小组称为Unix I/O的系统函数调用读写文件来实现的。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2018/09/22/gdb教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/22/gdb教程/" itemprop="url">
                  gdb教程「翻译」
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-22 10:09:15" itemprop="dateCreated datePublished" datetime="2018-09-22T10:09:15+08:00">2018-09-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-01 22:26:37" itemprop="dateModified" datetime="2019-04-01T22:26:37+08:00">2019-04-01</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>3k 字</span>
              &nbsp; | &nbsp;
              <span>11 min</span>
            </span>
          

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/翻译/" itemprop="url" rel="index"><span itemprop="name">翻译</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/22/gdb教程/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/09/22/gdb教程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/09/22/gdb教程/" class="leancloud_visitors" data-flag-title="gdb教程「翻译」">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>原文<a href="https://www.cs.cmu.edu/~gilpin/tutorial/" target="_blank" rel="noopener">Debugging Under Unix: gdb Tutorial</a></p>
</blockquote>
<p><strong>在Unix 下调试： gdb 教程</strong></p>
<p>因为最近做了一个项目需要在linux环境下编译c++程序，于是把源码迁移到了Ubuntu，然后发现在修改了代码后程序报了Segment Fault的错误。这不通过调试只是静态分析怎么可能找到，于是被逼无奈又只能谷歌大法搜呗…于是就搜到了这篇04年的教程。gdb我之前好奇用了一次，但是完全不知所以，这次跟着这篇教程却算是顺利的入了门。虽然最终bug不是通过gdb找到的，不过为了纪念，还是准备把这篇我认为还不错的教程翻译下来留作纪念。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>本教程最初是为华盛顿大学 CS 342 而撰写。它现在仍旧由 Andrew Gilpin 进行维护。</p>
<h3 id="写给谁看？"><a href="#写给谁看？" class="headerlink" title="写给谁看？"></a>写给谁看？</h3><p>本教程旨在帮助新接触UNIX环境的程序员学习使用gdb调试器。本教程假设你已经能够使用C++编写程序并知道如何编译运行。它还假设你了解关于调试的基础知识，并在其它操作系统中使用过调试器。</p>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>为了阐述调试的原理，我将使用一个有bug的程序作为例子。在你读完本教程后，你将能够使用调试器定位和修复代码中的错误。代码在<a href="https://www.cs.cmu.edu/~gilpin/tutorial/main.cc" target="_blank" rel="noopener">这里</a>下载，以及一个简单的<a href="https://www.cs.cmu.edu/~gilpin/tutorial/Makefile" target="_blank" rel="noopener">Makefile</a>。</p>
<p>代码非常简单，包含一个节点和一个链表的定义。这也是测试列表的一个简单开始。为了能够更容易的阐述调试的过程，所有的代码被放在了一个文件中。</p>
<p><strong>注意:</strong> 由于代码比较久远，其中有一些需要修改的地方，一份<a href="https://raw.githubusercontent.com/callmexss/callmexss.github.io/blog/source/_posts/gdb%E6%95%99%E7%A8%8B/main.cc" target="_blank" rel="noopener">修改后的代码</a>放到github仓库中了。Makefile比较短，贴在这里学习一下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CXX = g++ <span class="comment"># 指定编译器</span></span><br><span class="line">FLAGS = -ggdb -Wall <span class="comment"># 使用调试模式</span></span><br><span class="line"></span><br><span class="line">main: main.cc <span class="comment"># 函数入口点</span></span><br><span class="line">  <span class="variable">$&#123;CXX&#125;</span> <span class="variable">$&#123;FLAGS&#125;</span> -o main main.cc <span class="comment"># 编译命令</span></span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">  rm -f main <span class="comment"># 删除链接文件</span></span><br></pre></td></tr></table></figure>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><p>gdb包含在CEC（没查到是什么…）机器的GNU包中。如果你没有加载这个包，在命令行输入<code>pkgadd gnu</code>。如果你可以运行g++，那么你就可以运行gdb。（没有gdb环境的使用包管理工具安装一下。）</p>
<h3 id="调试符号"><a href="#调试符号" class="headerlink" title="调试符号"></a>调试符号</h3><p>gdb只能作用于由g++产生的调试符号。对于SUN CC的用户，有一个和gdb很相似的替代品叫做dbx调试器。</p>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><h3 id="什么时候该使用调试器"><a href="#什么时候该使用调试器" class="headerlink" title="什么时候该使用调试器"></a>什么时候该使用调试器</h3><p>调试是编程过程中不可避免的。每一个程序员在他们的编程生涯中都将会有某个时刻需要使用调试器调试一段代码。有许多调试的方法，从在屏幕上打印信息，到使用调试器，或者只是思考程序在干什么，并对问题是什么进行有根据的猜测。修复一个bug前，必须先定位bug的位置。例如，在段错误中，知道在哪一行产生段错误是非常有用的。一旦出问题的代码被找到了，知道那个方法中的数值、谁调用了那个方法、以及为什么这个错误会发生都将是有帮助的。使用调试器会使找到这些信息变得十分简单。</p>
<p>继续阅读本教程并使用make编译以及运行这个程序。本程序将会打印出一些信息，然后会打印它出现了一个段错误，导致程序崩溃。仅根据屏幕上显示的信息，几乎不可能找到程序崩溃的原因，更不用说修复这个程序了。我们现在将开始调试这个程序。</p>
<h3 id="加载程序"><a href="#加载程序" class="headerlink" title="加载程序"></a>加载程序</h3><p>现在你有一个了一个可执行文件（本例中是main）然后你想调试它。首先你必须运行调试器，调试器叫做gdb，你必须在命令行中告诉他你想要调试哪一个程序。所以为了调试我们输入 <code>gdb main</code> 。这里是运行后可能出现的样子：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">agg1@sukhoi agg1/.www-docs/tutorial&gt; gdb main</span><br><span class="line">GNU gdb 4.18</span><br><span class="line">Copyright 1998 Free Software Foundation, Inc.</span><br><span class="line">GDB is free software, covered by the GNU General Public License, and you are</span><br><span class="line">welcome to change it and/or distribute copies of it under certain conditions.</span><br><span class="line">Type <span class="string">"show copying"</span> to see the conditions.</span><br><span class="line">There is absolutely no warranty <span class="keyword">for</span> GDB.  Type <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"sparc-sun-solaris2.7"</span>...</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>一段关于emacs的内容就跳过了。</p>
<p>gdb 现在等着接收用户指令。我们需要运行程序，这样gdb可以帮助我们观察程序崩溃时到底发生了什么。在gdb命令行中输入 <code>run</code>。这里是输入 <code>run</code> 后发生的事情：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/cec/s/a/agg1/.www-docs/tutorial/main</span><br><span class="line">Creating Node, 1 are <span class="keyword">in</span> existence right now</span><br><span class="line">Creating Node, 2 are <span class="keyword">in</span> existence right now</span><br><span class="line">Creating Node, 3 are <span class="keyword">in</span> existence right now</span><br><span class="line">Creating Node, 4 are <span class="keyword">in</span> existence right now</span><br><span class="line">The fully created list is:</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">Now removing elements:</span><br><span class="line">Creating Node, 5 are <span class="keyword">in</span> existence right now</span><br><span class="line">Destroying Node, 4 are <span class="keyword">in</span> existence right now</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">Node&lt;int&gt;::next (this=0x0) at main.cc:28</span><br><span class="line">28  Node&lt;T&gt;* next () const &#123; <span class="built_in">return</span> next_; &#125;</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>程序崩溃了，让我们来看看从输入结果中我们能收集到哪些信息。</p>
<p><strong>注意：</strong> 调试的程序一定是编译好的二进制文件。</p>
<h3 id="检查崩溃"><a href="#检查崩溃" class="headerlink" title="检查崩溃"></a>检查崩溃</h3><p>我们现在可以看到程序在main.cc的第28行，<code>this</code>指针指向0，这行代码正在被执行。但我们还想知道是谁调用了这个方法，以及调用方法中的值是什么,所以在gdb命令行中输入<code>backtrace</code>,得到如下输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) backtrace</span><br><span class="line"><span class="comment">#0  Node&lt;int&gt;::next (this=0x0) at main.cc:28</span></span><br><span class="line"><span class="comment">#1  0x2a16c in LinkedList&lt;int&gt;::remove (this=0x40160,</span></span><br><span class="line">    item_to_remove=@0xffbef014) at main.cc:77</span><br><span class="line"><span class="comment">#2  0x1ad10 in main (argc=1, argv=0xffbef0a4) at main.cc:111</span></span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>所以除了当前方法和局部变量外，我们还可以知道哪些方法调用了我们以及它们的参数是什么。例如，我们可以看出当前方法是由<code>LinkedList&lt;int&gt;::remove()</code>调用，参数<code>item_to_remove</code>在内存中的地址为<code>0xffbef014</code>。知道<code>item_to_remove</code>的值或许有助于我们理解bug,所以我们想要看到<code>item_to_remove</code>的地址中的值。可以通过使用<code>x + address</code>输入到命令行中查看该变量的值(x可以被理解为examine的简写)。这是输入后的效果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x 0xffbef014</span><br><span class="line">0xffbef014: 0x00000001</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>所以程序实在调用<code>LinkedList&lt;int&gt;::remove</code>方法以及参数为1时崩溃的。我们现在把问题缩小到了一个特定的方法和一个特定的参数。</p>
<h3 id="条件断点"><a href="#条件断点" class="headerlink" title="条件断点"></a>条件断点</h3><p>既然我们已经知道了段错误何时在何处发生，我们想要知道程序在崩溃以前发生了什么。一种方法是使用逐步运行，一次一步,执行程序的全部语句直到执行到我们想要看到的地方。这是有效的，但有时你希望它恰好运行到特定的位置并在那里停止，这样你就可以检测此时的数据。</p>
<p>如果你曾经使用过调试器，那么你或许对断点的概念很熟悉。简单来说，断点就是调试器在源码中应该停止执行的那一行。我们的例子中，我们想要查看<code>LinkedList&lt;int&gt;::remove ()</code>中的代码，所以我们想要在main.cc的第52行中设置断点。因为你可能不知道具体的行号，你也可以告诉调试器你想要设置断点的方法。这是在本例中我们的输入：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> LinkedList&lt;int&gt;::remove</span><br><span class="line">Breakpoint 1 at 0x29fa0: file main.cc, line 52.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>现在断点就如我们所期望的被设置在了main.cc的52行。(断点绑定了一个编号是为了我们之后可以引用它，例如删除这个断点。)每次程序运行时，它会在每次运行到第52行的时候将控制权交还给调试器。当方法会被调用多次但是只会在某个特定的值触发错误时，这样就不优雅了。在本例中，我们知道当参数为1时调用<code>LinkedList&lt;int&gt;::remove()</code>方法会导致程序崩溃。所以我们或许想要告诉调试器在<code>item_to_remove</code>值为1时中断。这可以通过如下命令实现：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) condition 1 item_to_remove==1</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>这等同于告诉调试器“只有在<code>item_to_remove</code>值为1时中断。”现在我们可以运行程序，然后看到调试器只有会在某个特定条件为真时进入断点。</p>
<h3 id="单步运行"><a href="#单步运行" class="headerlink" title="单步运行"></a>单步运行</h3><p>继续上面的例子，我们现在已经设置了一个条件断点，然后让程序每次运行一步，看是否能够定位错误的源头。可以通过<code>step</code>命令完成这个过程。gdb有一个很棒的特性，不输入命令直接按下回车时，会自动执行上一条命令。也就是说，在第一次输入<code>step</code>后我们就可以通过敲击回车让调试器继续执行<code>step</code>命令了。这看起来就像：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 1, LinkedList&lt;int&gt;::remove (this=0x40160,</span><br><span class="line">    item_to_remove=@0xffbef014) at main.cc:52</span><br><span class="line">52     Node&lt;T&gt; *marker = head_;</span><br><span class="line">(gdb) step</span><br><span class="line">53      Node&lt;T&gt; *temp = 0;  // temp points to one behind as we iterate</span><br><span class="line">(gdb)</span><br><span class="line">55      <span class="keyword">while</span> (marker != 0) &#123;</span><br><span class="line">(gdb)</span><br><span class="line">56        <span class="keyword">if</span> (marker-&gt;value() == item_to_remove) &#123;</span><br><span class="line">(gdb)</span><br><span class="line">Node&lt;int&gt;::value (this=0x401b0) at main.cc:30</span><br><span class="line">30    const T&amp; value () const &#123; <span class="built_in">return</span> value_; &#125;</span><br><span class="line">(gdb)</span><br><span class="line">LinkedList&lt;int&gt;::remove (this=0x40160, item_to_remove=@0xffbef014)</span><br><span class="line">    at main.cc:75</span><br><span class="line">75        marker = 0;  // reset the marker</span><br><span class="line">(gdb)</span><br><span class="line">76        temp = marker;</span><br><span class="line">(gdb)</span><br><span class="line">77        marker = marker-&gt;next();</span><br><span class="line">(gdb)</span><br><span class="line">Node&lt;int&gt;::next (this=0x0) at main.cc:28</span><br><span class="line">28    Node&lt;T&gt;* next () const &#123; <span class="built_in">return</span> next_; &#125;</span><br><span class="line">(gdb)</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">Node&lt;int&gt;::next (this=0x0) at main.cc:28</span><br><span class="line">28    Node&lt;T&gt;* next () const &#123; <span class="built_in">return</span> next_; &#125;</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>在键入<code>run</code>后，gdb问我们是否要重新运行程序，我们选择是。然后程序会运行并在我们期望的位置中断。我们输入<code>step</code>和敲击回车使程序单步运行。注意程序会进入到调用的方法中。如果你不希望这样，使用<code>next</code>方法，它会将函数的调用视为一步执行。</p>
<p>程序的错误很明显了。在第75行<code>marker</code>被置为0,但是在第77行<code>marker</code>的一个成员被访问，<strong>访问没有初始化的对象是危险的</strong>。因为程序不能方位地址为0的内存，所以段错误发生了。在这个例子中，在本例中，<code>marker</code>并不用做什么，可以简单的通过移除main.cc的第75行来避免这个错误。</p>
<p>如果你观察程序的输入，你会发现程序会先正常运行一段时间，但是程序中某处会产生内存泄漏。（提示：它就在<code>LinkedList&lt;T&gt;::remove()</code>方法里，某次remove没有正常工作时产生）。这将给读者留作使用调试器定位和修复bug的练习。（我总是喜欢这么说.;）</p>
<p>gdb通过输入<code>quit</code>退出。</p>
<h2 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h2><p>本文档只涉及使用gdb的最小知识。可以通过gdb的manpage或者看<a href="http://sources.redhat.com/gdb/current/onlinedocs/gdb_toc.html" target="_blank" rel="noopener">这份非常长的关于gdb的介绍</a>可以通过在运行gdb时输入<code>help</code>获取在线命令。此外，一如往常，欢迎在新闻组里提问或者在工作时间来问我。</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>上面链表的代码中还有一个未被提到的错误。这个错误在按照原始代码中的顺序添加和移除元素时不会发生，但是在其它顺序下会产生。例如，插入1，2，3，和 4，然后尝试删除2时会产生。非常感谢Linda Gu 和 Xiaofeng Chen发现这个错误。这个bug的修复非常简单，也一并留作额外练习。</li>
<li>特别鸣谢Ximmbo da Jazz修复了一些错别字和错误的输出。</li>
<li>特别鸣谢Raghuprasad Govindarao发现了损坏的链接。</li>
</ul>
<hr>
<p>请将评论，建议和错误报告发送给<a href="mailto:gilpin@cs.cmu.edu" target="_blank" rel="noopener">Andrew Gilpin</a>。<br>页面最后修改时间：2004年4月7日</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="许山山">
            
              <p class="site-author-name" itemprop="name">许山山</p>
              <p class="site-description motion-element" itemprop="description">繁华尘世，时光如沙，轻歌曼舞有时尽。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/callmexss" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:callmexss@126.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">许山山</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">
    <div class="powered-by"></div>
    <span class="post-count">共38.7k字</span>
  </div>
  #<div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Mist</a> v6.4.1</div>





        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: false,
        appId: 'mvmTM6opb6WjC9b5fNkvJr6d-gzGzoHsz',
        appKey: 'q6go6BQInvwQpcLVL64QiKC2',
        placeholder: '说点儿什么吧 ：）',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.4.1"></script>



  

  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { "$in": entries } }) })
        .done(function ({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log("LeanCloud Counter Error: " + responseJSON.code + " " + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "IQEs5IP2iJTi9CBkLTnpKNN3-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "IQEs5IP2iJTi9CBkLTnpKNN3-gzGzoHsz",
                'X-LC-Key': "uRROIGwaWOhMnPAu3IKnGy4K",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          if ($('.post-title-link').length >= 1) {
            showTime(Counter);
          }
          
        })
    });
  </script>



  

  

  
  

  
  
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  

  

  

  

  

  

</body>
</html>
