<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'T2VQGNUUN1',
      apiKey: '7637fb68b08c225b5cf407956a3c51c9',
      indexName: 'blogSearch',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
<meta property="og:type" content="website">
<meta property="og:title" content="像素书">
<meta property="og:url" content="https://callmexss.top/index.html">
<meta property="og:site_name" content="像素书">
<meta property="og:description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="像素书">
<meta name="twitter:description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">



  <link rel="alternate" href="/atom.xml" title="像素书" type="application/atom+xml">




  <link rel="canonical" href="https://callmexss.top/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>像素书</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">像素书</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">叙事诗</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/09/10/趣谈Linux操作系统期末测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/10/趣谈Linux操作系统期末测试/" itemprop="url">
                  趣谈Linux操作系统期末测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-09-10 14:27:13 / 修改时间：22:43:42" itemprop="dateCreated datePublished" datetime="2019-09-10T14:27:13+08:00">2019-09-10</time>
            

            
              

              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>1.2k 字</span>
              &nbsp; | &nbsp;
              <span>4 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/10/趣谈Linux操作系统期末测试/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/09/10/趣谈Linux操作系统期末测试/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/09/10/趣谈Linux操作系统期末测试/" class="leancloud_visitors" data-flag-title="趣谈Linux操作系统期末测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="答题规范"><a href="#答题规范" class="headerlink" title="答题规范"></a>答题规范</h1><p>以下摘自<a href="https://time.geekbang.org/column/intro/164" target="_blank" rel="noopener">趣谈 Linux 操作系统</a>：</p>
<blockquote>
<p>第一，回答尽量体系化。不仅仅回答这个问题的知识点，还可以简单描述一下这个点背后完整的体系，然后根据面试官接下来的追问，更细地描述其他相关的内容。<br>这样做的好处是：一，防止你因为这个点没有回答好而丢分所有的分；二，可以体现你的知识掌握比较全面，可以加分；三，还可以避免冷场和尬聊。<br>面试官开放式的提问，最不想听到的就是“封闭式“回答。有的面试者“惜字如金“，有的人能聊一个小时，有的人不到半个小时就答完了，让面试官没有办法深入全面的了解你。</p>
<p>第二，在体系化的阐述过程中，可以加入一些你使用过的相关工具或者技巧的阐述。例如，操作系统干这个事情有十个步骤。第三步会在某个日志文件里面打印这样的日志，如果发现打印出 xxx 说明可能有错误，第七步可以通过某个命令行查看某某状态，等等。诸如此类，可以让面试官感觉到你是实战派而非理论派。</p>
<p>第三，在体系化的阐述过程中，如果能加入一些项目经验就更好了。例如，在第九个步骤，当时在做某项目的时候，因为客户现场的版本问题，导致了什么结果，最后如何进行解决的等等。<br>我刚才说了，面试官问问题的时候，脑子里都是有实际工作场景的。如果你能把他带到你的工作场景里面，有利于面试官对你当时的情形感同身受，你的分数自然不会很低。</p>
</blockquote>
<p>因为对操作系统的理解确实还不够，所以本次考试采取开卷考试的形式，并且卷面内容会不断更新迭代，以上。</p>
<h1 id="开始考试"><a href="#开始考试" class="headerlink" title="开始考试"></a>开始考试</h1><h2 id="说一下操作系统启动和初始化的过程"><a href="#说一下操作系统启动和初始化的过程" class="headerlink" title="说一下操作系统启动和初始化的过程"></a>说一下操作系统启动和初始化的过程</h2><img src="/2019/09/10/趣谈Linux操作系统期末测试/q1.jpg">
<p>在面试中遇到这个问题我会使用从整体到细节的答题思路，首先回答最接近人类思维的过程：</p>
<img src="/2019/09/10/趣谈Linux操作系统期末测试/boot.png" title="启动的过程">
<img src="/2019/09/10/趣谈Linux操作系统期末测试/init.png" title="初始化的过程">
<p>然后再回答每一个过程中的细节。</p>
<h3 id="BIOS-时期"><a href="#BIOS-时期" class="headerlink" title="BIOS 时期"></a>BIOS 时期</h3><p>在按下电源键以后，主板就加电了。主板上的 <strong>ROM</strong>（Read Only Memory，只读存储器）中固化了一些初始化的程序 —— <strong>BIOS</strong>（Basic Input Output System），与平时说的内存 <strong>RAM</strong>（Random Access Memory，随机存取存储器）不同，ROM 是只读的，而 RAM 是可读可写的。</p>
<p>在 x86 系统中，将 1M 空间最上面的 0xF0000 到 0xFFFFF 这 64K 映射给 ROM。电脑刚加电的时候会做一些重置工作，将 CS 设置为 0xFFFF，将 IP 设置为 0x0000，所以第一条指令就会指向 0xFFFF0（CS 左移一位或 IP），这个地址正好在 ROM 的范围里。这里有一个 JMP 指令会跳转到 ROM 中做初始化工作的代码，于是 BIOS 开始进行初始化代码工作。</p>
<img src="/2019/09/10/趣谈Linux操作系统期末测试/x86-1m.jpeg">
<p>这个过程主要做了三件事：</p>
<ol>
<li>BIOS 自检，检查硬件是否正常，如果异常会通过蜂鸣声或者键盘指示灯来发出警告；</li>
<li>建立中断向量表和中断服务程序，使用键盘、鼠标都需要触发中断；</li>
<li>内存空间映射显存空间，在显示器上显示一些字符。</li>
</ol>
<img src="/2019/09/10/趣谈Linux操作系统期末测试/bios.jpeg">
<h3 id="bootloader-时期"><a href="#bootloader-时期" class="headerlink" title="bootloader 时期"></a>bootloader 时期</h3><p>想要初始化操作系统，首先需要找到操作系统在哪里。在 BIOS 的界面上，可以看到不同的启动项，BIOS 按照这个顺序，把控制权交给排在第一位的存储设备。这时，计算机读取该设备的第一个扇区，也就是读取最前面的 512 个字节。如果这 512 个字节的最后两个字节是 0x55 和 0xAA，表明这个设备可以用于启动；如果不是，表明设备不能用于启动，控制权于是被转交给”启动顺序”中的下一个设备。</p>
<p>这最前面的 512 个字节，就是 <strong>MBR</strong>（Master boot record，主引导记录）。</p>
<p>“主引导记录”只有512个字节，放不了太多东西。它的主要作用是，告诉计算机到硬盘的哪一个位置去找操作系统。</p>
<p>主引导记录由三个部分组成：</p>
<p>　　（1） 第1-446字节：调用操作系统的机器码。</p>
<p>　　（2） 第447-510字节：分区表（Partition table）。</p>
<p>　　（3） 第511-512字节：主引导记录签名（0x55和0xAA）。</p>
<img src="/2019/09/10/趣谈Linux操作系统期末测试/boot.jpeg">
<h1 id="是结束也是开始"><a href="#是结束也是开始" class="headerlink" title="是结束也是开始"></a>是结束也是开始</h1><h1 id="站在巨人的肩膀上"><a href="#站在巨人的肩膀上" class="headerlink" title="站在巨人的肩膀上"></a>站在巨人的肩膀上</h1><ol>
<li><a href="https://time.geekbang.org/column/intro/164" target="_blank" rel="noopener">趣谈Linux操作系统</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/02/booting.html" target="_blank" rel="noopener">计算机是如何启动的？</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/08/linux_boot_process.html" target="_blank" rel="noopener">Linux 的启动流程</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/" itemprop="url">
                  一些能够提高工作效率的绝密 VS Code 奇淫巧计「翻译」
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-09-08 23:20:13" itemprop="dateCreated datePublished" datetime="2019-09-08T23:20:13+08:00">2019-09-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-09-12 23:02:02" itemprop="dateModified" datetime="2019-09-12T23:02:02+08:00">2019-09-12</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>3.2k 字</span>
              &nbsp; | &nbsp;
              <span>12 min</span>
            </span>
          

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/翻译/" itemprop="url" rel="index"><span itemprop="name">翻译</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/器/" itemprop="url" rel="index"><span itemprop="name">器</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/" class="leancloud_visitors" data-flag-title="一些能够提高工作效率的绝密 VS Code 奇淫巧计「翻译」">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>拖延了很久的 ARTS 打卡终于准备开始了。A 是指 Algorithm，即每周练习一道算法题；R 是指 Review，阅读并点评至少一篇英文技术文章；T 是指 Tip，学习一个新的技术技巧；S 是 Share，分享一篇有观点和思考的技术文章。</p>
<p>不知不觉已经脱离 IDE 很久了，因为找工作期间都是写一些代码量比较小的算法题目和程序片段，主力开发软件已经成了 Vim 和 VS Code。工欲善其事必先利其器，所以我的第一篇 Review 选择了一篇有关 VS Code 的文章。</p>
<h1 id="译文"><a href="#译文" class="headerlink" title="译文"></a>译文</h1><blockquote>
<p>原文 <a href="https://medium.com/free-code-camp/here-are-some-super-secret-vs-code-hacks-to-boost-your-productivity-20d30197ac76" target="_blank" rel="noopener">Here are some super secret VS Code hacks to boost your productivity</a></p>
</blockquote>
<p>不论是作为一名爱好者、专业者、或者甚至一个月只写一次代码的开发者，您都必须知道，对于一个在工作时愿意投入最大效率时间的人来说，拥有智能和锋利的开发工具是至关重要的。</p>
<p>我已经筹措整理了一些技巧、诀窍和扩展，并经过重重筛选，只保留了对现代 web 开发者来说最少和最有用的一部分。正如我们所知道的，Javascript 的生态系统非常庞大，而且还在不断壮大。基于这个原因，我会尽量做到不偏不倚。</p>
<p>接下来的 Visual Studio Code 技巧将会让您在完成所有的编码阶段后能够以如下的姿态走出去：</p>
<iframe src="https://giphy.com/embed/26gJyIscAHtBNcc00" width="480" height="266" frameborder="0" class="giphy-embed" allowfullscreen></iframe><p><a href="https://giphy.com/gifs/ufc-mma-ufc-205-26gJyIscAHtBNcc00" target="_blank" rel="noopener">via GIPHY</a></p>

## 让它变得美丽友好

> If it really looks good and friendly, you’ll love the time spent with it.
> 如果它真的看起来不错和友好，你会爱上和它相处的时间的。

### [Material Theme](https://marketplace.visualstudio.com/items?itemName=Equinusocio.vsc-material-theme) & [Icons](https://marketplace.visualstudio.com/items?itemName=PKief.material-icon-theme)

这是 VS Code 主题的核心。我认为 material theme 是一款编辑器中最接近使用纸笔书写的东西了（尤其是使用 **no contrast variant** 主题后）。从集成工具到文本编辑器，您的编辑器看起来几乎是扁平、无缝的。

想象一下史诗级别的主题配上史诗级别的图标。[Material Theme Icons](https://marketplace.visualstudio.com/items?itemName=PKief.material-icon-theme) 是替换默认 VS Code 图标的令人惊叹的选择。其设计的大型图标目录与主题融为一体，使之更加美观。这将帮助您轻松地在资源管理器中找到您的文件。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/vsc-material-theme.jpg" title="material theme">

### 居中布局的禅模式

您也许已经知道了禅模式（Zen Mode）视图，也称为无干扰视图（对于那些来自 Sublime Text 的用户来说），它会移除所有事物（除了代码），来让您和您的编辑器有真正亲密的接触。您知道您可以使其居中布局并帮助你像在 PDF 阅读器中一样阅读您的代码吗？这将真正帮助您专注于一个函数或者研究别人的代码。

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Zen Mode: [View &gt; Appearance &gt; Toggle Zen Mode]</span><br><span class="line">Center Layout: [View &gt; Appearance &gt; Toggle Centered Layout]</span><br></pre></td></tr></table></figure>

译者注：更简单的方法是 `ctrl+shift+p` 然后输入 zen mode 或者 centered 然后选择对应选项敲回车即可。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/zen-mode-with-centered-layout.gif" title="居中布局的禅模式">

### 使用具有连写的字体

好的风格使阅读变得容易和舒服。您可以用支持连写的令人惊叹的字体使您的编辑器看起来更好。这里有 [6 款支持连写的最好的字体](https://www.slant.co/topics/5611/~monospace-programming-fonts-with-ligatures)（来源 [www.slant.co](http://www.slant.co/))。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/coding-with-ligatures.gif" title="使用带连写的字体进行编码">

你可以试用 [Fira Code](https://github.com/tonsky/FiraCode)，它很棒并且是开源的。在安装这款字体后你应该这样修改 VS Code 的配置。

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">"editor.fontFamily": "Fira Code",</span><br><span class="line">"editor.fontLigatures": true</span><br></pre></td></tr></table></figure>

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/all-ligatures.png" title="使用带连写的字体进行编码">

着名的字体Operator Mono没有为连字提供原生支持，然而如果你是连字的狂热粉丝，你可以使用[这个库](https://github.com/kiliman/operator-mono-lig)来添加它们。

### [Rainbow Indent](https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow)

缩进风格。这个扩展为文本前面的缩进着色，每一步交替使用四种不同的颜色。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/rainbow-indent.png">

默认的缩进设置按照彩虹的配色为缩进着色。然而我通过定制自己的方案来跟随不同的灰度。如果您希望您的缩进风格和示例中的一致，把下面的片段复制粘贴到您的 `settings.json` 中。

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">"indentRainbow.colors": [</span><br><span class="line">"rgba(16,16,16,0.1)",</span><br><span class="line">"rgba(16,16,16,0.2)",</span><br><span class="line">"rgba(16,16,16,0.3)",</span><br><span class="line">"rgba(16,16,16,0.4)",</span><br><span class="line">"rgba(16,16,16,0.5)",</span><br><span class="line">"rgba(16,16,16,0.6)",</span><br><span class="line">"rgba(16,16,16,0.7)",</span><br><span class="line">"rgba(16,16,16,0.8)",</span><br><span class="line">"rgba(16,16,16,0.9)",</span><br><span class="line"><span class="string">"rgba(16,16,16,1.0)"</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>

### 定制标题栏

这是一个很好的视觉调整。我从 [Wes Bos](https://medium.com/u/86a55cd7983b?source=post_page-----20d30197ac76----------------------) 的一堂 [React & GraphQL](https://advancedreact.com/) 课程中复制了它。基本上，他通过给不同的项目配上不同的标题栏颜色来更容易地识别它们，并帮助观众区分它们。这在具有相同代码或文件名的应用中真的非常有用，例如，一个 react-native 的移动应用和一个 react web 应用。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/title-bar-customization.png" title="定制标题栏">

您可以通过在每个您想要不同标题栏颜色的项目的 Workspace Settings 中编辑 Title Bar 来设置不同的标题栏颜色。

## 更快的编码

> The very essence of getting it done in time
> 及时完成任务的本质

### 标签换行

如果你不知道 [Emmet](https://emmet.io/)，那么你可能是喜欢在写代码时敲下每个字符的人。Emmet 使你能够通过输入缩写来获取相应的标签。这可以由选择一块代码并输入 Wrap with Abbreviation 命令来实现，我为这个操作绑定了一个快捷键 `shift + alt + .`。

参见下面的例子：

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/wrap-it-up-with-emmet.gif" title="使用 Emmit 包裹代码">

如果您想把所有这些都包裹成单独的行。那么您可以使用 *wrap with individual lines* 命令，然后在缩写后面插入一个 \*，例如 `div*`。

如果你想直接转到 Emmet，这里是一份[Emmet 的速查手册](https://docs.emmet.io/cheat-sheet/)。

### Balance Inwords 和 Balance Outwords

这个技巧来自我强烈推荐的 [https://vscodecandothat.com/](https://vscodecandothat.com/)。

你可以通过使用 Emmet 的 `balance inword` 命令和 `balance outword` 命令在 VS Code 中选择一个代码块。把这些命令绑定到快捷键时非常有用的，比如 `Ctrl + Shift + Up Arrow` 对应 Balance Outwords，`Ctrl + Shift + Down Arrow` 对应 Balance Inwords。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/balance-inwords-and-outwords.gif" title="Balance Inwords/Outwords">

### [Turbo Console.log()](https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log)

没有人喜欢敲像 `console.log()` 这样长的输入。这着实时让人易怒的，大多数情况下你只是想快速的输出一些东西，查看一下它的值然后继续编码。如果我告诉您可以像 Lucky Luke 一样快的使用 `console.log` 会怎么样呢。

译者注：Lucky Luke — the man who shoots faster than his shadow，幸运星卢克，是一部由比利时漫画家莫里斯于1946年创作的西方连环画。

这个工作可以由 [Turbo Console Log](https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log) 扩展来完成。它能够在当前行的下一行记录任何变量,并遵循代码结构自动生成前缀。您还可以通过使用快捷键 `alt+shift+u/ alt+shift+c` 来注释或者取消注释由该插件添加的 `console.log`。

此外，还可以用 `alt+shift+d` 删除它们:

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/turbo-console-log.gif" title="conso.log() 自动涡轮机">

### [Live Server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)

这是一个令人惊叹的扩展，它帮助您启动一个支持静态和动态页面实时重新加载的本地开发服务器。它对于大多数特性都有很好的支持：HTTPS，CORS，可定制的 IP 地址和端口。

[点击这里下载](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/live-server.gif" title="Live Server">

如果搭配 [VS Code LiveShare](https://marketplace.visualstudio.com/items?itemName=MS-vsliveshare.vsliveshare) 它甚至允许你分享你的 `localhost`。

### 多光标复制粘贴

使用 VS Code 的过程中，我的第一次“哇哦”献给了多光标编辑。很久之后，我发现这个特性的一个巧妙应用，您可以复制粘贴光标选中的内容，并且按照它们被复制的顺序粘贴他们。

看看下面的例子：

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/copy-and-paste-with-different-cursors.gif" title="多光标复制粘贴">

### 面包屑导航和大纲

面包屑导航展示当前的位置，并允许你快速的在文件和符号间跳转。通过 `View > Toggle Breadcrumbs` 命令或者 `breadcrumbs.enabled` 设定来启动它。

大纲视图是文件管理器树底部单独的部分。展开后，将显示当前活动编辑器的符号树。

大纲视图有不同的排序模式，可选光标跟踪。它还有一个输入框来过滤你输入的符号。错误和警告也会展示在大纲视图中，使你能够瞟一眼就找到错误所在。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/breadcrumb-and-outline-relation.gif" title="面包屑导航和大纲的关系">

## 杂项

> Those little tweaks that change everything
> 那些改变一切的小调整

### 命令行里的 code

VS Code有一个强大的命令行界面，允许您控制如何启动编辑器。你可以打开文件，安装扩展，修改显示语言，通过命令行界面输出诊断信息。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/code-cli.png" title="code 的命令行接口">

想象一下您刚使用 `git clone <repo-url>` 克隆了一个仓库，然后您想替换当前正在使用的 VS Code 实例。`code . -r` 能够使你在不离开命令行的情况下就实现这个功能（[从这里了解更多](https://code.visualstudio.com/docs/editor/command-line)）。

### [polacode](https://github.com/octref/polacode)

> Polaroid for your code

您经常会遇到具有自定义字体和主题的吸引人的代码截图，如下所示。这是在带有 Polacode 扩展的 VS Code 中获得的。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/polacode.png" title="VS Code 的 Polacode 扩展">

我知道 [Carbon](https://carbon.now.sh/) 是一个好的并且更加可定制化的代替品。然而，Polacode 允许您留在代码编辑器中，并使用您可能购买的任何在 Carbon 中不可用的专有字体。

### [Quokka (JS/TS ScratchPad)](https://quokkajs.com/)

Quokka是JavaScript和TypeScript的快速原型开发平台。它在您键入代码时立即运行您的代码，并在代码编辑器中显示各种执行结果和控制台日志。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/quokka.gif" title="Quokka">

Quokka的一个很棒的应用是，当您在为技术面试做准备时，您能够输出每个步骤，而不用在调试器中设置断点。

它还可以帮助您在实际使用诸如Lodash或MomentJS之类的库函数之前研究它们。它甚至可以用于异步调用。

### [WakaTime](https://wakatime.com/)

你的朋友认为你花了太多时间敲代码吗？记录并告诉他们每天 10 小时并不算“太多”。WakaTime 是一个有助于记录和存储有关您的编程活动的指标和分析的扩展。

您可以设定目标，查看您常用的编程语言，您甚至可以世界上的其他忍者做一个对比。

<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/wakatime.png" title="WakaTime Dashboard">
<img src="/2019/09/08/一些提高工作效率的超级秘密的-VS-Code-奇淫巧计/wakatime-1.png" title="WakaTime Leaderboards">

### [VSCode Hacker Typer](https://marketplace.visualstudio.com/items?itemName=jevakallio.vscode-hacker-typer)

您是否曾经在人群前写过代码？你经常不顾一切地打字，一边打字一边聊天，这让你有点困惑。想象一下预先键入的代码，只有当您在 geektyper 中模拟类型时才会出现。

<iframe width="663" height="382" src="https://www.youtube.com/embed/ulnC-SDBDKE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p><a href="https://medium.com/u/3e0af129613a?source=post_page-----20d30197ac76----------------------" target="_blank" rel="noopener">Jani Eväkallio</a> 把这个插件带到了 VS Code。它将帮助您记录和重播宏(在编辑器中编写的代码)，使您在向观众打字时 100% 更加专注。</p>
<h3 id="Exclude-folders"><a href="#Exclude-folders" class="headerlink" title="Exclude folders"></a>Exclude folders</h3><p>我在<a href="https://stackoverflow.com/questions/33258543/how-can-i-exclude-a-directory-from-visual-studio-code-explore-tab/33277809#33277809" target="_blank" rel="noopener">一篇 stackoverflow 的帖子</a>里学到这个技巧。这是一个快速调整，将 node modules 或其他文件夹从资源管理器树中排除，以帮助您只关注重要的内容。对于我来说，我非常讨厌在编辑器中打开乏味的node module文件夹，所以我决定隐藏它。</p>
<p>例如，要隐藏 node_modules，您可以执行以下操作：</p>
<ol>
<li><strong>File &gt; Preferences &gt; Settings</strong> (MAC 下 <strong>Code &gt; Preferences &gt; Settings</strong>)</li>
<li>在设置中搜索 <code>files.exclude</code></li>
<li>点击 <code>Add Pattern</code> 然后输入 <code>**/node_modules</code></li>
<li>瞧！node_modules 从资源管理器树中消失了</li>
</ol>
<h3 id="你的建议"><a href="#你的建议" class="headerlink" title="你的建议"></a>你的建议</h3><p>你可以随时评论一些关于VSCode的最秘密的提示，我很乐意将它们添加到列表中来帮助其他人。:)</p>
<p>我希望这些技巧能够真正提高 VS Code 的效率。如果您喜欢这篇文章，请鼓掌并分享，如果我错过了任何扩展，请评论。</p>
<h1 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h1><p>以后学习前端的时候可以试一试里面提到的技巧。磕磕绊绊好几天才翻译完，借助了翻译工具，好吧其实它们呢才是主力。然后下一篇文章要读过再翻译，这一篇的读完的收获感觉不匹配投入的时间啊哭泣QAQ。</p>
<p>最后 VS Code 真好用呀。心痒痒的什么时候入一下 <strong>typescript</strong> 坑也自己动手写插件。</p>
</repo-url>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/07/23/字符串的最短唯一前缀/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/23/字符串的最短唯一前缀/" itemprop="url">
                  字符串的最短唯一前缀
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-23 17:12:05" itemprop="dateCreated datePublished" datetime="2019-07-23T17:12:05+08:00">2019-07-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-07 18:58:04" itemprop="dateModified" datetime="2019-08-07T18:58:04+08:00">2019-08-07</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>1.7k 字</span>
              &nbsp; | &nbsp;
              <span>8 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/23/字符串的最短唯一前缀/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/07/23/字符串的最短唯一前缀/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/07/23/字符串的最短唯一前缀/" class="leancloud_visitors" data-flag-title="字符串的最短唯一前缀">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>输入第一行为一个整数，表示字符串的行数，接下来的 N 行每行为一个字符串。</p>
<p>输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">bytedance</span><br><span class="line">toutiaohao</span><br><span class="line">toutiaoapp</span><br><span class="line">iesaweme</span><br><span class="line">iestiktok</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b</span><br><span class="line">toutiaoh</span><br><span class="line">toutiaoa</span><br><span class="line">iesa</span><br><span class="line">iest</span><br></pre></td></tr></table></figure>
<blockquote>
<p>题目描述：找到输入中每个字符串的最短唯一前缀。</p>
<p>数据范围：N ≤ 1000，总字符数 &lt; 1000000。</p>
<p>输入数据确保没有一个字符串是另一个字符串的前缀。</p>
</blockquote>
<p>思路是每个字符串和其他的所有字符串做比较，记录两个字符串间相同的位数，取其中的最大值作为字符串的唯一标识。</p>
<p>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">'bytedance'</span></span><br><span class="line"></span><br><span class="line">other_words = [</span><br><span class="line">    <span class="string">'toutiaohao'</span>,</span><br><span class="line">    <span class="string">'toutiaoapp'</span>,</span><br><span class="line">    <span class="string">'iesaweme'</span>,</span><br><span class="line">    <span class="string">'iestiktok'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># b != t</span></span><br><span class="line"><span class="comment"># b != i</span></span><br><span class="line"><span class="comment"># loc = 0</span></span><br><span class="line">print(<span class="string">'bytedance'</span>[:loc+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">'toutiaohao'</span></span><br><span class="line"></span><br><span class="line">other_words = [</span><br><span class="line">    <span class="string">'bytedance'</span>,</span><br><span class="line">    <span class="string">'toutiaoapp'</span>,</span><br><span class="line">    <span class="string">'iesaweme'</span>,</span><br><span class="line">    <span class="string">'iestiktok'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># for 'toutiaoapp':</span></span><br><span class="line"><span class="comment"># t == t</span></span><br><span class="line"><span class="comment"># o == o</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># a == a</span></span><br><span class="line"><span class="comment"># o == o</span></span><br><span class="line"><span class="comment"># h != a</span></span><br><span class="line"><span class="comment"># loc = 7</span></span><br><span class="line">print(<span class="string">'toutiaohao'</span>[:loc+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>按照这种思路写出代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(str_list)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> str_list:</span><br><span class="line">        <span class="comment"># one char must be unique</span></span><br><span class="line">        <span class="keyword">if</span> len(word) == <span class="number">1</span>:</span><br><span class="line">            print(word)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># save the largest i for where the unique prefix ends</span></span><br><span class="line">        saved_i = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> other_word <span class="keyword">in</span> str_list:</span><br><span class="line">            <span class="comment"># not do self compare </span></span><br><span class="line">            <span class="keyword">if</span> word == other_word:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">            <span class="comment"># find the first different char's location between word and other_word</span></span><br><span class="line">            <span class="keyword">while</span> i &lt; len(other_word):</span><br><span class="line">                <span class="keyword">if</span> word[i] == other_word[i]:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># find the first different char</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> saved_i:</span><br><span class="line">                        <span class="comment"># for the first inner loop</span></span><br><span class="line">                        saved_i = i</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># update saved_i if current i is larger</span></span><br><span class="line">                        saved_i = max(i, saved_i)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># if other_word is a sub-string of word (this will not happed assured by the problem)</span></span><br><span class="line">            <span class="comment"># i will be len(other_word)</span></span><br><span class="line">            <span class="comment"># and the else part will never be reached</span></span><br><span class="line">            <span class="comment"># which means saved_i still is None</span></span><br><span class="line">            <span class="comment"># so check this case</span></span><br><span class="line">            <span class="keyword">if</span> i == len(other_word):</span><br><span class="line">                saved_i = i</span><br><span class="line"></span><br><span class="line">        print(word[:saved_i+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># get toutal input count</span></span><br><span class="line">    N = int(input())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> N &lt;= <span class="number">0</span>:</span><br><span class="line">        exit()</span><br><span class="line">    </span><br><span class="line">    str_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        str_list.append(input().strip())  <span class="comment"># read a word</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> N == <span class="number">1</span>:</span><br><span class="line">        print(str_list[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        process(str_list)</span><br></pre></td></tr></table></figure>
<p>这个解法的复杂度非常高，每个字符串都会和其他所有的字符串比较一次，总共需要比较 $N\timesN-1$ 次，每次比较都需要顺序遍历字符串，因此复杂度为 $O(N^2\timesM)$，M 为字符串的平均长度。</p>
<p>后来问了一个同学，她的思路是按照列来处理，使用一个 <code>index</code> 来记录从 0 到当前列的字符串是否重复出现，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">str_list = [<span class="string">'abc'</span>, <span class="string">'calls'</span>, <span class="string">'called'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 index</span></span><br><span class="line">index = [<span class="number">-1</span>] * len(str_list) <span class="comment"># index -&gt; [-1, -1, -1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一列</span></span><br><span class="line">col = &#123;&#125; <span class="comment"># prefix: line_num</span></span><br><span class="line">col_num = <span class="number">0</span></span><br><span class="line">row_num = <span class="number">0</span></span><br><span class="line"><span class="string">'a'</span></span><br><span class="line">col = &#123;<span class="string">'a'</span>: <span class="number">0</span>&#125;</span><br><span class="line">index[row_num] = col_num <span class="comment"># index -&gt; [0, -1, -1]</span></span><br><span class="line">row_num = <span class="number">1</span></span><br><span class="line"><span class="string">'c'</span></span><br><span class="line">col = &#123;<span class="string">'a'</span>: <span class="number">0</span>, <span class="string">'c'</span>: <span class="number">1</span>&#125;</span><br><span class="line">index[row_num] = col_num <span class="comment"># index -&gt; [0, 0, -1]</span></span><br><span class="line">row_num = <span class="number">2</span></span><br><span class="line"><span class="string">'c'</span></span><br><span class="line">col = &#123;<span class="string">'a'</span>: <span class="number">0</span>, <span class="string">'c'</span>: <span class="number">-1</span>&#125;  <span class="comment"># 前缀 'c' 重复出现了</span></span><br><span class="line">index[row_num] = col_num <span class="comment"># index -&gt; [0, -1, -1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二列</span></span><br><span class="line">col = &#123;&#125;</span><br><span class="line">col_num = <span class="number">1</span></span><br><span class="line">row_num = <span class="number">0</span></span><br><span class="line">index[row_num] = <span class="number">0</span> != <span class="number">-1</span>  <span class="comment"># 已经找到最短前缀</span></span><br><span class="line">row_num = <span class="number">1</span></span><br><span class="line"><span class="string">'ca'</span></span><br><span class="line">col = &#123;<span class="string">'ca'</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="comment"># index -&gt; [0, 1, -1]</span></span><br><span class="line">row_num = <span class="number">2</span></span><br><span class="line"><span class="string">'ca'</span></span><br><span class="line">col = &#123;<span class="string">'ca'</span>: <span class="number">-1</span>&#125; <span class="comment"># 前缀 'ca' 重复出现</span></span><br><span class="line"><span class="comment"># index -&gt; [0, -1, -1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 第五列</span></span><br><span class="line">col_num = <span class="number">4</span></span><br><span class="line">row_num = <span class="number">0</span></span><br><span class="line">index[row_num] = <span class="number">0</span> != <span class="number">-1</span>  <span class="comment"># 已经找到最短前缀</span></span><br><span class="line">row_num = <span class="number">1</span></span><br><span class="line"><span class="string">'calls'</span></span><br><span class="line">col = &#123;<span class="string">'calls'</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="comment"># index -&gt; [0, 4, -1]</span></span><br><span class="line">row_nums = <span class="number">2</span></span><br><span class="line"><span class="string">'calle'</span></span><br><span class="line">col = &#123;<span class="string">'calls'</span>: <span class="number">1</span>, <span class="string">'calle'</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="comment"># index -&gt; [0, 4, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># index 均不为 -1，找到所有唯一最短前缀</span></span><br></pre></td></tr></table></figure>
<p>按照这种思路写出代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process1</span><span class="params">(self, str_list)</span>:</span></span><br><span class="line">    index = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str_list))] <span class="comment"># 每行的前缀index，初始设为-1，若找到前缀则更新为对应值</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        col = &#123;&#125; <span class="comment"># 记录从 0 到 i（当前列数）的前缀</span></span><br><span class="line">        <span class="keyword">for</span> line_num, word <span class="keyword">in</span> enumerate(str_list):</span><br><span class="line">            <span class="keyword">if</span> i == len(word) - <span class="number">1</span>:</span><br><span class="line">                index[line_num] = i</span><br><span class="line">            <span class="keyword">if</span> i &lt;= len(word) - <span class="number">1</span> <span class="keyword">and</span> index[line_num] == <span class="number">-1</span>: <span class="comment"># 如果当前行没到结尾，并且还未找到前缀</span></span><br><span class="line">                <span class="keyword">if</span> word[:i+<span class="number">1</span>] <span class="keyword">in</span> col: <span class="comment"># 前缀 word[:i+1] 已经出现过</span></span><br><span class="line">                    index[col[word[:i+<span class="number">1</span>]]] = <span class="number">-1</span></span><br><span class="line">                <span class="keyword">else</span>: <span class="comment">#如果没有重复字符，则找到前缀</span></span><br><span class="line">                    col[word[:i+<span class="number">1</span>]] = line_num</span><br><span class="line">                    index[line_num] = i</span><br><span class="line">        <span class="keyword">if</span> <span class="number">-1</span> <span class="keyword">not</span> <span class="keyword">in</span> index:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i, key <span class="keyword">in</span> enumerate(index):</span><br><span class="line">        print(str_list[i][:key+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>这种方法的时间复杂度是 $O(MN)$，其中 M 是最长的唯一前缀长度，N 是字符串数量。空间复杂度是 $O(N)$，使用了一个数组 index 来记录每一行最短前缀的位置。</p>
<p>更新一下字典树（前缀树）的解法：</p>
<p>使用 <code>path</code> 记录经过节点的字母个数，当节点的 <code>path</code> 的值第一次为 1 时经过路径上的字符构成的字符串即为唯一最短前缀。例如以如下输入构建字典树：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bytedance</span><br><span class="line">toutiaohao</span><br><span class="line">toutiaoapp</span><br></pre></td></tr></table></figure>

<p>从图中可以看出，对于 bytedance 来说，根节点后的第一个节点的 path 值就是 1，所以它的最短唯一前缀就是 b。而后两个字符串的前几个字符相同，所以这几个节点记录的路径值为 2。当第一次出现路径值为 1 的节点时，到达其最短唯一前缀。</p>
<p>实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.path = <span class="number">0</span></span><br><span class="line">        self.end = <span class="number">0</span></span><br><span class="line">        self.maps = [<span class="literal">None</span>] * <span class="number">26</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.root = TrieNode()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="string">"""Insert a word into trie tree.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        word: str, a word as string to inserted</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        node.path += <span class="number">1</span>  <span class="comment"># this is actually the total number of words</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            <span class="comment"># get the index of current char</span></span><br><span class="line">            index = ord(c) - ord(<span class="string">'a'</span>)</span><br><span class="line">            <span class="comment"># add a new trie node if current char is first shown</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node.maps[index]:</span><br><span class="line">                node.maps[index] = TrieNode()</span><br><span class="line">            <span class="comment"># else step into this char's node and update the path count</span></span><br><span class="line">            node = node.maps[index]</span><br><span class="line">            node.path += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># hit the end of the word, mark it as end</span></span><br><span class="line">        node.end += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="string">"""Check whether a word is in trie tree.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        word: str, a word as string to be searched</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            index = ord(c) - ord(<span class="string">'a'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node.maps[index]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            node = node.maps[index]</span><br><span class="line">        <span class="keyword">return</span> node.end &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_shortest_unique_prefix</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="string">"""Get the shortest unique prefix of a given word.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        word: str, a word as string to be searched</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># this check should be done,</span></span><br><span class="line">        <span class="comment"># but i omit it here for convenient,</span></span><br><span class="line">        <span class="comment"># okkk... finally i did this.</span></span><br><span class="line">        <span class="keyword">assert</span> self.search(word) == <span class="literal">True</span>, <span class="string">"word is not in trie tree"</span></span><br><span class="line">        <span class="comment"># or should i insert it directly ???</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        shortest_unique_prefix = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            index = ord(c) - ord(<span class="string">'a'</span>)</span><br><span class="line">            shortest_unique_prefix.append(c)</span><br><span class="line">            <span class="comment"># note that the path of the first node</span></span><br><span class="line">            <span class="comment"># which actually is the root node's path</span></span><br><span class="line">            <span class="comment"># should not be checked and what we find</span></span><br><span class="line">            <span class="comment"># is the node whose path first equals one</span></span><br><span class="line">            node = node.maps[index]</span><br><span class="line">            <span class="keyword">if</span> node.path == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">''</span>.join(shortest_unique_prefix)</span><br><span class="line">        <span class="keyword">return</span> word</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_via_trie</span><span class="params">(self, str_list)</span>:</span></span><br><span class="line">        trie = Trie()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> str_list:</span><br><span class="line">            trie.insert(word)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> str_list:</span><br><span class="line">            shortest_unique_prefix = trie.get_shortest_unique_prefix(word)</span><br><span class="line">            print(shortest_unique_prefix)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># get toutal input count</span></span><br><span class="line">    N = int(input())</span><br><span class="line">    solution = Solution()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> N:</span><br><span class="line">        exit()</span><br><span class="line">    </span><br><span class="line">    str_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        str_list.append(input().strip())  <span class="comment"># read a word</span></span><br><span class="line">    <span class="keyword">if</span> N == <span class="number">1</span>:</span><br><span class="line">        print(str_list[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        solution.process_via_trie(str_list)</span><br></pre></td></tr></table></figure>
<p>然后测试的时候内存超过限制了…使用长度为 26 的列表会造成大量的空间浪费，尝试改成字典或者其他的数据结构应该可以优化空间的消耗。</p>
<p>更新把列表换成字典的解法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.path = <span class="number">0</span></span><br><span class="line">        self.end = <span class="number">0</span></span><br><span class="line">        self.maps = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.root = TrieNode()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        node.path += <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> node.maps:</span><br><span class="line">                node.maps[c] = TrieNode()</span><br><span class="line">            node = node.maps[c]</span><br><span class="line">            node.path += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        node.end += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        node = self.root</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> node.maps:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            node = node.maps[c]</span><br><span class="line">        <span class="keyword">return</span> node.end &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_shortest_unique_prefix</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> self.search(word) == <span class="literal">True</span>, <span class="string">"word is not in trie tree"</span></span><br><span class="line">        node = self.root</span><br><span class="line">        shortest_unique_prefix = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">            shortest_unique_prefix.append(c)</span><br><span class="line">            node = node.maps[c]</span><br><span class="line">            <span class="keyword">if</span> node.path == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">''</span>.join(shortest_unique_prefix)</span><br><span class="line">        <span class="keyword">return</span> word</span><br></pre></td></tr></table></figure>
<p>相比于列表，字典只会在需要的时候创建空间，因此可以节省一些空间，但是结果依然超过了最大可用内存。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/06/12/数据结构错题本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/12/数据结构错题本/" itemprop="url">
                  数据结构错题本
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-12 21:25:55" itemprop="dateCreated datePublished" datetime="2019-06-12T21:25:55+08:00">2019-06-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-27 22:48:24" itemprop="dateModified" datetime="2019-07-27T22:48:24+08:00">2019-07-27</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>465 字</span>
              &nbsp; | &nbsp;
              <span>1 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/12/数据结构错题本/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/06/12/数据结构错题本/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/06/12/数据结构错题本/" class="leancloud_visitors" data-flag-title="数据结构错题本">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><h3 id="有关二叉树的数学知识"><a href="#有关二叉树的数学知识" class="headerlink" title="有关二叉树的数学知识"></a>有关二叉树的数学知识</h3><h4 id="二叉树每层节点数"><a href="#二叉树每层节点数" class="headerlink" title="二叉树每层节点数"></a>二叉树每层节点数</h4><p>二叉树中每层的节点数都是其上一行的两倍:1 2 4 …</p>
<p>因此每层的节点数为首项为 1 公比为 2 的等比数列的通项公式：</p>
<script type="math/tex; mode=display">N = 2 ^ {n - 1}</script><h4 id="满二叉树节点总数"><a href="#满二叉树节点总数" class="headerlink" title="满二叉树节点总数"></a>满二叉树节点总数</h4><p>二叉树中每层的节点数为：1 2 4 …</p>
<p>是一个公比不等于 1 的等比数列，由等比数列的求和公式</p>
<script type="math/tex; mode=display">q = \frac {a_1 - a_1q^n} {1 - q}</script><p>得满二叉树的节点总数：</p>
<script type="math/tex; mode=display">N = 2^n - 1</script><p>其中 n 为二叉树层数。</p>
<p><strong>例题</strong>：<a href="https://www.nowcoder.com/questionTerminal/b1bf283efde3430a96849037879fb926" target="_blank" rel="noopener">一个完全二叉树节点数为200，则其叶子结点个数为？</a></p>
<p><strong>常规解法：</strong>$2^n - 1 &lt;= 200$ ，将 1 移到等式右边两边同时取对数得到 $log_2{128} &lt; n = log_2{201} &lt; log_2{256}$，推出 8 &lt; n &lt; 10，所以 n = 9。</p>
<p>因为是完全二叉树，因此前 8 层一定是满的，于是第九层节点数等于 $200 - (2^8 - 1) = 73$，完全二叉树中叶子节点一定是按顺序排列的，因此第八层中有 33 个节点有叶子节点，$2^{8 - 1} - 37 = 27$，所以总共有$73 + 27 = 100$ 个叶子节点。</p>
<p><strong>根据二叉树的性质：</strong>完全二叉树除最后一层，其他层都是满结点的。所以这里总结点200个，是偶数，可以判断度为1的结点是1个。</p>
<p>根据二叉树性质 $n_0 = n_2 + 1$;叶子结点数量等于度为2的结点数+1</p>
<script type="math/tex; mode=display">n_0 + n_1 + n_2 = 200\\

n_0 + n_1 + n_0 - 1 =200\\

2n_0 = 201-n_1 = 200</script><p>完全二叉树度为1的结点个数要么1，要么0. 叶子结点数为整数，这里也可以推断出度为1的结点个数是1，$n_0 = 100$，所以叶子结点数是100.</p>
<p><strong>总结：</strong>：完全二叉树，叶子结点数 $n_0 = \lceil{n/2}\rceil$。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/06/02/python-测试与调试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/02/python-测试与调试/" itemprop="url">
                  Python 测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-02 09:15:58 / 修改时间：13:22:05" itemprop="dateCreated datePublished" datetime="2019-06-02T09:15:58+08:00">2019-06-02</time>
            

            
              

              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>876 字</span>
              &nbsp; | &nbsp;
              <span>3 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/02/python-测试与调试/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/06/02/python-测试与调试/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/06/02/python-测试与调试/" class="leancloud_visitors" data-flag-title="Python 测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Python-测试框架"><a href="#Python-测试框架" class="headerlink" title="Python 测试框架"></a>Python 测试框架</h1><h2 id="unittest"><a href="#unittest" class="headerlink" title="unittest"></a>unittest</h2><h3 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h3><p>先来看一个最简单的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAdd</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(add(<span class="number">1</span>, <span class="number">2</span>), <span class="number">3</span>)</span><br><span class="line">        self.assertEqual(add(<span class="number">-1</span>, <span class="number">2</span>), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<p>在上面的例子中通过继承 <code>unittest.TestCase</code> 来编写测试类，在测试类中可以使用 <code>unittest</code> 提供的若干方法编写测试用例，最后使用 <code>unittest.main()</code> 运行单元测试。此外也可以使用 <code>python -m unittest test.py</code> 的方式运行测试用例。</p>
<h3 id="初始化与清理现场"><a href="#初始化与清理现场" class="headerlink" title="初始化与清理现场"></a>初始化与清理现场</h3><p>在一些测试中，需要提前配置一些信息，例如创建某个特性的被测试对象，这个时候可以使用 <code>unittest</code> 提供的 <code>setUp</code> 函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WidgetTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.widget = Widget(<span class="string">'The widget'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_default_widget_size</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(self.widget.size(), (<span class="number">50</span>,<span class="number">50</span>),</span><br><span class="line">                         <span class="string">'incorrect default size'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.widget.dispose()</span><br></pre></td></tr></table></figure>
<p>上面一个来自 <code>Python</code> 官方文档的样例代码，其中 <code>setUp</code> 用于在测试开始前做一些准备工作，<code>tearDown</code> 是测试结束后的清理工作，例如测试失败时程序就会终止运行，这个时候可以通过添加 <code>tearDown</code> 方法释放系统资源。</p>
<h3 id="测试标准输出"><a href="#测试标准输出" class="headerlink" title="测试标准输出"></a>测试标准输出</h3><p>有些时候希望测试标准输出是否符合某种期望，可以使用上下文管理器（<code>context manager</code>）捕获标准输出。这种方法的本质也是重定向标准输出，使用上下文管理器的好处是不需要在测试结束后还原标准输出，可以避免使用 <code>try...finally</code> 块。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">captured_output</span><span class="params">()</span>:</span></span><br><span class="line">    new_stdout, new_stderr = StringIO(), StringIO()</span><br><span class="line">    old_stdout, old_stderr = sys.stdout, sys.stderr</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sys.stdout, sys.stderr = new_stdout, new_std_err</span><br><span class="line">        <span class="keyword">yield</span> sys.stdout, sys.stderr</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        sys.stdout, sys.stderr = old_stdout, old_stderr</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> captured_output() <span class="keyword">as</span> (out, err):</span><br><span class="line">    foo()</span><br><span class="line"><span class="comment"># This can go inside or outside the `with` block</span></span><br><span class="line">output = out.getvalue().strip()</span><br><span class="line">self.assertEqual(output, <span class="string">'hello world!'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="doctest"><a href="#doctest" class="headerlink" title="doctest"></a>doctest</h2><h2 id="在-notebook-中使用-unittest-和-doctest"><a href="#在-notebook-中使用-unittest-和-doctest" class="headerlink" title="在 notebook 中使用 unittest 和 doctest"></a>在 notebook 中使用 unittest 和 doctest</h2><p>可以在 notebook 中直接使用Python标准测试工具，如doctest或unittest。</p>
<h3 id="Doctest"><a href="#Doctest" class="headerlink" title="Doctest"></a>Doctest</h3><p>在 notebook 的一个方格中定义如下函数和 docstring:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    This is a test:</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add(2, 2)</span></span><br><span class="line"><span class="string">    5</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure>
<p>然后在一个单元格中引入 doctest 库并运行 docstring 中的测试用例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> doctest</span><br><span class="line">doctest.testmod(verbose=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>得到输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Trying:</span><br><span class="line">    add(2, 2)</span><br><span class="line">Expecting:</span><br><span class="line">    5</span><br><span class="line">**********************************************************************</span><br><span class="line">File &quot;__main__&quot;, line 4, in __main__.add</span><br><span class="line">Failed example:</span><br><span class="line">    add(2, 2)</span><br><span class="line">Expected:</span><br><span class="line">    5</span><br><span class="line">Got:</span><br><span class="line">    4</span><br><span class="line">1 items had no tests:</span><br><span class="line">    __main__</span><br><span class="line">**********************************************************************</span><br><span class="line">1 items had failures:</span><br><span class="line">   1 of   1 in __main__.add</span><br><span class="line">1 tests in 2 items.</span><br><span class="line">0 passed and 1 failed.</span><br><span class="line">***Test Failed*** 1 failures.</span><br></pre></td></tr></table></figure>
<h3 id="Unittest"><a href="#Unittest" class="headerlink" title="Unittest"></a>Unittest</h3><p>在 notebook 的一个方格中定义如下函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure>
<p>引入 unitetest 库，然后定义如下测试类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestNotebook</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(add(<span class="number">2</span>, <span class="number">2</span>), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unittest.main(argv=[<span class="string">''</span>], verbosity=<span class="number">2</span>, exit=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">test_add (__main__.TestNotebook) ... FAIL</span><br><span class="line"></span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_add (__main__.TestNotebook)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;ipython-input-15-4409ad9ffaea&gt;&quot;, line 6, in test_add</span><br><span class="line">    self.assertEqual(add(2, 2), 5)</span><br><span class="line">AssertionError: 4 != 5</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></table></figure>
<h3 id="调式失败测试用例"><a href="#调式失败测试用例" class="headerlink" title="调式失败测试用例"></a>调式失败测试用例</h3><p>在调试失败的测试时，在某个时候停止测试用例的执行并运行调试器通常是有用的。为此，请在希望停止执行的行之前插入 <code>import pdb; pdb.set_trace()</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    This is the test:</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add(2, 2)</span></span><br><span class="line"><span class="string">    5</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">import</span> pdb; pdb.set_trace()</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure>
<p>对于本例，下一次运行 doctest 时，执行将在 return 语句之前停止，Python 调试器(pdb)将启动。您将直接在笔记本中得到一个 pdb 提示符，它将允许您检查 a 和 b 的值，使用 step 和 next 命令等。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://docs.python.org/3/library/unittest.html" target="_blank" rel="noopener">unittest — Unit testing framework</a><br><a href="https://stackoverflow.com/a/17981937" target="_blank" rel="noopener">How to assert output with nosetest/unittest in python?</a><br><a href="https://stackoverflow.com/a/48405555" target="_blank" rel="noopener">Unit tests for functions in a Jupyter notebook?</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/05/28/Ansible-学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/Ansible-学习笔记/" itemprop="url">
                  Ansible 学习笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-28 20:35:32" itemprop="dateCreated datePublished" datetime="2019-05-28T20:35:32+08:00">2019-05-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-12-31 21:41:27" itemprop="dateModified" datetime="2019-12-31T21:41:27+08:00">2019-12-31</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>395 字</span>
              &nbsp; | &nbsp;
              <span>1 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/28/Ansible-学习笔记/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/05/28/Ansible-学习笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/28/Ansible-学习笔记/" class="leancloud_visitors" data-flag-title="Ansible 学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="Ansible-介绍"><a href="#Ansible-介绍" class="headerlink" title="Ansible 介绍"></a>Ansible 介绍</h2><p>Ansible 是一款运维工具，它基于 ssh，因此不需要在远程机器上安装额外的客户端软件。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/05/28/Ansible-学习笔记/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/05/17/python-容器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/17/python-容器/" itemprop="url">
                  Python 容器
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-17 20:46:04" itemprop="dateCreated datePublished" datetime="2019-05-17T20:46:04+08:00">2019-05-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-02 09:17:51" itemprop="dateModified" datetime="2019-06-02T09:17:51+08:00">2019-06-02</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>968 字</span>
              &nbsp; | &nbsp;
              <span>4 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/17/python-容器/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/05/17/python-容器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/05/17/python-容器/" class="leancloud_visitors" data-flag-title="Python 容器">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Python-容器"><a href="#Python-容器" class="headerlink" title="Python 容器"></a>Python 容器</h2><p>python 内建的容器数据结构有列表，元组，集合和字典。这四个容器数据结构可以说是 python 编程过程中必不可少的数据类型，合理的选择使用这些数据结构对提升程序性能有很大的帮助。</p>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>关于列表需要知道的特性有：</p>
<ul>
<li>列表是可变的数据结构，可以向列表里插入和删除元素。</li>
<li>列表中可以放任意类型的对象，例如 <code>[1, &#39;a&#39;, [3.14, 0.5]]</code>。</li>
<li>列表的 <code>append()</code> 和无参数的 <code>pop()</code> 方法的时间复杂度是 $O(1)$。</li>
<li>列表的 <code>insert()</code> 操作和带参数的 <code>pop(index)</code> 方法的时间复杂度是 $O(n)$。</li>
<li><code>list.sort(), list.reverse()</code> 是原地排序和翻转的方法；<code>sorted(), reversed()</code> 不改变原有参数，而是将排序和翻转后的结果以新对象返回。</li>
<li>列表比元组占用更多的内存，性能也差于元组。</li>
<li>列表可以当做一个栈结构使用。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : list())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> LOAD_GLOBAL              <span class="number">0</span> (list)</span><br><span class="line">              <span class="number">3</span> CALL_FUNCTION            <span class="number">0</span> (<span class="number">0</span> positional, <span class="number">0</span> keyword pair)</span><br><span class="line">              <span class="number">6</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : [])</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> BUILD_LIST               <span class="number">0</span></span><br><span class="line">              <span class="number">3</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit list()</span><br><span class="line"><span class="number">94.3</span> ns ± <span class="number">4.23</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit []</span><br><span class="line"><span class="number">22.2</span> ns ± <span class="number">2.37</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br></pre></td></tr></table></figure>
<h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><p>关于元组需要知道的特性有：</p>
<ul>
<li>元组是不可变的数据类型，修改元组会引发一个 <code>TypeError</code>。</li>
<li>元组中也可以存储任意类型的对象，但是如果元组中存储了可变的对象，那么它会变得 <code>unhashable</code>，例如 <code>t = (1, &#39;a&#39;, [3])</code>。</li>
<li>元组的成员函数只有 <code>count(), index()</code>。</li>
<li>元组可以作为多返回值，也可以用来批量给变量赋值。</li>
<li>对元组使用 <code>sorted(), reversed()</code> 将会返回一个新列表。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : tuple())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> LOAD_GLOBAL              <span class="number">0</span> (tuple)</span><br><span class="line">              <span class="number">3</span> CALL_FUNCTION            <span class="number">0</span> (<span class="number">0</span> positional, <span class="number">0</span> keyword pair)</span><br><span class="line">              <span class="number">6</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : ())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> BUILD_TUPLE              <span class="number">0</span></span><br><span class="line">              <span class="number">3</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit tuple()</span><br><span class="line"><span class="number">70.1</span> ns ± <span class="number">6.75</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit ()</span><br><span class="line"><span class="number">12.9</span> ns ± <span class="number">0.0309</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">100000000</span> loops each)</span><br></pre></td></tr></table></figure>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>关于集合需要知道的特性有：</p>
<ul>
<li>集合可以用来去重。</li>
<li>集合的内部实现是散列表，查找元素是否在集合中的平均时间复杂度是 $O(1)$。</li>
<li>集合中的对象必须是 <code>hashable</code> 的。</li>
<li>集合不支持索引操作，但可以用 <code>in, not in</code> 判断元素是否在集合内。</li>
</ul>
<h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><p>关于字典需要知道的特性有：</p>
<ul>
<li>字典的键不重复，对同一个键多次进行复制操作只会更新键对应的值。</li>
<li>字典也是由散列表实现的，其查找的平均时间复杂度也是 $O(1)$。</li>
<li>可以使用 <code>sorted()</code> 方法对字典进行排序，但结果会以元组的形式返回。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : dict())</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> LOAD_GLOBAL              <span class="number">0</span> (dict)</span><br><span class="line">              <span class="number">3</span> CALL_FUNCTION            <span class="number">0</span> (<span class="number">0</span> positional, <span class="number">0</span> keyword pair)</span><br><span class="line">              <span class="number">6</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="keyword">lambda</span> : &#123;&#125;)</span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> BUILD_MAP                <span class="number">0</span></span><br><span class="line">              <span class="number">3</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit dict()</span><br><span class="line"><span class="number">133</span> ns ± <span class="number">2.95</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>%timeit &#123;&#125;</span><br><span class="line"><span class="number">74.6</span> ns ± <span class="number">3.07</span> ns per loop (mean ± std. dev. of <span class="number">7</span> runs, <span class="number">10000000</span> loops each)</span><br></pre></td></tr></table></figure>
<h4 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h4><ol>
<li>index = hash(key) &amp; mask  # mask = PyDicMinSize - 1</li>
<li>if slot[index] is empty: slot[index] -&gt; value</li>
<li>else if key is old key: slot[index] -&gt; new value</li>
<li>else find a new index: slot[new index] -&gt; new value</li>
</ol>
<h4 id="查找操作"><a href="#查找操作" class="headerlink" title="查找操作"></a>查找操作</h4><ol>
<li>index = hash(key) &amp; mask  # mask = PyDicMinSize - 1</li>
<li>if slot[index] is empty: raise KeyError</li>
<li>if slot[index] is not empty: return slot[index] if slot[index].key == key else find next slot</li>
<li>find all slot but not find # can this happen???</li>
</ol>
<h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><p>删除时并不进行删除操作，只是把该位置赋一个特殊的值，得到需要优化字典结构的时候（字典剩余空间小于 1/3），才执行真的删除操作，并在扩容后重新调整结构。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2019/03/28/计算机网络实验——链路层、网络层/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/28/计算机网络实验——链路层、网络层/" itemprop="url">
                  计算机网络实验——链路层、网络层
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-28 21:41:05" itemprop="dateCreated datePublished" datetime="2019-03-28T21:41:05+08:00">2019-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-01 22:58:59" itemprop="dateModified" datetime="2019-04-01T22:58:59+08:00">2019-04-01</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>6.2k 字</span>
              &nbsp; | &nbsp;
              <span>30 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/28/计算机网络实验——链路层、网络层/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/03/28/计算机网络实验——链路层、网络层/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/28/计算机网络实验——链路层、网络层/" class="leancloud_visitors" data-flag-title="计算机网络实验——链路层、网络层">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>实验主要来源于Rechard Stevens 的《TCP/IP illustrated》（《TCP/IP 详解》）卷一和刘超老师的极客时间专栏《趣谈网络协议》，实验网络拓扑基于docker搭建，github地址戳<a href="https://github.com/popsuper1982/tcpipillustrated" target="_blank" rel="noopener">这里</a>。</p>
<p>网络拓扑如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/40-experiment_environment.jpg" title="图1 实验的网络拓扑">
<p>具体的搭建过程可以看刘超老师写的一篇博文：<a href="https://blog.csdn.net/popsuper1982/article/details/79422735" target="_blank" rel="noopener">有了Openvswitch和Docker，终于可以做《TCP/IP详解》的实验了！</a>。</p>
<p>脚本基本上是一键安装运行的，但是有一点要注意，就是下面的命令中，<code>./setupenv.sh</code>后面一定要跟你自己机器的网络接口（否则可能docker容器访问不了外网），例如我的机器是<strong>eth1</strong>，那么就是<code>./setupenv.sh eth1 hub.c.163.com/liuchao110119163/ubuntu:tcpip</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/popsuper1982/tcpipillustrated.git</span><br><span class="line"><span class="built_in">cd</span> tcpipillustrated</span><br><span class="line">docker pull hub.c.163.com/liuchao110119163/ubuntu:tcpip</span><br><span class="line">chmod +x setupenv.sh</span><br><span class="line">./setupenv.sh enp0s3 hub.c.163.com/liuchao110119163/ubuntu:tcpip</span><br></pre></td></tr></table></figure>
<p>如果还有问题欢迎留言交流。</p>
<h2 id="工具介绍"><a href="#工具介绍" class="headerlink" title="工具介绍"></a>工具介绍</h2><h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><h3 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h3><h3 id="scapy"><a href="#scapy" class="headerlink" title="scapy"></a>scapy</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>由于实验机是Ubuntu 14.04，需要使用下列方式安装python3:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you are using Ubuntu 16.10 or newer, then you can easily install Python 3.6 with the following commands:</span></span><br><span class="line"></span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install python3.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># If you’re using another version of Ubuntu (e.g. the latest LTS release), we recommend using the deadsnakes PPA to install Python 3.6:</span></span><br><span class="line"></span><br><span class="line">$ sudo apt-get install software-properties-common</span><br><span class="line">$ sudo add-apt-repository ppa:deadsnakes/ppa</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install python3.6</span><br></pre></td></tr></table></figure>
<p>安装pip：</p>
<blockquote>
<p>Installing with get-pip.py<br>To install pip, securely download get-pip.py:</p>
<p><code>curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</code><br>Then run the following:</p>
<p><code>python get-pip.py</code><br>Warning Be cautious if you are using a Python install that is managed by your operating system or another package manager. get-pip.py does not coordinate with those tools, and may leave your system in an inconsistent state.</p>
</blockquote>
<p>安装scapy：</p>
<p><code>pip3 install scapy</code></p>
<h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><h3 id="ARP实验"><a href="#ARP实验" class="headerlink" title="ARP实验"></a>ARP实验</h3><p>先来简单回顾一下ARP协议，它的全称是Address Resolution Protocol，中文名地址解析协议，作用是进行IP地址到MAC地址的映射。过程可以看下面两张图：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_request.jpg" title="图2 ARP请求">
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_process.jpg" title="图3 ARP的过程">
<p>ARP是基于以太网帧进行封装的，关于ARP协议具体工作与哪一层还有争议，网上一篇<a href="https://blog.csdn.net/ysdaniel/article/details/6785257" target="_blank" rel="noopener">博文</a>这个说法我认为比较合理：</p>
<blockquote>
<p>可以这样说，在OSI模型中ARP协议属于链路层；而在TCP/IP模型中，ARP协议属于网络层。</p>
</blockquote>
<p>不过除了考试做题，这个争议没用什么意义。比较关键的是以太网帧的结构，如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-ethernet_frame_format.jpg" title="图4 以太网帧结构">
<p>ARP包在以太网帧的基础上进行封装，包结构如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_packet_format.jpg" title="图5 ARP包结构">
<p>有了上面的基础，现在可以开始做实验了。</p>
<h4 id="ARPPing实验"><a href="#ARPPing实验" class="headerlink" title="ARPPing实验"></a>ARPPing实验</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.252.13.33</td>
</tr>
</tbody>
</table>
</div>
<p>使用scapy可以很简单的进行ARPPing：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="comment"># `srp` means send and receive packet</span></span><br><span class="line"><span class="comment"># ethernet frame `dst` field is broadcast</span></span><br><span class="line"><span class="comment"># arp packet encapsulated in ethernet frame data</span></span><br><span class="line"><span class="comment"># send arp packet from bsdi to sun</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = srp(Ether(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>) / ARP(pdst=<span class="string">"140.252.13.33"</span>))</span><br><span class="line">Begin emission:</span><br><span class="line">*Finished sending <span class="number">1</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"></span><br><span class="line"><span class="comment"># inspect ans</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans</span><br><span class="line">&lt;Results: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">1</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># from the output of srp we can see that</span></span><br><span class="line"><span class="comment"># a packet was sent and a packet was received</span></span><br><span class="line"><span class="comment"># see ans.summary()</span></span><br><span class="line"><span class="comment"># it was the request and response of a arp process</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">Ether / ARP who has 140.252.13.33 says 140.252.13.35 ==&gt; Ether / ARP is at 86:43:ab:ea:6e:96 says 140.252.13.33</span><br><span class="line"></span><br><span class="line"><span class="comment"># see the content of the ans tuple</span></span><br><span class="line"><span class="comment"># ans[0][0] is the arp request</span></span><br><span class="line"><span class="comment"># ans[0][1] is the arp reply</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>]</span><br><span class="line">(&lt;Ether  dst=ff:ff:ff:ff:ff:ff type=<span class="number">0x806</span> |&lt;ARP  pdst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> |&gt;&gt;,</span><br><span class="line"> &lt;Ether  dst=<span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span> src=<span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> type=<span class="number">0x806</span> |&lt;ARP  hwtype=<span class="number">0x1</span> ptype=<span class="number">0x800</span> hwlen=<span class="number">6</span> plen=<span class="number">4</span> op=<span class="keyword">is</span>-at hwsrc=<span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> psrc=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> hwdst=<span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span> pdst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> |&gt;&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># see the request packet format</span></span><br><span class="line"><span class="comment"># the `dst` field is a broadcast address</span></span><br><span class="line"><span class="comment"># notice that the `type` field is 0x0806</span></span><br><span class="line"><span class="comment"># which means arp</span></span><br><span class="line"><span class="comment"># hwtype(hardware type) value 1 means ethernet</span></span><br><span class="line"><span class="comment"># ptype(protocol type) value 0x0800 means IP</span></span><br><span class="line"><span class="comment"># hwlen should be 6(length of MAC address)</span></span><br><span class="line"><span class="comment"># plen should be 4(length of IP addres)</span></span><br><span class="line"><span class="comment"># op `who-has` means request opreation</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= ff:ff:ff:ff:ff:ff</span><br><span class="line">  src= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">  type= <span class="number">0x806</span></span><br><span class="line"><span class="comment">###[ ARP ]###</span></span><br><span class="line">     hwtype= <span class="number">0x1</span></span><br><span class="line">     ptype= <span class="number">0x800</span></span><br><span class="line">     hwlen= <span class="literal">None</span></span><br><span class="line">     plen= <span class="literal">None</span></span><br><span class="line">     op= who-has</span><br><span class="line">     hwsrc= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">     psrc= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">     hwdst= <span class="literal">None</span></span><br><span class="line">     pdst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># see the reply packet format</span></span><br><span class="line"><span class="comment"># its `dst` field is the `src' filed of request packet</span></span><br><span class="line"><span class="comment"># `type` is also 0x806</span></span><br><span class="line"><span class="comment"># op `is-at` means arp reply</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">1</span>].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">  src= <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span></span><br><span class="line">  type= <span class="number">0x806</span></span><br><span class="line"><span class="comment">###[ ARP ]###</span></span><br><span class="line">     hwtype= <span class="number">0x1</span></span><br><span class="line">     ptype= <span class="number">0x800</span></span><br><span class="line">     hwlen= <span class="number">6</span></span><br><span class="line">     plen= <span class="number">4</span></span><br><span class="line">     op= <span class="keyword">is</span>-at</span><br><span class="line">     hwsrc= <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span></span><br><span class="line">     psrc= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">     hwdst= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">     pdst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br></pre></td></tr></table></figure>
<p>使用tcpdump在sun端进行抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -i select interface</span></span><br><span class="line"><span class="comment"># -n do not resolve IP address</span></span><br><span class="line">root@70aa710235b6:$ tcpdump -i eth1 -n</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">00:35:44.116294 ARP, Request who-has 140.252.13.33 tell 140.252.13.35, length 42</span><br><span class="line">00:35:44.116317 ARP, Reply 140.252.13.33 is-at 86:43:ab:ea:6e:96, length 28</span><br><span class="line"></span><br><span class="line"><span class="comment"># add -vv</span></span><br><span class="line">root@70aa710235b6:$ tcpdump -i eth1 -n -vv</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">00:50:14.050065 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.33 tell 140.252.13.35, length 42</span><br><span class="line">00:50:14.050087 ARP, Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.33 is-at 86:43:ab:ea:6e:96, length 28</span><br></pre></td></tr></table></figure>
<p>本实验使用scapy构造并发送了一个简单的ARP包，并在目标主机使用tcpdump进行了抓包操作。主要是为了对ARP协议的功能和包结构有一个直观的认识。完整的ARPPing实际可以一次性对一个网段内的所有主机进行进行Ping测试，scapy代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arp ping to subnet 140.252.13.32-63</span></span><br><span class="line"><span class="comment"># net 140.252.13.32</span></span><br><span class="line"><span class="comment"># mask 255.255.255.224</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = srp(Ether(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)/ARP(pdst=<span class="string">"140.252.13.32/27"</span>),</span><br><span class="line">                     timeout=<span class="number">2</span>)</span><br><span class="line">Begin emission:</span><br><span class="line">**Finished sending <span class="number">32</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">2</span> packets, got <span class="number">2</span> answers, remaining <span class="number">30</span> packets</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">Ether / ARP who has 140.252.13.33 says 140.252.13.35 ==&gt; Ether / ARP is at 86:43:ab:ea:6e:96 says 140.252.13.33</span><br><span class="line">Ether / ARP who has 140.252.13.34 says 140.252.13.35 ==&gt; Ether / ARP is at 22:8a:5c:68:86:ec says 140.252.13.34</span><br></pre></td></tr></table></figure>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/arpping.jpg" title="图6 ARPPing 140.252.13.32/27">
<p>结合实验拓扑可以看出结果符合预期。子网140.252.13.32/27可以表示为140.252.13.001 00000，bsdi主机的一个网卡接口的IP地址为140.252.13.001 00011，sun主机的一个网卡接口的IP地址140.252.13.33/27表示为140.252.13.001 00001，svr4主机的一个网卡接口的IP地址可以表示为140.252.13.001 00010，根据子网划分的规则可以看出bsdi、sun和svr4都属于同一个子网。而主机slip的网卡接口的IP地址表示为140.252.13.010 00001，不属于子网140.252.13.001 00000。因此从bsdi发起的ARPPing应该能收到sun和svr4的ARP响应，但是收不到slip的ARP响应。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">140.252.13.32/27</th>
<th style="text-align:center">140.252.13.001 00000</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.252.32.35/27</td>
<td style="text-align:center">140.242.13.001 00011</td>
</tr>
<tr>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.252.32.33/27</td>
<td style="text-align:center">140.252.13.001 00001</td>
</tr>
<tr>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.32.34/27</td>
<td style="text-align:center">140.252.13.001 00010</td>
</tr>
<tr>
<td style="text-align:center">slip</td>
<td style="text-align:center">140.252.32.65/27</td>
<td style="text-align:center">140.252.13.010 00001</td>
</tr>
</tbody>
</table>
</div>
<h4 id="使用telnet连接无效服务器"><a href="#使用telnet连接无效服务器" class="headerlink" title="使用telnet连接无效服务器"></a>使用telnet连接无效服务器</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.13.34</td>
</tr>
</tbody>
</table>
</div>
<p>从bsdi向svr4发起telnet连接，再svr4使用tcpdump抓包。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ telnet 140.252.13.34 22</span><br><span class="line">Trying 140.252.13.34...</span><br><span class="line">Connected to 140.252.13.34.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.6</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># svr4</span></span><br><span class="line">root@6b628ae5483f:$ tcpdump -i eth1 -n -vv arp</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">12:38:25.752415 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.34 tell 140.252.13.35, length 28</span><br><span class="line">12:38:25.752433 ARP, Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.34 is-at 22:8a:5c:68:86:ec, length 28</span><br><span class="line">12:38:30.763321 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.35 tell 140.252.13.34, length 28</span><br><span class="line">12:38:30.763927 ARP, Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.35 is-at 02:1c:55:0e:bb:87, length 28</span><br></pre></td></tr></table></figure>
<p>本实验说明再进行上层通信前需要先获取局域网内主机的MAC地址。</p>
<p>查看一下bsdi的ARP缓存，可以看到bsdi已经将svr4的MAC地址加入了缓存中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@d70675fa03bc:$ arp -n</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">140.252.13.34            ether   22:8a:5c:68:86:ec   C                     eth1</span><br><span class="line">140.252.13.65                    (incomplete)                              bsdiside</span><br><span class="line">140.252.13.33                    (incomplete)                              eth1</span><br></pre></td></tr></table></figure>
<h4 id="使用telnet连接不存在主机"><a href="#使用telnet连接不存在主机" class="headerlink" title="使用telnet连接不存在主机"></a>使用telnet连接不存在主机</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">????</td>
<td style="text-align:center">140.252.13.36</td>
</tr>
</tbody>
</table>
</div>
<p>注意<strong>目的主机不存在</strong>，根据网络号和子网号所对应的网络确实存在，但是并不存在所指定的主机号。从图1可以看出，主机号从36到62的主机并不存在（主机号为63是广播地址）。这里用主机号36来举例。使用一个shell发起telnet连接：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ date; telnet 140.252.13.36;date</span><br><span class="line">Fri Mar 29 12:51:34 UTC 2019</span><br><span class="line">Trying 140.252.13.36...</span><br><span class="line">telnet: Unable to connect to remote host: No route to host</span><br><span class="line">Fri Mar 29 12:51:37 UTC 2019</span><br></pre></td></tr></table></figure>
<p>另一个shell使用tcpdump进行抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ tcpdump -i eth1 -n -vv</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">12:51:34.301832 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.36 tell 140.252.13.35, length 28</span><br><span class="line">12:51:35.299308 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.36 tell 140.252.13.35, length 28</span><br><span class="line">12:51:36.299308 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.36 tell 140.252.13.35, length 28</span><br></pre></td></tr></table></figure>
<p>可以看出这里ARP请求重发了三次，说明ARP请求是有重传机制的，重传的间隔约为1s。</p>
<blockquote>
<p>注意，在线路上始终看不到TCP的报文段。我们能看到的是ARP请求。直到ARP回答返回时，TCP报文段才可以被发送，因为硬件地址到这时才可能知道。如果我们用过滤模式运行tcpdump命令，只查看TCP数据，那么将没有任何输出。</p>
</blockquote>
<h4 id="ARP代理"><a href="#ARP代理" class="headerlink" title="ARP代理"></a>ARP代理</h4><blockquote>
<p>ARP代理也称作混合ARP（promiscuousARP）或ARP出租(ARP hack)。这些名字来自于ARP代理的其他用途：<strong>通过两个物理网络之间的路由器可以互相隐藏物理网络。</strong>在这种情况下，两个物理网络可以使用相同的网络号，只要把中间的路由器设置成一个ARP代理，以响应一个网络到另一个网络主机的ARP请求。这种技术在过去用来隐藏一组在不同物理电缆上运行旧版TCP/IP的主机。分开这些旧主机有两个共同的理由，其一是它们不能处理子网划分，其二是它们使用旧的广播地址（所有比特值为0的主机号，而不是目前使用的所有比特值为1 的主机号）。<br>如果ARP请求是从一个网络的主机发往另一个网络上的主机，那么连接这两个网络的路由器就可以回答该请求，这个过程称作委托ARP或ARP代理(Proxy ARP)。这样可以欺骗发起ARP请求的发送端，使它误以为路由器就是目的主机，而事实上目的主机是在路由器的“另一边”。路由器的功能相当于目的主机的代理，把分组从其他主机转发给它。</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">gemini</td>
<td style="text-align:center">140.252.1.11</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.242.13.33</td>
</tr>
</tbody>
</table>
</div>
<p>实验拓扑如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/5-arp_proxy.jpeg" title="图7 代理ARP">
<p>如图1所示，系统sun与两个以太网相连。但是事实上并不是这样，在sun和子网140.252.1之间实际存在一个路由器，就是这个具有ARP代理功能的路由器使得sun就好像在子网140.252.1上一样。具体安置如图7所示，路由器Telebit NetBlazer，取名为netb，在子网和主机sun之间。</p>
<blockquote>
<p>当子网140.252.1（称作gemini）上的其他主机有一份IP数据报要传给地址为140.252.1.29的sun时，gemini比较网络号（140.252）和子网号（1），因为它们都是相同的，因而在图7上面的以太网中发送IP地址140.252.1.29的ARP请求。路由器netb识别出该IP地址属于它的一个拔号主机，于是把它的以太网接口地址140.252.1作为硬件地址来回答。主机gemini通过以太网发送IP数据报到netb，netb通过拨号SLIP链路把数据报转发到sun。这个过程对于所有140.252.1子网上的主机来说都是透明的，主机sun实际上是在路由器netb后面进行配置的。</p>
</blockquote>
<p>从主机gemini向主机sun发起ssh连接，分别在gemini（右上）、netb（左下）和sun（右下）进行抓包。</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/arp_proxy.png" title="图8 代理ARP实验">
<p>完成操作后查看gemini的ARP缓存：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@07928580bdcd:$ arp -n</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">140.252.1.29             ether   32:3a:6f:<span class="built_in">cd</span>:a7:24   C                     eth1</span><br><span class="line">140.252.1.4              ether   c6:74:e6:3b:dd:e6   C                     eth1</span><br><span class="line">140.252.1.183            ether   32:3a:6f:<span class="built_in">cd</span>:a7:24   C                     eth1</span><br></pre></td></tr></table></figure>
<p>经过与主机sun通信以后，发现在同一个子网140.252.1上的netb和sun的IP地址映射的硬件地址是相同的。这通常是使用委托ARP的线索。netb作为ARP代理，使得sun就像是子网140.252.1的一部分一样。</p>
<h3 id="IP实验"><a href="#IP实验" class="headerlink" title="IP实验"></a>IP实验</h3><h4 id="bsdi向sun发送数据包"><a href="#bsdi向sun发送数据包" class="headerlink" title="bsdi向sun发送数据包"></a>bsdi向sun发送数据包</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">sun</td>
<td style="text-align:center">140.252.13.33</td>
</tr>
</tbody>
</table>
</div>
<p>在主机bsdi使用scapy构建IP数据包，并发送到sun：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet = IP(dst=<span class="string">"140.252.13.33"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet.show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="literal">None</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="literal">None</span></span><br><span class="line">  id= <span class="number">1</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= hopopt</span><br><span class="line">  chksum= <span class="literal">None</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">  \options\</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>send(packet)</span><br></pre></td></tr></table></figure>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/IPHeader.jpeg" title="图9 IP包结构">
<p>对比scapy中打印的结果和图9中IP包的结构可以看出构造的IP包可以不用填写每一个字段，也就是说可以使用scapy构造不完整甚至有问题的IP数据包在网络中传输。</p>
<p>在sun使用tcpdump进行抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sun</span></span><br><span class="line"><span class="comment"># -i 用于指定接口</span></span><br><span class="line"><span class="comment"># -nn 不进行IP到域名和服务到端口的转换</span></span><br><span class="line">root@70aa710235b6:$ tcpdump -i eth1 -nn</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">14:10:19.512733 IP 140.252.13.35 &gt; 140.252.13.33:  ip-proto-0 0</span><br><span class="line">14:10:19.512771 IP 140.252.13.33 &gt; 140.252.13.35: ICMP 140.252.13.33 protocol 0 unreachable,length 28</span><br></pre></td></tr></table></figure>
<p>由于这个IP包没有特定的接收目标，sun端返回了一个协议不可达的ICMP报文。在bsdi端抓取该ICMP报文：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = sniff(timeout=<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.summary()</span><br><span class="line">Ether / ARP who has <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> says <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> / Padding</span><br><span class="line">Ether / ARP <span class="keyword">is</span> at <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> says <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">Ether / <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> &gt; <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> hopopt / Padding</span><br><span class="line">Ether / IP / ICMP <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> &gt; <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> dest-unreach protocol-unreachable / IPerror</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res[ICMP][<span class="number">0</span>]</span><br><span class="line">&lt;Ether  dst=<span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span> src=<span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span> type=<span class="number">0x800</span> |</span><br><span class="line">&lt;IP  version=<span class="number">4</span> ihl=<span class="number">5</span> tos=<span class="number">0xc0</span> len=<span class="number">48</span> id=<span class="number">25344</span> flags= frag=<span class="number">0</span> ttl=<span class="number">64</span> proto=icmp chksum=<span class="number">0xe2d0</span> src=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> dst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> |</span><br><span class="line">&lt;ICMP  type=dest-unreach code=protocol-unreachable chksum=<span class="number">0xfcfd</span> reserved=<span class="number">0</span> length=<span class="number">0</span> nexthopmtu=<span class="number">0</span> |</span><br><span class="line">&lt;IPerror  version=<span class="number">4</span> ihl=<span class="number">5</span> tos=<span class="number">0x0</span> len=<span class="number">20</span> id=<span class="number">1</span> flags= frag=<span class="number">0</span> ttl=<span class="number">64</span> proto=hopopt chksum=<span class="number">0x46ad</span> src=<span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> dst=<span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span> |&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>关于ICMP的详细信息将在ICMP实验中进行介绍。</p>
<h4 id="IP路由选择的实验"><a href="#IP路由选择的实验" class="headerlink" title="IP路由选择的实验"></a>IP路由选择的实验</h4><p>主机选路时的优先级：</p>
<ol>
<li>搜索匹配的主机地址；</li>
<li>搜索匹配的网络地址；</li>
<li>搜索默认表项（默认表项一般在路由表中被指定为一个网络表项，其网络号为0）。</li>
</ol>
<p><strong>TODO:</strong> 这部分内容暂时做不了，但是是很有意义的实验，值得研究。</p>
<h3 id="ICMP实验"><a href="#ICMP实验" class="headerlink" title="ICMP实验"></a>ICMP实验</h3><p>ICMP全称Internet Control Message Protocol，就是互联网控制报文协议。ICMP报文是封装在IP包里面的，它本身非常简单，通常被IP层或更高层的协议使用（UDP和TCP）。ICMP主要分为查询报文和查询报文,其格式如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/7-icmp_packet_format.jpg" title="图10 ICMP报文结构">
<h4 id="ICMP地址掩码请求与应答"><a href="#ICMP地址掩码请求与应答" class="headerlink" title="ICMP地址掩码请求与应答"></a>ICMP地址掩码请求与应答</h4><p>ICMP地址掩码请求用于无盘系统在引导过程中获取自己的子网掩码。</p>
<p>实验过程中发现没有主机会响应该ICMP请求报文，搜索后发现<a href="https://networkengineering.stackexchange.com/a/46589" target="_blank" rel="noopener">stackexchange</a>上的一个答案说该ICMP查询请求已被废弃：</p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc6918" target="_blank" rel="noopener">RFC 6918</a> deprecates several ICMP types:</p>
<p>Alternate Host Address (Type 6)<br>Information Request (Type 15)<br>Information Reply (Type 16)<br>Address Mask Request (Type 17)<br>Address Mask Reply (Type 18)<br>Traceroute (Type 30)<br>Datagram Conversion Error (Type 31)<br>Mobile Host Redirect (Type 32)<br>IPv6 Where-Are-You (Type 33)<br>IPv6 I-Am-Here (Type 34)<br>Mobile Registration Request (Type 35)<br>Mobile Registration Reply (Type 36)<br>Domain Name Request (Type 37)<br>Domain Name Reply (Type 38)<br>SKIP (Type 39)<br>Not a straight answer but probably the best you can get.  </p>
</blockquote>
<h4 id="ICMP时间戳请求与应答"><a href="#ICMP时间戳请求与应答" class="headerlink" title="ICMP时间戳请求与应答"></a>ICMP时间戳请求与应答</h4><p>报文请求结构如图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/icmp_timestamp.png" title="图11 ICMP时间戳请求报文与应答">
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.13.34</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="comment"># define a function to get current time</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">getnow</span><span class="params">()</span>:</span></span><br><span class="line">...:     yy, mm, dd, *_ = time.localtime()</span><br><span class="line">...:     <span class="keyword">return</span> int((time.time() - time.mktime((yy, mm, dd, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))) * <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send and receive icmp timestamp request and reply</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"140.252.13.34"</span>)/ICMP(type=<span class="number">13</span>, ts_ori=getnow()))</span><br><span class="line">Begin emission:</span><br><span class="line">*Finished sending <span class="number">1</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans</span><br><span class="line">&lt;Results: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">1</span> Other:<span class="number">0</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">IP / ICMP 140.252.13.35 &gt; 140.252.13.34 timestamp-request 0 ==&gt; IP / ICMP 140.252.13.34 &gt; 140.252.13.35 timestamp-reply 0</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="literal">None</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="literal">None</span></span><br><span class="line">  id= <span class="number">1</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="literal">None</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.34</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-request</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="literal">None</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.190</span></span><br><span class="line">     ts_rx= <span class="number">15</span>:<span class="number">0</span>:<span class="number">25.317</span></span><br><span class="line">     ts_tx= <span class="number">15</span>:<span class="number">0</span>:<span class="number">25.317</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">1</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="number">5</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="number">40</span></span><br><span class="line">  id= <span class="number">26909</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="number">0xdd7a</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.34</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-reply</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="number">0x541</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.190</span></span><br><span class="line">     ts_rx= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.193</span></span><br><span class="line">     ts_tx= <span class="number">0</span>:<span class="number">52</span>:<span class="number">2.193</span></span><br></pre></td></tr></table></figure>
<p>使用ICMP向NTP服务器请求时间戳：</p>
<p><a href="https://www.cnblogs.com/croso/p/6670039.html" target="_blank" rel="noopener">国内常用NTP服务器地址及IP</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line"><span class="comment"># type 13/14 for request/response</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans, unans = sr(IP(dst=<span class="string">"cn.pool.ntp.org"</span>)/ICMP(type=<span class="number">13</span>, ts_ori=getnow()))</span><br><span class="line">Begin emission:</span><br><span class="line">Finished sending <span class="number">1</span> packets.</span><br><span class="line"></span><br><span class="line">Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br><span class="line">IP / ICMP 140.252.13.35 &gt; 119.28.183.184 timestamp-request 0 ==&gt; IP / ICMP 119.28.183.184 &gt;</span><br><span class="line"><span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span> timestamp-reply <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="literal">None</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  len= <span class="literal">None</span></span><br><span class="line">  id= <span class="number">1</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="literal">None</span></span><br><span class="line">  src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  dst= <span class="number">119.28</span><span class="number">.183</span><span class="number">.184</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-request</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="literal">None</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.294</span></span><br><span class="line">     ts_rx=</span><br><span class="line">     ts_tx=</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans[<span class="number">0</span>][<span class="number">1</span>].show()</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="number">5</span></span><br><span class="line">  tos= <span class="number">0x68</span></span><br><span class="line">  len= <span class="number">40</span></span><br><span class="line">  id= <span class="number">30896</span></span><br><span class="line">  flags=</span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">43</span></span><br><span class="line">  proto= icmp</span><br><span class="line">  chksum= <span class="number">0x4dc9</span></span><br><span class="line">  src= <span class="number">119.28</span><span class="number">.183</span><span class="number">.184</span></span><br><span class="line">  dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">  \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">     type= timestamp-reply</span><br><span class="line">     code= <span class="number">0</span></span><br><span class="line">     chksum= <span class="number">0x9b2f</span></span><br><span class="line">     id= <span class="number">0x0</span></span><br><span class="line">     seq= <span class="number">0x0</span></span><br><span class="line">     ts_ori= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.294</span></span><br><span class="line">     ts_rx= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.330</span></span><br><span class="line">     ts_tx= <span class="number">12</span>:<span class="number">36</span>:<span class="number">41.330</span></span><br></pre></td></tr></table></figure>
<p>在bsdi使用tcpdump抓包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@d70675fa03bc:$ tcpdump -i eth1 -vv icmp</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">12:36:41.297617 IP (tos 0x0, ttl 64, id 1, offset 0, flags [none], proto ICMP (1), length 40)</span><br><span class="line">    140.252.13.35 &gt; 119.28.183.184: ICMP time stamp query id 0 seq 0, length 20</span><br><span class="line">12:36:41.334079 IP (tos 0x68, ttl 43, id 30896, offset 0, flags [none], proto ICMP (1), length 40)</span><br><span class="line">    119.28.183.184 &gt; 140.252.13.35: ICMP time stamp reply id 0 seq 0: org 12:36:41.294, recv 12:36:41.330, xmit 12:36:41.330, length 20</span><br></pre></td></tr></table></figure>
<h4 id="ICMP端口不可达报文"><a href="#ICMP端口不可达报文" class="headerlink" title="ICMP端口不可达报文"></a>ICMP端口不可达报文</h4><p>它是ICMP目的不可到达报文中的一种，本实验通过人为制造的无效UDP报文查看ICMP差错报文中所附加的信息。</p>
<p>UDP的规则之一是，如果收到一份UDP数据报而目的端口与某个正在使用的进程不相符，那么UDP返回一个ICMP不可达报文。</p>
<p>报文请求结构如下图所示：</p>
<img src="/2019/03/28/计算机网络实验——链路层、网络层/ICMP_unreachable.png" title="图12 ICMP端口不可达报文">
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">类别</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">接口地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">源主机</td>
<td style="text-align:center">bsdi</td>
<td style="text-align:center">140.242.13.35</td>
</tr>
<tr>
<td style="text-align:center">目的主机</td>
<td style="text-align:center">svr4</td>
<td style="text-align:center">140.252.13.34</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bsdi</span></span><br><span class="line">root@d70675fa03bc:$ tftp</span><br><span class="line">tftp&gt; connect 140.252.13.34 8888</span><br><span class="line">tftp&gt; get sth</span><br><span class="line">Transfer timed out.</span><br><span class="line"></span><br><span class="line">root@d70675fa03bc:$ tcpdump -i eth1 -nn -v</span><br><span class="line">tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">13:08:04.411673 02:1c:55:0e:bb:87 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 140.252.13.34 tell 140.252.13.35, length 28</span><br><span class="line">13:08:04.412015 22:8a:5c:68:86:ec &gt; 02:1c:55:0e:bb:87, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Reply 140.252.13.34 is-at 22:8a:5c:68:86:ec, length 28</span><br><span class="line">13:08:04.412023 02:1c:55:0e:bb:87 &gt; 22:8a:5c:68:86:ec, ethertype IPv4 (0x0800), length 57: (tos 0x0, ttl 64, id 63030, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line">13:08:04.413318 22:8a:5c:68:86:ec &gt; 02:1c:55:0e:bb:87, ethertype IPv4 (0x0800), length 85: (tos 0xc0, ttl 64, id 2041, offset 0, flags [none], proto ICMP (1), length 71)</span><br><span class="line">    140.252.13.34 &gt; 140.252.13.35: ICMP 140.252.13.34 udp port 8888 unreachable, length 51</span><br><span class="line">        (tos 0x0, ttl 64, id 63030, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line">13:08:09.411913 02:1c:55:0e:bb:87 &gt; 22:8a:5c:68:86:ec, ethertype IPv4 (0x0800), length 57: (tos 0x0, ttl 64, id 64140, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line">13:08:09.411979 22:8a:5c:68:86:ec &gt; 02:1c:55:0e:bb:87, ethertype IPv4 (0x0800), length 85: (tos 0xc0, ttl 64, id 2194, offset 0, flags [none], proto ICMP (1), length 71)</span><br><span class="line">    140.252.13.34 &gt; 140.252.13.35: ICMP 140.252.13.34 udp port 8888 unreachable, length 51</span><br><span class="line">        (tos 0x0, ttl 64, id 64140, offset 0, flags [DF], proto UDP (17), length 43)</span><br><span class="line">    140.252.13.35.50224 &gt; 140.252.13.34.8888: UDP, length 15</span><br><span class="line"></span><br><span class="line"><span class="comment"># use scapy sniff ICMP port unreachable packet</span></span><br><span class="line">&gt;&gt;&gt; res = sniff()</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; res</span><br><span class="line">&lt;Sniffed: TCP:0 UDP:5 ICMP:5 Other:4&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; res[ICMP].summary()</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line">Ether / IP / ICMP 140.252.13.34 &gt; 140.252.13.35 dest-unreach port-unreachable / IPerror / UDPerror / Raw</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; res[ICMP][0][0].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= 02:1c:55:0e:bb:87</span><br><span class="line">  src= 22:8a:5c:68:86:ec</span><br><span class="line">  <span class="built_in">type</span>= 0x800</span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">     version= 4</span><br><span class="line">     ihl= 5</span><br><span class="line">     tos= 0xc0</span><br><span class="line">     len= 71</span><br><span class="line">     id= 46842</span><br><span class="line">     flags=</span><br><span class="line">     frag= 0</span><br><span class="line">     ttl= 64</span><br><span class="line">     proto= icmp</span><br><span class="line">     chksum= 0x8ebe</span><br><span class="line">     src= 140.252.13.34</span><br><span class="line">     dst= 140.252.13.35</span><br><span class="line">     \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">        <span class="built_in">type</span>= dest-unreach</span><br><span class="line">        code= port-unreachable</span><br><span class="line">        chksum= 0x3163</span><br><span class="line">        reserved= 0</span><br><span class="line">        length= 0</span><br><span class="line">        nexthopmtu= 0</span><br><span class="line"><span class="comment">###[ IP in ICMP ]###</span></span><br><span class="line">           version= 4</span><br><span class="line">           ihl= 5</span><br><span class="line">           tos= 0x0</span><br><span class="line">           len= 43</span><br><span class="line">           id= 20498</span><br><span class="line">           flags= DF</span><br><span class="line">           frag= 0</span><br><span class="line">           ttl= 64</span><br><span class="line">           proto= udp</span><br><span class="line">           chksum= 0xb672</span><br><span class="line">           src= 140.252.13.35</span><br><span class="line">           dst= 140.252.13.34</span><br><span class="line">           \options\</span><br><span class="line"><span class="comment">###[ UDP in ICMP ]###</span></span><br><span class="line">              sport= 38693</span><br><span class="line">              dport= 8888</span><br><span class="line">              len= 23</span><br><span class="line">              chksum= 0x7ca0</span><br><span class="line"><span class="comment">###[ Raw ]###</span></span><br><span class="line">                 load= <span class="string">'\x00\x01foo\x00netascii\x00'</span></span><br></pre></td></tr></table></figure>
<p>此处使用了TFTP协议强制生成了一个端口不可达报文，connect命令首先指定要连接的主机名及其端口号，接着用get命令来取文件。在UDP数据报送到svr4之前，要先发送一份ARP请求来确定它的硬件地址，接着返回ARP应答（tcpdump抓取到的前两个数据包），然后才发送UDP数据包，一个ICMP端口不可达差错是立刻返回的。接着又尝试了几次后客户程序才放弃，打印了一个超时的结果。</p>
<blockquote>
<p>ICMP的一个规则是，ICMP差错报文必须包括生成该差错报文的数据报IP首部（包含任何选项），还必须至少包括跟在该IP首部后面的前8个字节。在我们的例子中，<strong>跟在IP首部后面的前8个字节包含UDP的首部</strong>。</p>
</blockquote>
<p>这一点可以从scapy的抓包结果中看出。</p>
<blockquote>
<p>一个重要的事实是包含在UDP首部中的内容是源端口号和目的端口号。就是由于目的端口号（8888）才导致产生了ICMP端口不可达的差错报文。接收ICMP的系统可以根据源端口号来把差错报文与某个特定的用户进程相关联（在本例中是TFTP客户程序）。</p>
<p>导致差错的数据报中的IP首部要被送回的原因是因为IP首部中包含了协议字段，使得ICMP可以知道如何解释后面的8个字节（在本例中是UDP首部）。如果查看TCP首部,可以发现<strong>源端口和目的端口被包含在TCP首部的前8个字节中</strong>。</p>
</blockquote>
<h4 id="ICMP协议不可达报文"><a href="#ICMP协议不可达报文" class="headerlink" title="ICMP协议不可达报文"></a>ICMP协议不可达报文</h4><p>这个实验同IP层的<strong>bsdi向sun发送数据包</strong>实验，此处只研究返回的ICMP报文。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>res[ICMP][<span class="number">0</span>].show()</span><br><span class="line"><span class="comment">###[ Ethernet ]###</span></span><br><span class="line">  dst= <span class="number">02</span>:<span class="number">1</span>c:<span class="number">55</span>:<span class="number">0</span>e:bb:<span class="number">87</span></span><br><span class="line">  src= <span class="number">86</span>:<span class="number">43</span>:ab:ea:<span class="number">6</span>e:<span class="number">96</span></span><br><span class="line">  type= <span class="number">0x800</span></span><br><span class="line"><span class="comment">###[ IP ]###</span></span><br><span class="line">     version= <span class="number">4</span></span><br><span class="line">     ihl= <span class="number">5</span></span><br><span class="line">     tos= <span class="number">0xc0</span></span><br><span class="line">     len= <span class="number">48</span></span><br><span class="line">     id= <span class="number">25344</span></span><br><span class="line">     flags=</span><br><span class="line">     frag= <span class="number">0</span></span><br><span class="line">     ttl= <span class="number">64</span></span><br><span class="line">     proto= icmp</span><br><span class="line">     chksum= <span class="number">0xe2d0</span></span><br><span class="line">     src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">     dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">     \options\</span><br><span class="line"><span class="comment">###[ ICMP ]###</span></span><br><span class="line">        type= dest-unreach</span><br><span class="line">        code= protocol-unreachable</span><br><span class="line">        chksum= <span class="number">0xfcfd</span></span><br><span class="line">        reserved= <span class="number">0</span></span><br><span class="line">        length= <span class="number">0</span></span><br><span class="line">        nexthopmtu= <span class="number">0</span></span><br><span class="line"><span class="comment">###[ IP in ICMP ]###</span></span><br><span class="line">           version= <span class="number">4</span></span><br><span class="line">           ihl= <span class="number">5</span></span><br><span class="line">           tos= <span class="number">0x0</span></span><br><span class="line">           len= <span class="number">20</span></span><br><span class="line">           id= <span class="number">1</span></span><br><span class="line">           flags=</span><br><span class="line">           frag= <span class="number">0</span></span><br><span class="line">           ttl= <span class="number">64</span></span><br><span class="line">           proto= hopopt</span><br><span class="line">           chksum= <span class="number">0x46ad</span></span><br><span class="line">           src= <span class="number">140.252</span><span class="number">.13</span><span class="number">.35</span></span><br><span class="line">           dst= <span class="number">140.252</span><span class="number">.13</span><span class="number">.33</span></span><br><span class="line">           \options\</span><br></pre></td></tr></table></figure>
<p>因为这个错误是网络层的错误，没有和特定的进程产生关联，所以ICMP报文中只有出错IP报文的信息，而不像上一个实验中既有网络层的出错信息，也有传输层的出错信息。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过使用docker搭建的实验环境，我尝试复现一些《TCP/IP 详解》卷一中的例子，并将这些例子的构造方法和网络流信息进行记录，主要是数据链路层和网络层的例子。并在进行实验的过程中熟悉了scapy和tcpdump等工具的一些基本用法。</p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a href="http://www.52im.net/topic-tcpipvol1.html" target="_blank" rel="noopener">《TCP/IP 详解》卷一</a><br><a href="https://docs.python-guide.org/" target="_blank" rel="noopener">The Hitchhiker’s Guide to Python!</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2018/10/13/Linux生存指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/13/Linux生存指南/" itemprop="url">
                  Linux生存指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-13 20:43:41" itemprop="dateCreated datePublished" datetime="2018-10-13T20:43:41+08:00">2018-10-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-12-31 21:40:56" itemprop="dateModified" datetime="2019-12-31T21:40:56+08:00">2019-12-31</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>3.4k 字</span>
              &nbsp; | &nbsp;
              <span>15 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/13/Linux生存指南/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/10/13/Linux生存指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/10/13/Linux生存指南/" class="leancloud_visitors" data-flag-title="Linux生存指南">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>使用linux过程中最基本、最常用的命令、工具记录。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/10/13/Linux生存指南/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://callmexss.top/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="许山山">
      <meta itemprop="description" content="繁华尘世，时光如沙，轻歌曼舞有时尽。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="像素书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/" itemprop="url">
                  深入理解计算机系统（一）——计算机系统漫游
                </a>
              
            
          </h1>
        

        <div class="post-meta">


          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-27 21:12:02" itemprop="dateCreated datePublished" datetime="2018-09-27T21:12:02+08:00">2018-09-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-04 17:43:49" itemprop="dateModified" datetime="2019-06-04T17:43:49+08:00">2019-06-04</time>
              
            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <span>1.7k 字</span>
              &nbsp; | &nbsp;
              <span>5 min</span>
            </span>
          

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/09/27/深入理解计算机系统（一）——计算机系统漫游/" class="leancloud_visitors" data-flag-title="深入理解计算机系统（一）——计算机系统漫游">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote><p>系统中的所有信息——包括磁盘文件、内存中的程序和用户数据以及网络中传输的数据，都是由一串比特表示的。</p>
</blockquote>
<h2 id="编译系统"><a href="#编译系统" class="headerlink" title="编译系统"></a>编译系统</h2><p>编译系统由四部分组成：</p>
<ul>
<li>预处理器</li>
<li>编译器</li>
<li>汇编器</li>
<li>连接器</li>
</ul>
<h2 id="系统的硬件组成"><a href="#系统的硬件组成" class="headerlink" title="系统的硬件组成"></a>系统的硬件组成</h2><ol>
<li><p>总线</p>
<p> 贯穿整个系统的是<strong>一组电子管道</strong>，称作总线，它携带信息字节并负责在各个部件间传递。通常总线被设计成传送<strong>定长</strong>的字节快，也就是<strong>字(word)</strong>。字中的字节数（即字长）是一个基本的系统参数，各个系统中都不尽相同。</p>
</li>
<li><p>I/O 设备</p>
<p> I/O设备是系统与外部世界联系的通道。每个I/O设备都通过一个 <strong>控制器</strong> 或者 <strong>适配器</strong> 与I/O总线相连。区别主要在它们的封装方式。控制器是I/O设备本身或者主板上的芯片组。而适配器则是一块插在主板插槽上的卡。它们的功能都是 <strong>在I/O总线和I/O设备间传递信息</strong>。</p>
</li>
<li><p>主存</p>
<p> 主存是一个临时的存储设备，在处理器执行程序时，用来 <strong>存放程序和程序处理的数据</strong>。也就是说，当一个程序在运行时，首先会将自身加载到内存中去。从 <strong>物理上来讲</strong> ，主存是由一组动态随机存储器（DRAM）芯片组成的。从 <strong>逻辑上讲</strong> ，存储器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引），这些地址是从零开始的。</p>
</li>
<li><p>处理器</p>
<p> 中央处理单元（CPU），简称处理器，是解释（或执行）存储在主存中指令的引擎。处理器的核心是大小为一个字的存储设备（或寄存器），称为程序计数器（PC）。在任何时刻，PC都指向主存中的某条机器语言指令（即含有该条指令的地址）。<br> 从系统通电开始，直到系统断电，处理器一直在不断地执行程序计数器指向的指令，再更新程序计数器，使其指向下一条指令。处理器从程序计数器指向的内存中读取指令，解释指令中的位，执行该指令指示的简单操作，然后更新PC，使其指向下一条指令，这条指令并不一定和在内存中刚刚执行的指令相邻。他们围绕着 <strong>主存、寄存器文件（register file）和算数/逻辑单元（ALU）进行。</strong> 寄存器文件是一个小的存储设备，由一些单个字长的寄存器组成，每个寄存器都有唯一的名字。ALU计算新的数据和地址值。下面是一些简单操作的例子，CPU在指令的要求下可能会执行这些操作。</p>
<ul>
<li>加载：主存 ——&gt; 寄存器，覆盖寄存器原来的内容。</li>
<li>存储：寄存器 ——&gt; 主存，覆盖这个地址上原来的内容。</li>
<li>操作：把两个寄存器的内容复制到ALU，ALU对这两个字做算术运算，并将结果放到一个寄存器中，覆盖该寄存器中原来的内容。</li>
<li>跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖（PC）中原来的值。</li>
</ul>
</li>
</ol>
<h2 id="高速缓存"><a href="#高速缓存" class="headerlink" title="高速缓存"></a>高速缓存</h2><p>系统花费了大量时间把信息从一个地方搬到另一个地方。</p>
<p><strong>局部性原理</strong>：程序具有访问局部区域里的数据和代码的趋势。</p>
<p>意识到高速缓存存储器存在的应用程序员能够利用告诉缓存将程序的性能提高一个数量级。</p>
<p>在处理器和一个较大较慢的设备（例如主存）间插入一个更小更快的存储设备（例如高速缓存）的想法已经称为一个普遍的观念。</p>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>操作系统可以被视作应用程序和底层硬件间的一层软件。所有应用程序对硬件的尝试都必须经过操作系统。</p>
<p>操作系统有两个基本功能：（1）防止硬件被失控的应用程序滥用;（2）向应用程序提供简单一致的机制来控制复杂而通常又大不相同的低级硬件设备。操作系统通过几个基本的抽象概念（ <strong>进程、虚拟内存和文件</strong> ）来实现这两个功能。文件是对I/O设备的抽象表示，虚拟内存是对主存和磁盘I/O设备的抽象表示，进程则是对处理器、主存和I/O设备的抽象表示。</p>
<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>进程是操作系统对一个正在运行的程序的一种抽象。</p>
<p>操作系统中进程交错执行的机制称为上下文切换。 <strong>上下文切换</strong>是指操作系统保存当前进程上下文（PC和寄存器文件的当前值，以及主存中的内容）、恢复新进程的上下文，然后将控制权传递给新进程，新进程就会从它上传停止的地方开始。</p>
<p>内核不是一个独立的进程，相反它是系统管理全部进程所用代码和数据结构的集合。</p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>一个进程实际上由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。</p>
<h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><p>虚拟内存是一个抽象概念，它为每个进程提供了一个假象，即每个进程都在独占的使用主存。每个进程看到的内存都是一致的，称为虚拟地址空间。</p>
<p>每个进程看到的虚拟地址空间由大量准确定义的区构成，每个区都有专门的功能。</p>
<p>虚拟内存的运作需要硬件和操作系统之间精密复杂的交互，包括对处理器生成的每个地址的硬件翻译。基本思想是把一个进程虚拟内存的内容存储在磁盘上，然后用主存作为磁盘的高速缓存。</p>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><p>文件就是字节序列，仅此而已。每个I/O设备，包括磁盘、键盘、显示器，甚至网络，都可以看成是文件。系统中的所有输入输出都是通过使用一小组称为Unix I/O的系统函数调用读写文件来实现的。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
</article>
  
  
  

    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="许山山">
            
              <p class="site-author-name" itemprop="name">许山山</p>
              <p class="site-description motion-element" itemprop="description">繁华尘世，时光如沙，轻歌曼舞有时尽。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/callmexss" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:callmexss@126.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">许山山</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">
    <div class="powered-by"></div>
    <span class="post-count">共42.7k字</span>
  </div>
  #<div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Mist</a> v6.4.1</div>





        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: false,
        appId: 'mvmTM6opb6WjC9b5fNkvJr6d-gzGzoHsz',
        appKey: 'q6go6BQInvwQpcLVL64QiKC2',
        placeholder: '说点儿什么吧 ：）',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.4.1"></script>



  

  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { "$in": entries } }) })
        .done(function ({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log("LeanCloud Counter Error: " + responseJSON.code + " " + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "IQEs5IP2iJTi9CBkLTnpKNN3-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "IQEs5IP2iJTi9CBkLTnpKNN3-gzGzoHsz",
                'X-LC-Key': "uRROIGwaWOhMnPAu3IKnGy4K",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          if ($('.post-title-link').length >= 1) {
            showTime(Counter);
          }
          
        })
    });
  </script>



  

  

  
  

  
  
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  

  

  

  

  

  

</body>
</html>
